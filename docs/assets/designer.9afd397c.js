import{_ as C}from"./preload-helper.101896b7.js";import{d as Y,a7 as Z,a6 as x,r as v,O as tt,c as et,a9 as at,S as l,a4 as st,e as i,f as d,l as R,m as o,z as n,p,g as r,F as A,B as L,j as nt,u as w,v as b,t as ot,x as f,ab as it,ac as rt,L as lt,I as D,n as ct,y as $}from"./vue.72f2672d.js";import{W as M}from"./WorkflowTemplate.8c5ea799.js";import dt from"./index.933d599f.js";import{x as pt}from"./index.bcf39767.js";import{_ as ft}from"./_plugin-vue_export-helper.c27b6911.js";import"./http-client.180deef4.js";import"./index.57385bce.js";import"./index.0c380c40.js";import"./index.41e0794f.js";import"./storage.6b2e7cd0.js";import"./index.eead254e.js";import"./focus-trap.c8a23a9c.js";const ut=u=>(it("data-v-1fb54232"),u=u(),rt(),u),_t=f("关闭"),gt={key:1,class:"design-page"},mt={class:"page__header"},St={class:"page-actions"},vt=ut(()=>r("div",null,"流程设计器",-1)),wt={class:"step-tab"},bt=["onClick"],yt={class:"step-index"},ht=f("草稿"),kt=f("发布"),Ct={key:0,class:"page__content"},xt={class:"dialog-footer"},Dt=f("知道了"),It=Y({__name:"designer",props:{title:{type:String,default:()=>"模板名称12"}},setup(u){const{proxy:I}=lt(),N=Z(),z=x(()=>C(()=>import("./index.b65ae8a2.js"),["assets/index.b65ae8a2.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/vue.72f2672d.js","assets/index.73f7d257.css"])),P=x(()=>C(()=>import("./index.c1942e67.js"),["assets/index.c1942e67.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js","assets/index.b8b8527b.js","assets/index.44ec5d1e.js","assets/db.bf0a0f00.js","assets/index.97b0ee19.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/index.1cb35fc4.css"])),q=x(()=>C(()=>import("./index.b5bd1479.js"),["assets/index.b5bd1479.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/index.4ed09cf5.css"])),W=a=>{t.fields=a},X=a=>{t.fields=a||[]},j=()=>{window.parent.postMessage("close"),window.close()},U=a=>t.data[a];D("updateFormItemList",X),D("updateFlow",W),D("getInitSetting",U);const B=v(null),E=v(null),O=v(null),F=v(null),t=tt({isShowResult:!1,fields:[],data:{name:"",formSetting:{},flowSetting:{},basicSetting:{},advancedSetting:{}},activeStep:"basicSetting",steps:[{label:"基础设置",key:"basicSetting"},{label:"表单设计",key:"formDesign"},{label:"流程设计",key:"flowDesign"},{label:"高级设置",key:"advancedSetting"}]}),T=()=>{var a=N.query.id;t.data.id=a,new M().save(t.data,{showErrorMessage:!0}).then(e=>{e.success?t.isShowResult=!0:I.$modal.msgError(e.msg)})},V=async a=>{var _,g,m,S;var e=!0,c=await((_=O.value)==null?void 0:_.getSetting().catch(s=>{t.activeStep="basicSetting",e=!1}));if(e){var y=await((g=B.value)==null?void 0:g.getSetting().catch(s=>{t.activeStep="formDesign",e=!1}));if(e){var h=await((m=E.value)==null?void 0:m.getSetting().catch(s=>{t.activeStep="flowDesign",e=!1}));if(e){var k=await((S=F.value)==null?void 0:S.getSetting().catch(s=>{t.activeStep="advancedSetting",e=!1}));e&&(t.data.basicSetting=c,t.data.basicContext=JSON.stringify(t.data.basicSetting),t.data.advancedContext=JSON.stringify(k),t.data.flowSetting=JSON.stringify(h),t.data.formSetting=JSON.stringify(y),t.data.isPublish=a,a?I.$modal.confirm("此操作将新建或者更新流程版本, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{T()}).catch(()=>{}):T())}}}},G=a=>{t.data.formSetting=a},H=et(()=>`translateX(${t.steps.findIndex(a=>a.key===t.activeStep)*100}%)`),K=a=>{t.activeStep=a.key},Q=()=>{pt.confirm("离开此页面您的修改将会丢失, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{window.parent.postMessage("close"),window.close()}).catch(()=>{})};return at(async()=>{var a=N.query.id;if(a){const e=await new M().get({id:a});e.success&&(t.data.basicSetting=JSON.parse(e.data.basicContext)??{},t.data.formSetting=JSON.parse(e.data.formSetting)??{},t.data.flowSetting=JSON.parse(e.data.flowSetting)??{},t.data.model=e.data.model??{},t.data.advancedSetting=JSON.parse(e.data.advancedContext)??{})}}),(a,e)=>{const c=l("el-button"),y=l("el-result"),h=l("ele-Close"),k=l("el-icon"),_=l("el-button-group"),g=l("el-alert"),m=l("el-dialog"),S=st("auth");return i(),d("section",null,[t.isShowResult?(i(),R(y,{key:0,icon:"success",title:"提交成功","sub-title":"Please follow the instructions"},{extra:o(()=>[n(c,{type:"primary",onClick:j},{default:o(()=>[_t]),_:1})]),_:1})):p((i(),d("div",gt,[r("header",mt,[r("div",St,[r("div",{style:{"border-right":"1px solid #c5c5c5",cursor:"pointer"},onClick:Q},[n(k,null,{default:o(()=>[n(h)]),_:1})]),vt]),r("div",wt,[(i(!0),d(A,null,L(t.steps,(s,J)=>(i(),d("div",{key:J,class:ct(["step",[t.activeStep==s.key?"active":""]]),onClick:Nt=>K(s)},[r("span",yt,$(J+1),1),f(" "+$(s.label),1)],10,bt))),128)),r("div",{class:"ghost-step step",style:nt({transform:w(H)})},null,4)]),n(_,null,{default:o(()=>[n(c,{size:"small",class:"publish-btn",onClick:e[0]||(e[0]=s=>V(!1))},{default:o(()=>[ht]),_:1}),n(c,{size:"small",class:"publish-btn",onClick:e[1]||(e[1]=s=>V(!0))},{default:o(()=>[kt]),_:1})]),_:1})]),t.data?(i(),d("section",Ct,[p(n(dt,{ref_key:"basicSetting",ref:O,conf:t.data.basicSetting,tabName:"basicSetting"},null,8,["conf"]),[[b,t.activeStep==="basicSetting"]]),p(n(w(z),{ref_key:"advancedSetting",ref:F,conf:t.data.advancedSetting},null,8,["conf"]),[[b,t.activeStep==="advancedSetting"]]),p(n(w(q),{ref_key:"flowDesign",ref:E,conf:t.data.flowSetting,fields:t.fields},null,8,["conf","fields"]),[[b,t.activeStep==="flowDesign"]]),p(n(w(P),{ref_key:"formDesign",ref:B,conf:t.data.formSetting,onOk:G,tabName:"formDesign"},null,8,["conf"]),[[b,t.activeStep==="formDesign"]])])):ot("",!0)])),[[S,"api:bpm:template:publish"]]),n(m,{modelValue:a.isErrorShow,"onUpdate:modelValue":e[3]||(e[3]=s=>a.isErrorShow=s),title:"验证提示",center:""},{footer:o(()=>[r("span",xt,[n(c,{onClick:e[2]||(e[2]=s=>a.isErrorShow=!1)},{default:o(()=>[Dt]),_:1})])]),default:o(()=>[(i(!0),d(A,null,L(a.validResults,s=>(i(),R(g,{type:"error",title:s,style:{"margin-bottom":"10px"}},null,8,["title"]))),256))]),_:1},8,["modelValue"])])}}});const Pt=ft(It,[["__scopeId","data-v-1fb54232"]]);export{Pt as default};
