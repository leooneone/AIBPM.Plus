import{P as i}from"./Permission.f7fb243a.js";import{l as N}from"./tree.d5b28a07.js";import{b as v}from"./index.79e12c01.js";import{c as b}from"./cloneDeep.d5c086cd.js";import{d as f,c as R,O as V,r as P,S as p,e as K,l as S,m as n,g as m,z as l,u,x as g,L as z}from"./vue.72f2672d.js";import{_ as B}from"./_plugin-vue_export-helper.c27b6911.js";import"./http-client.193f2c5b.js";import"./index.57385bce.js";import"./index.0c380c40.js";import"./index.41e0794f.js";import"./storage.6b2e7cd0.js";import"./index.1e09e151.js";import"./index.eead254e.js";import"./_Uint8Array.e4cf923d.js";import"./_initCloneObject.7b8933bc.js";const M={class:"dialog-footer"},$=g("取 消"),A=g("确 定"),E=f({name:"admin/role/components/set-role-menu"}),O=f({...E,props:{title:{type:String,default:""}},setup(_,{expose:h}){const r=_,y=R(()=>r.title?r.title:e.roleName?`设置【${e.roleName}】菜单权限`:"设置菜单权限"),e=V({showDialog:!1,loading:!1,sureLoading:!1,permissionTreeData:[],roleId:0,roleName:"",checkedKeys:[]}),{proxy:c}=z(),d=P(),w=async()=>{const o=await new i().getRolePermissionList({roleId:e.roleId});e.checkedKeys=o!=null&&o.success?o.data:[]},k=async o=>{e.roleId=o.id,e.roleName=o.name,c.$modal.loading(),await D(),await w(),c.$modal.closeLoading(),e.showDialog=!0},x=()=>{e.showDialog=!1},D=async()=>{e.loading=!0;const o=await new i().getPermissionList();o.data&&o.data.length>0?e.permissionTreeData=N(b(o.data)):e.permissionTreeData=[],e.loading=!1},T=o=>o.row?"is-penultimate":"",L=()=>{e.showDialog=!1},C=async()=>{var a;e.sureLoading=!0;const o=(a=d.value)==null?void 0:a.getCheckedKeys(!0),t={roleId:e.roleId,permissionIds:o},s=await new i().assign(t,{showSuccessMessage:!0}).catch(()=>{e.sureLoading=!1});e.sureLoading=!1,s!=null&&s.success&&(e.showDialog=!1)};return h({open:k,close:x}),(o,t)=>{const s=p("el-button"),a=p("el-dialog");return K(),S(a,{modelValue:e.showDialog,"onUpdate:modelValue":t[0]||(t[0]=I=>e.showDialog=I),"destroy-on-close":"",title:u(y),"append-to-body":"",draggable:"",width:"780px"},{footer:n(()=>[m("span",M,[l(s,{onClick:L,size:"default"},{default:n(()=>[$]),_:1}),l(s,{type:"primary",onClick:C,size:"default",loading:e.sureLoading},{default:n(()=>[A]),_:1},8,["loading"])])]),default:n(()=>[m("div",null,[l(u(v),{ref_key:"permissionTreeRef",ref:d,data:e.permissionTreeData,"node-key":"id","show-checkbox":"","highlight-current":"","default-expand-all":"","check-on-click-node":"","expand-on-click-node":!1,props:{class:T},"default-checked-keys":e.checkedKeys},null,8,["data","props","default-checked-keys"])])]),_:1},8,["modelValue","title"])}}});const te=B(O,[["__scopeId","data-v-529fdc44"]]);export{te as default};
