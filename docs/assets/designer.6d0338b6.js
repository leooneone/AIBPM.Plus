import{_ as x}from"./preload-helper.101896b7.js";import{d as Q,a7 as Y,a6 as I,r as b,O as Z,c as tt,a9 as et,S as c,a4 as st,e as r,f as u,l as R,m as i,z as n,p as g,g as l,F as A,B as L,j as at,u as h,v as k,t as nt,x as m,ab as ot,ac as it,L as rt,I as D,n as lt,y as $}from"./vue.72f2672d.js";import{W as M}from"./WorkflowTemplate.8c5ea799.js";import ct from"./index.933d599f.js";import{x as dt}from"./index.bcf39767.js";import{_ as pt}from"./_plugin-vue_export-helper.c27b6911.js";import"./http-client.180deef4.js";import"./index.57385bce.js";import"./index.0c380c40.js";import"./index.41e0794f.js";import"./storage.6b2e7cd0.js";import"./index.eead254e.js";import"./focus-trap.c8a23a9c.js";const ft=S=>(ot("data-v-add2a5bd"),S=S(),it(),S),ut=m("关闭"),_t={key:1,class:"design-page"},gt={class:"page__header"},mt={class:"page-actions"},St=ft(()=>l("div",null,"流程设计器",-1)),vt={class:"step-tab"},yt=["onClick"],wt={class:"step-index"},bt=m("草稿"),ht=m("发布"),kt={key:0,class:"page__content"},Ct={class:"dialog-footer"},xt=m("知道了"),It=Q({__name:"designer",props:{title:{type:String,default:()=>"模板名称12"}},setup(S){const{proxy:B}=rt(),N=Y(),z=I(()=>x(()=>import("./index.b65ae8a2.js"),["assets/index.b65ae8a2.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/vue.72f2672d.js","assets/index.73f7d257.css"])),P=I(()=>x(()=>import("./index.ec0534f0.js"),["assets/index.ec0534f0.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js","assets/index.3b187802.js","assets/index.44ec5d1e.js","assets/db.cba4b16a.js","assets/index.97b0ee19.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/index.38e66f4f.css"])),U=I(()=>x(()=>import("./index.dcbff723.js"),["assets/index.dcbff723.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/index.17902be6.css"])),q=(s,e)=>{t.fields=s||[],t.conditions=e||[]},W=()=>{window.parent.postMessage("close"),window.close()},X=s=>t.data[s];D("updateFormItemList",q),D("getInitSetting",X);const O=b(null),C=b(null),E=b(null),T=b(null),t=Z({isShowResult:!1,fields:[],conditions:[],data:{name:"",formSetting:{},flowSetting:{},basicSetting:{},advancedSetting:{}},activeStep:"basicSetting",steps:[{label:"基础设置",key:"basicSetting"},{label:"表单设计",key:"formDesign"},{label:"流程设计",key:"flowDesign"},{label:"高级设置",key:"advancedSetting"}]}),V=()=>{var s=N.query.id;t.data.id=s,new M().save(t.data,{showErrorMessage:!0}).then(e=>{e.success?t.isShowResult=!0:B.$modal.msgError(e.msg)})};D("isInUseByCondition",s=>{var p;var e=(p=C.value)==null?void 0:p.getNodes();let o="";if(e){for(var _ in e){var d=e[_];d.condition&&(o+=JSON.stringify(d.condition))}return s.some(f=>o.indexOf(f)!==-1)}return!1});const J=async s=>{var f,v,y,w;var e=!0,o=await((f=E.value)==null?void 0:f.getSetting().catch(a=>{t.activeStep="basicSetting",e=!1}));if(e){var _=await((v=O.value)==null?void 0:v.getSetting().catch(a=>{t.activeStep="formDesign",e=!1}));if(e){var d=await((y=C.value)==null?void 0:y.getSetting().catch(a=>{t.activeStep="flowDesign",e=!1}));if(e){var p=await((w=T.value)==null?void 0:w.getSetting().catch(a=>{t.activeStep="advancedSetting",e=!1}));e&&(t.data.basicSetting=o,t.data.basicContext=JSON.stringify(t.data.basicSetting),t.data.advancedContext=JSON.stringify(p),t.data.flowSetting=JSON.stringify(d),t.data.formSetting=JSON.stringify(_),t.data.isPublish=s,s?B.$modal.confirm("此操作将新建或者更新流程版本, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{V()}).catch(()=>{}):V())}}}},j=s=>{t.data.formSetting=s},G=tt(()=>`translateX(${t.steps.findIndex(s=>s.key===t.activeStep)*100}%)`),H=s=>{t.activeStep=s.key},K=()=>{dt.confirm("离开此页面您的修改将会丢失, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{window.parent.postMessage("close"),window.close()}).catch(()=>{})};return et(async()=>{var s=N.query.id;if(s){const e=await new M().get({id:s});e.success&&(t.data.basicSetting=JSON.parse(e.data.basicContext)??{},t.data.formSetting=JSON.parse(e.data.formSetting)??{},t.data.flowSetting=JSON.parse(e.data.flowSetting)??{},t.data.model=e.data.model??{},t.data.advancedSetting=JSON.parse(e.data.advancedContext)??{})}}),(s,e)=>{const o=c("el-button"),_=c("el-result"),d=c("ele-Close"),p=c("el-icon"),f=c("el-button-group"),v=c("el-alert"),y=c("el-dialog"),w=st("auth");return r(),u("section",null,[t.isShowResult?(r(),R(_,{key:0,icon:"success",title:"提交成功","sub-title":"Please follow the instructions"},{extra:i(()=>[n(o,{type:"primary",onClick:W},{default:i(()=>[ut]),_:1})]),_:1})):g((r(),u("div",_t,[l("header",gt,[l("div",mt,[l("div",{style:{"border-right":"1px solid #c5c5c5",cursor:"pointer"},onClick:K},[n(p,null,{default:i(()=>[n(d)]),_:1})]),St]),l("div",vt,[(r(!0),u(A,null,L(t.steps,(a,F)=>(r(),u("div",{key:F,class:lt(["step",[t.activeStep==a.key?"active":""]]),onClick:Bt=>H(a)},[l("span",wt,$(F+1),1),m(" "+$(a.label),1)],10,yt))),128)),l("div",{class:"ghost-step step",style:at({transform:h(G)})},null,4)]),n(f,null,{default:i(()=>[n(o,{size:"small",class:"publish-btn",onClick:e[0]||(e[0]=a=>J(!1))},{default:i(()=>[bt]),_:1}),n(o,{size:"small",class:"publish-btn",onClick:e[1]||(e[1]=a=>J(!0))},{default:i(()=>[ht]),_:1})]),_:1})]),t.data?(r(),u("section",kt,[g(n(ct,{ref_key:"basicSetting",ref:E,conf:t.data.basicSetting,tabName:"basicSetting"},null,8,["conf"]),[[k,t.activeStep==="basicSetting"]]),g(n(h(z),{ref_key:"advancedSetting",ref:T,conf:t.data.advancedSetting},null,8,["conf"]),[[k,t.activeStep==="advancedSetting"]]),g(n(h(U),{ref_key:"flowDesign",ref:C,conf:t.data.flowSetting,fields:t.fields,conditions:t.conditions},null,8,["conf","fields","conditions"]),[[k,t.activeStep==="flowDesign"]]),g(n(h(P),{ref_key:"formDesign",ref:O,conf:t.data.formSetting,onOk:j,tabName:"formDesign"},null,8,["conf"]),[[k,t.activeStep==="formDesign"]])])):nt("",!0)])),[[w,"api:bpm:template:publish"]]),n(y,{modelValue:s.isErrorShow,"onUpdate:modelValue":e[3]||(e[3]=a=>s.isErrorShow=a),title:"验证提示",center:""},{footer:i(()=>[l("span",Ct,[n(o,{onClick:e[2]||(e[2]=a=>s.isErrorShow=!1)},{default:i(()=>[xt]),_:1})])]),default:i(()=>[(r(!0),u(A,null,L(s.validResults,a=>(r(),R(v,{type:"error",title:a,style:{"margin-bottom":"10px"}},null,8,["title"]))),256))]),_:1},8,["modelValue"])])}}});const Pt=pt(It,[["__scopeId","data-v-add2a5bd"]]);export{Pt as default};
