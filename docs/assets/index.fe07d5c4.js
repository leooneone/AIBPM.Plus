var J=Object.defineProperty;var G=(c,r,a)=>r in c?J(c,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[r]=a;var g=(c,r,a)=>(G(c,typeof r!="symbol"?r+"":r,a),a);import{_ as Q}from"./preload-helper.101896b7.js";import{d as T,a6 as W,r as X,O as Z,c as ee,o as te,P as oe,S as s,a4 as P,e as y,f as le,z as o,m as i,G as ie,E as ae,p as C,l as x,g as u,u as v,t as ne,y as k,x as m,L as se}from"./vue.df334614.js";import{H as re,C as b}from"./http-client.28a8ff7a.js";import{d as pe}from"./dayjs.min.0acfa903.js";import{e as I}from"./mitt.7f99bbc0.js";import{i as N}from"./test.dc379863.js";import{c as de}from"./commonFunction.e7948d09.js";import{_ as me}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.de963593.js";import"./index.390778f0.js";import"./index.4621962e.js";import"./storage.6b2e7cd0.js";import"./_commonjsHelpers.042e6b4d.js";import"./toolsValidate.7cb139e2.js";import"./formatTime.29ac8c52.js";import"./vue-i18n.cjs.89c19b83.js";import"./vue.runtime.esm-bundler.7d88586f.js";class S extends re{constructor(){super(...arguments);g(this,"getPage",(a,p={})=>this.request({path:"/api/admin/file/get-page",method:"POST",body:a,secure:!0,type:b.Json,format:"json",...p}));g(this,"delete",(a,p={})=>this.request({path:"/api/admin/file/delete",method:"POST",body:a,secure:!0,type:b.Json,...p}));g(this,"uploadFile",(a,p,e={})=>this.request({path:"/api/admin/file/upload-file",method:"POST",query:p,body:a,secure:!0,type:b.FormData,format:"json",...e}));g(this,"uploadFiles",(a,p,e={})=>this.request({path:"/api/admin/file/upload-files",method:"POST",query:p,body:a,secure:!0,type:b.FormData,format:"json",...e}))}}const ce={style:{padding:"0px 0px 8px 8px"}},fe=m(" 查询 "),ue=m(" 上传 "),_e={class:"my-flex"},ge={class:"ml10 my-flex-fill my-flex-y-center"},ye={class:"mt10",style:{"text-align":"right",margin:"0"}},he=m("复制地址"),xe=m("地址"),ve=m("下载"),ke=m("删除"),be={class:"my-flex my-flex-end",style:{"margin-top":"20px"}},Ce=T({name:"admin/file"}),Ue=T({...Ce,setup(c){const{proxy:r}=se(),a=W(()=>Q(()=>import("./file-upload.7d68d627.js"),["assets/file-upload.7d68d627.js","assets/http-client.28a8ff7a.js","assets/index.de963593.js","assets/index.390778f0.js","assets/vue.df334614.js","assets/index.4621962e.js","assets/storage.6b2e7cd0.js","assets/mitt.7f99bbc0.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/file-upload.a0283327.css"])),p=X(),e=Z({loading:!1,fileFormTitle:"",filterModel:{fileName:""},total:0,pageInput:{currentPage:1,pageSize:20},fileListData:[],fileLogsTitle:""}),{copyText:F}=de(),U=ee(()=>{let l=[];return e.fileListData.forEach(n=>{N(n.extension)&&n.linkUrl&&l.push(n.linkUrl)}),l});te(()=>{f(),I.on("refreshFile",async()=>{f()})}),oe(()=>{I.off("refreshFile")});const M=l=>pe(l).format("YYYY-MM-DD HH:mm:ss"),L=l=>U.value.indexOf(l),f=async()=>{var n,h;e.loading=!0;const l=await new S().getPage({...e.pageInput,filter:e.filterModel});e.fileListData=((n=l==null?void 0:l.data)==null?void 0:n.list)??[],e.total=((h=l.data)==null?void 0:h.total)??0,e.loading=!1},V=l=>{e.pageInput.pageSize=l,f()},O=l=>{e.pageInput.currentPage=l,f()},j=()=>{p.value.open()},B=l=>{r.$modal.confirmDelete(`确定要删除文件【${l.fileName}${l.extension}】?`).then(async()=>{await new S().delete({id:l.id},{loading:!0,showSuccessMessage:!0}),f()}).catch(()=>{})};return(l,n)=>{const h=s("el-input"),w=s("el-form-item"),_=s("el-button"),E=s("el-form"),D=s("el-card"),$=s("el-image"),d=s("el-table-column"),q=s("el-popover"),H=s("el-link"),Y=s("el-table"),A=s("el-pagination"),z=P("auth"),K=P("loading");return y(),le("div",ce,[o(D,{shadow:"never","body-style":{paddingBottom:"0"},style:{"margin-top":"8px"}},{default:i(()=>[o(E,{model:e.filterModel,inline:!0,onSubmit:n[1]||(n[1]=ie(()=>{},["stop","prevent"]))},{default:i(()=>[o(w,{prop:"name"},{default:i(()=>[o(h,{modelValue:e.filterModel.fileName,"onUpdate:modelValue":n[0]||(n[0]=t=>e.filterModel.fileName=t),placeholder:"文件名",onKeyup:ae(f,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),o(w,null,{default:i(()=>[o(_,{type:"primary",icon:"ele-Search",onClick:f},{default:i(()=>[fe]),_:1}),C((y(),x(_,{type:"primary",icon:"ele-Upload",onClick:j},{default:i(()=>[ue]),_:1})),[[z,"api:admin:file:upload-file"]])]),_:1})]),_:1},8,["model"])]),_:1}),o(D,{shadow:"never",style:{"margin-top":"8px"}},{default:i(()=>[C((y(),x(Y,{data:e.fileListData,"row-key":"id",style:{width:"100%"}},{default:i(()=>[o(d,{prop:"fileName",label:"文件名","min-width":"220"},{default:i(({row:t})=>[u("div",_e,[v(N)(t.extension)?(y(),x($,{key:0,src:t.linkUrl,"preview-src-list":v(U),"initial-index":L(t.linkUrl),lazy:!0,"hide-on-click-modal":!0,fit:"scale-down","preview-teleported":"",style:{width:"80px",height:"80px"}},null,8,["src","preview-src-list","initial-index"])):ne("",!0),u("div",ge,[u("div",null,k((t.fileName||"")+(t.extension||"")),1)])])]),_:1}),o(d,{prop:"sizeFormat",label:"大小",width:"120"}),o(d,{prop:"createdUserName",label:"上传者",width:"80"},{default:i(({row:t})=>[m(k(t.modifiedUserName||t.createdUserName||""),1)]),_:1}),o(d,{prop:"createdTime",label:"更新时间",width:"100"},{default:i(({row:t})=>[m(k(M(t.modifiedTime||t.createdTime||"")),1)]),_:1}),o(d,{prop:"providerName",label:"供应商",width:"80"}),o(d,{prop:"bucketName",label:"存储桶","min-width":"120"}),o(d,{prop:"fileDirectory",label:"目录","min-width":"120"}),o(d,{label:"操作",width:"180",fixed:"right","header-align":"center",align:"center"},{default:i(({row:t})=>[o(q,{width:220},{reference:i(()=>[o(_,{size:"small",text:"",type:"primary"},{default:i(()=>[xe]),_:1})]),default:i(()=>[u("p",null,k(t.linkUrl),1),u("div",ye,[o(_,{icon:"ele-CopyDocument",size:"small",type:"primary",onClick:R=>v(F)(t.linkUrl)},{default:i(()=>[he]),_:2},1032,["onClick"])])]),_:2},1024),o(H,{class:"my-el-link mr12 ml12",href:t.linkUrl,type:"primary",icon:"ele-Download",size:"small",underline:!1,target:"_blank"},{default:i(()=>[ve]),_:2},1032,["href"]),C((y(),x(_,{icon:"ele-Delete",size:"small",text:"",type:"danger",onClick:R=>B(t)},{default:i(()=>[ke]),_:2},1032,["onClick"])),[[z,"api:admin:file:delete"]])]),_:1})]),_:1},8,["data"])),[[K,e.loading]]),u("div",be,[o(A,{currentPage:e.pageInput.currentPage,"onUpdate:currentPage":n[2]||(n[2]=t=>e.pageInput.currentPage=t),"page-size":e.pageInput.pageSize,"onUpdate:page-size":n[3]||(n[3]=t=>e.pageInput.pageSize=t),total:e.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:V,onCurrentChange:O,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])])]),_:1}),o(v(a),{ref_key:"fileUploadRef",ref:p,title:"上传文件"},null,512)])}}});const He=me(Ue,[["__scopeId","data-v-0f1cde1f"]]);export{He as default};
