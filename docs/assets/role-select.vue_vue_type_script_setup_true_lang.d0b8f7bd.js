import{R as v}from"./Role.14cde0b3.js";import{l as C}from"./tree.d5b28a07.js";import{b as D}from"./index.6c5a2d2c.js";import{d as f,r as w,O as V,w as N,o as K,H as b,S as d,a4 as B,e as i,l as R,m as c,z as u,p as F,f as M,D as E,u as O}from"./vue.df334614.js";const z=f({name:"admin/org/menu"}),S=f({...z,props:{modelValue:{default:()=>[]},selectFirstNode:{type:Boolean,default:!1}},emits:["node-click","update:modelValue"],setup(p,{expose:m,emit:n}){const s=p,l=w(),t=V({loading:!1,filterText:"",orgTreeData:[],lastKey:0});N(()=>t.filterText,e=>{var a;(a=l.value)==null||a.filter(e)}),K(()=>{_()});const g=(e,a)=>{var o;return e?((o=a.name)==null?void 0:o.indexOf(e))!==-1:!0},k=e=>{var a;t.lastKey===e.id?(t.lastKey=0,(a=l.value)==null||a.setCurrentKey(void 0),n("node-click",null)):(t.lastKey=e.id,n("node-click",e))},h=()=>{var e;n("update:modelValue",(e=l.value)==null?void 0:e.getCheckedNodes().filter(a=>a.type===2))},_=async()=>{t.loading=!0;const e=await new v().getList();t.loading=!1,e!=null&&e.success&&e.data&&e.data.length>0?(t.orgTreeData=C(e.data),s.selectFirstNode&&b(()=>{var o;const a=t.orgTreeData[0];(o=l.value)==null||o.setCurrentKey(a.id),n("node-click",a)})):t.orgTreeData=[]};return m({orgMenuRef:l}),(e,a)=>{const o=d("el-input"),y=d("el-card"),x=B("loading");return i(),R(y,{shadow:"never",style:{"margin-top":"8px"}},{header:c(()=>[u(o,{modelValue:t.filterText,"onUpdate:modelValue":a[0]||(a[0]=r=>t.filterText=r),placeholder:"筛选部门",clearable:""},null,8,["modelValue"])]),default:c(()=>{var r;return[F((i(),M("div",null,[u(O(D),E({ref_key:"orgMenuRef",ref:l,data:t.orgTreeData,"node-key":"id",props:{children:"children",label:"name"},"filter-node-method":g,"default-expand-all":"","render-after-expand":"","expand-on-click-node":!1},e.$attrs,{"default-checked-keys":(r=s.modelValue)==null?void 0:r.map(T=>T.id),"show-checkbox":"",onNodeClick:k,onCheckChange:h}),null,16,["data","default-checked-keys"])])),[[x,t.loading]])]}),_:1})}}});export{S as _};
