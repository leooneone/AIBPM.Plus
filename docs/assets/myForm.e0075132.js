var oe=Object.defineProperty;var ae=(_,p,l)=>p in _?oe(_,p,{enumerable:!0,configurable:!0,writable:!0,value:l}):_[p]=l;var g=(_,p,l)=>(ae(_,typeof p!="symbol"?p+"":p,l),l);import{_ as I}from"./preload-helper.101896b7.js";import{e as b,c as T,n as ne,f as J}from"./data-contracts.9d84138f.js";import{H as se,C as le}from"./http-client.180deef4.js";import{d as ie,a6 as O,r as x,O as re,o as pe,S as i,a4 as de,e as r,f as R,l as u,m as n,g as A,y as v,n as ce,z as s,t as f,p as me,u as h,F as $,B as ue,x as m,L as fe,I as _e}from"./vue.72f2672d.js";import{_ as ve}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.57385bce.js";import"./index.0c380c40.js";import"./index.41e0794f.js";import"./storage.6b2e7cd0.js";class q extends se{constructor(){super(...arguments);g(this,"getState",(l,c={})=>this.request({path:"/api/bpm/workflow/get-state",method:"GET",query:l,secure:!0,format:"json",...c}));g(this,"open",(l,c={})=>this.request({path:"/api/bpm/workflow/open",method:"GET",query:l,secure:!0,format:"json",...c}));g(this,"statstics",(l={})=>this.request({path:"/api/bpm/workflow/statstics",method:"POST",secure:!0,format:"json",...l}));g(this,"submit",(l,c={})=>this.request({path:"/api/bpm/workflow/submit",method:"POST",body:l,secure:!0,type:le.Json,...c}));g(this,"getDetail",(l,c={})=>this.request({path:"/api/bpm/workflow/get-detail",method:"GET",query:l,secure:!0,...c}))}}const ye=["id"],we=m(),ge={key:0,style:{flex:"auto","background-color":"#eeeeee",padding:"5px 5px 5px 5px"}},be=m("保存"),he=m("提交"),Se=m("审批"),ke=ie({__name:"myForm",props:{},setup(_,{expose:p}){const l=O(()=>I(()=>import("./FormParser.78ecd01a.js"),["assets/FormParser.78ecd01a.js","assets/RenderPanel.vue_vue_type_script_setup_true_name_render-panel_lang.2d0cb278.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js","assets/db.cba4b16a.js","assets/_plugin-vue_export-helper.c27b6911.js"])),c=O(()=>I(()=>import("./approvePanel.249b0ded.js"),["assets/approvePanel.249b0ded.js","assets/vue.72f2672d.js"])),B=O(()=>I(()=>import("./optionalPanel.8753a3bc.js"),["assets/optionalPanel.8753a3bc.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js"])),L=x(),V=x(),E=x(),{proxy:P}=fe(),F={id:void 0,data:[],model:{},activity:{}},e=re({drawerSize:"390px",title:"表单标题",isShow:!1,loading:!1,submitLoading:!1,curTab:"form",isShowApprove:!1,optional:[],conf:JSON.parse(JSON.stringify(F))}),j=t=>["已取消","已完成"].includes(b[t.state])?t.state===ne.已完成?t.approvalResult===J.True?"同意 "+t.finishTime:t.approvalResult===J.False?"不同意 "+t.finishTime:"完成于 "+t.finishTime:b[t.state]+t.finishTime:b[t.state],N=t=>{if(T[t.state&127])return T[t.state&127].toLowerCase()},G=t=>{if(b[t.state]==="已完成"){if(t.approvalResult==="1")return"ele-CircleCheck";if(t.approvalResult==="-1")return"";if(t.approvalResult==="0")return"ele-CircleClose"}else return"ele-Loading"},S=t=>{L.value.submitForm(async o=>{var d={workItemId:e.conf.workItemId,instanceId:e.conf.instanceId,templateId:e.conf.templateId,type:e.conf.type,form:o,comment:"",activityCode:e.conf.activity.id,approvalResult:void 0,isSaveOnly:!1};e.submitLoading=!0,t&&Object.assign(d,t);var y=await new q().submit(d,{showErrorMessage:!1});y.success?(P.$modal.msgSuccess("提交成功"),e.isShow=!1):y.code==="-1"?(H(),e.optional=y.data.optional||{range:[]}):P.$modal.msgError(y.msg),e.submitLoading=!1})};_e("submitForm",S);const M=()=>{V.value.open()},H=()=>{E.value.open()},U=async t=>{e.loading=!0,e.conf=JSON.parse(JSON.stringify(F));const o=await new q().open(t);if(o.success){var d=JSON.parse(o.data.form);e.conf.id=t.id,e.conf.type=t.type,e.conf.templateId=t.templateId,e.conf.workItemId=t.workItemId,e.conf.instanceId=t.instanceId,e.conf.data=d.formItems??{},o.data.model&&(e.conf.model=JSON.parse(o.data.model)),e.conf.activity=o.data.activity??{},e.conf.items=o.data.items??[],e.conf.approveSetting=o.data.approveSetting??{},e.isShow=!0,console.log("modelAA",e.conf.model)}e.loading=!1};return pe(()=>{}),p({open:U}),(t,o)=>{const d=i("el-button"),y=i("el-button-group"),k=i("el-tab-pane"),z=i("el-tag"),W=i("el-timeline-item"),K=i("el-timeline"),D=i("tempate"),w=i("el-table-column"),Q=i("el-table"),X=i("el-tabs"),Y=i("el-drawer"),Z=de("loading");return r(),R($,null,[e.isShow?(r(),u(Y,{key:0,modelValue:e.isShow,"onUpdate:modelValue":o[7]||(o[7]=a=>e.isShow=a),direction:"rtl",size:e.drawerSize},{header:n(({close:a,titleId:C,titleClass:ee})=>[A("h4",{id:C,class:ce(ee)},v(e.title),11,ye),s(y,null,{default:n(()=>[s(d,{onClick:o[0]||(o[0]=te=>e.drawerSize="390px"),icon:"ele-Cellphone",title:"手机"}),s(d,{onClick:o[1]||(o[1]=te=>e.drawerSize="100%"),icon:"ele-Monitor",title:"电脑"})]),_:1})]),footer:n(()=>[e.conf.activity.type?(r(),R("div",ge,[e.conf.activity.type!=="Copy"?(r(),u(d,{key:0,type:"warning",plain:"",onClick:o[3]||(o[3]=a=>S({isSaveOnly:!0}))},{default:n(()=>[be]),_:1})):f("",!0),["Start","Deal"].includes(e.conf.activity.type)?(r(),u(d,{key:1,type:"success",loading:e.submitLoading,plain:"",onClick:o[4]||(o[4]=a=>S())},{default:n(()=>[he]),_:1},8,["loading"])):f("",!0),f("",!0),e.conf.activity.type==="Approve"?(r(),u(d,{key:3,type:"success",plain:"",onClick:o[6]||(o[6]=a=>M())},{default:n(()=>[Se]),_:1})):f("",!0)])):f("",!0)]),default:n(()=>[me((r(),u(X,{modelValue:e.curTab,"onUpdate:modelValue":o[2]||(o[2]=a=>e.curTab=a),type:"border-card",class:"my-tabs"},{default:n(()=>[s(k,{name:"form",label:"表单内容"},{default:n(()=>[s(h(l),{conf:e.conf,ref_key:"formRef",ref:L,loading:e.submitLoading},null,8,["conf","loading"])]),_:1}),e.conf.items.length>0?(r(),u(k,{key:0,name:"record",label:"审批记录"},{default:n(()=>[s(D,null,{default:n(()=>[s(K,null,{default:n(()=>[(r(!0),R($,null,ue(e.conf.items,(a,C)=>(r(),u(W,{size:"large",key:C,type:N(a),icon:G(a),timestamp:a.startTime},{default:n(()=>[A("h4",null,v(a.title),1),A("p",null,[m(v(a.participant)+" ",1),s(z,{type:N(a)},{default:n(()=>[m(v(j(a)),1)]),_:2},1032,["type"])]),m(" "+v(a.comment),1)]),_:2},1032,["type","icon","timestamp"]))),128))]),_:1})]),_:1})]),_:1})):f("",!0),e.conf.items.length>0?(r(),u(k,{key:1,name:"history",label:"审批历史"},{default:n(()=>[s(D,null,{default:n(()=>[s(Q,{data:e.conf.items},{default:n(()=>[s(w,{prop:"title",label:"名称","show-overflow-tooltip":"",width:"120"}),s(w,{prop:"name",label:"操作人","show-overflow-tooltip":"",width:"120"}),s(w,{prop:"startTime",label:"开始时间","show-overflow-tooltip":"",width:"120"}),s(w,{prop:"finishTime",label:"完成时间","show-overflow-tooltip":"",width:"120"},{default:n(({row:a})=>[m(v(["已取消","已完成"].includes(h(b)[a.state])?a.finishTime:""),1)]),_:1}),s(w,{prop:"state",label:"状态","show-overflow-tooltip":"",width:"120"},{default:n(({row:a})=>[s(z,{"disable-transitions":"",type:h(T)[a.state&127].toLowerCase()},{default:n(()=>[m(v(h(b)[a.state]),1)]),_:2},1032,["type"])]),_:1}),we,s(w,{prop:"comment",label:"意见","show-overflow-tooltip":"",width:"120"})]),_:1},8,["data"])]),_:1})]),_:1})):f("",!0)]),_:1},8,["modelValue"])),[[Z,e.loading]])]),_:1},8,["modelValue","size"])):f("",!0),s(h(c),{"approve-setting":e.conf.approveSetting,ref_key:"approvePanelRef",ref:V},null,8,["approve-setting"]),s(h(B),{ref_key:"optionalPanelRef",ref:E,optional:e.optional},null,8,["optional"])],64)}}});const Pe=ve(ke,[["__scopeId","data-v-d3a67020"]]);export{Pe as default};
