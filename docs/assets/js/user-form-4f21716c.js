import{_ as H}from"./ai-form-7f0c78d7.js";import{V as c,e as W,M as J,U as K,P as I,W as Q}from"./index-aa73a18b.js";import{t as X,a as Y,b as Z}from"./test-160dfe48.js";import{j as ee}from"./lodash-es-f559e892.js";import{k,h as le,e as h,l as oe,ah as ae,j as y,f as v,m,o as f,c as D,p as o,y as t,a as U,G as _,u as s,F as te,H as re,D as T,x as se,R as de}from"./@vue-8306d5ee.js";import"./element-plus-e21f9b5a.js";import"./@vueuse-245b213e.js";import"./@element-plus-8ef115d9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-97457aaf.js";import"./@intlify-869ec77a.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";import"./pinia-e84f6aa2.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-c9c3da21.js";import"./vue-i18n-86a71ef1.js";import"./vue-27cbb85a.js";import"./js-cookie-edb2da2a.js";import"./nprogress-b96aa312.js";import"./axios-21b846bc.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-9f938aef.js";const me={class:"my-flex-y-center"},ne={class:"dialog-footer"},ie=k({name:"admin/user/form"}),Ee=k({...ie,props:{title:{type:String,default:""}},setup(L,{expose:N}){const C=de(()=>H(()=>import("./my-select-user-2710a743.js"),["assets/js/my-select-user-2710a743.js","assets/js/ai-form-7f0c78d7.js","assets/js/@vue-8306d5ee.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css"])),{proxy:g}=le(),R=h(),b=h(),e=oe({showDialog:!1,sureLoading:!1,form:{orgIds:[],roleIds:[]},orgs:[],orgTreeData:[],roleTreeData:[]}),{form:d}=ae(e),V=y(()=>e.form.id>0),p=y(()=>V.value?12:24);v(()=>e.form.orgIds,a=>{if(a&&a.length>0){let l=[];J(ee(e.orgTreeData)).forEach(u=>{a.some(n=>u.id===n)&&l.push(u)}),e.orgs=l}else e.orgs=[]},{immediate:!0}),v(()=>e.orgs,()=>{var a;(a=e.orgs)!=null&&a.some(l=>l.id===e.form.orgId)||(e.form.orgId=e.orgs&&e.orgs.length>0?e.orgs[0].id:void 0)},{immediate:!0,deep:!0});const S=async()=>{const a=await new K().getList().catch(()=>{e.orgTreeData=[]});a!=null&&a.success&&a.data&&a.data.length>0?e.orgTreeData=I(a.data):e.orgTreeData=[]},M=async()=>{const a=await new Q().getList().catch(()=>{e.roleTreeData=[]});a!=null&&a.success&&a.data&&a.data.length>0?e.roleTreeData=I(a.data):e.roleTreeData=[]},B=async a=>{if(g.$modal.loading(),await S(),await M(),a.id>0){const l=await new c().get({id:a.id}).catch(()=>{g.$modal.closeLoading()});l!=null&&l.success&&(e.form=l.data)}else e.form={orgIds:a.orgIds,orgId:a.orgId,roleIds:[],staff:{}};g.$modal.closeLoading(),e.showDialog=!0},q=()=>{!e.form.userName&&e.form.mobile&&Z(e.form.mobile)&&(e.form.userName=e.form.mobile)},A=()=>{e.showDialog=!1},E=()=>{b.value.validate(async a=>{if(!a)return;e.sureLoading=!0;let l={};e.form.id!=null&&e.form.id>0?l=await new c().update(e.form,{showSuccessMessage:!0}).catch(()=>{e.sureLoading=!1}):l=await new c().add(e.form,{showSuccessMessage:!0}).catch(()=>{e.sureLoading=!1}),e.sureLoading=!1,l!=null&&l.success&&(W.emit("refreshUser"),e.showDialog=!1)})};return N({open:B}),(a,l)=>{const u=m("el-input"),n=m("el-form-item"),i=m("el-col"),w=m("el-tree-select"),z=m("el-option"),F=m("el-select"),O=m("SvgIcon"),P=m("el-tooltip"),$=m("el-row"),j=m("el-form"),x=m("el-button"),G=m("el-dialog");return f(),D("div",null,[o(G,{modelValue:e.showDialog,"onUpdate:modelValue":l[9]||(l[9]=r=>e.showDialog=r),"destroy-on-close":"",title:L.title,draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"769px"},{footer:t(()=>[U("span",ne,[o(x,{onClick:A,size:"default"},{default:t(()=>[_("取 消")]),_:1}),o(x,{type:"primary",onClick:E,size:"default",loading:e.sureLoading},{default:t(()=>[_("确 定")]),_:1},8,["loading"])])]),default:t(()=>[o(j,{ref_key:"formRef",ref:b,model:s(d),size:"default","label-width":"80px"},{default:t(()=>[o($,{gutter:35},{default:t(()=>[o(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"姓名",prop:"name",rules:[{required:!0,message:"请输入姓名",trigger:["blur","change"]}]},{default:t(()=>[o(u,{modelValue:s(d).name,"onUpdate:modelValue":l[0]||(l[0]=r=>s(d).name=r),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),o(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"手机号",prop:"mobile",rules:[{required:!0,message:"请输入手机号",trigger:["blur","change"]},{validator:s(X),trigger:["blur","change"]}]},{default:t(()=>[o(u,{modelValue:s(d).mobile,"onUpdate:modelValue":l[1]||(l[1]=r=>s(d).mobile=r),autocomplete:"off",maxlength:"11",onBlur:q},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),o(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"部门",prop:"orgIds",rules:[{required:!0,message:"请选择部门",trigger:["change"]}]},{default:t(()=>[o(w,{ref_key:"orgTreeSelectRef",ref:R,modelValue:s(d).orgIds,"onUpdate:modelValue":l[2]||(l[2]=r=>s(d).orgIds=r),placeholder:"请选择部门",data:e.orgTreeData,"node-key":"id",props:{label:"name"},"check-strictly":"","default-expand-all":"","render-after-expand":"","fit-input-width":"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",class:"w100"},null,8,["modelValue","data"])]),_:1})]),_:1}),o(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"主属部门",prop:"orgId",rules:[{required:!0,message:"请选择主属部门",trigger:["change"]}]},{default:t(()=>[o(F,{modelValue:s(d).orgId,"onUpdate:modelValue":l[3]||(l[3]=r=>s(d).orgId=r),placeholder:"请选择主属部门",class:"w100"},{default:t(()=>[(f(!0),D(te,null,re(e.orgs,r=>(f(),T(z,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"账号",prop:"userName",rules:[{required:!0,message:"请输入账号",trigger:["blur","change"]}]},{default:t(()=>[o(u,{modelValue:s(d).userName,"onUpdate:modelValue":l[4]||(l[4]=r=>s(d).userName=r),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),V.value?se("",!0):(f(),T(i,{key:0,xs:12,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{prop:"password"},{label:t(()=>[U("div",me,[_(" 密码"),o(P,{effect:"dark",content:"选填，不填则使用系统默认密码",placement:"top","hide-after":"0"},{default:t(()=>[o(O,{name:"ele-InfoFilled",class:"ml5"})]),_:1})])]),default:t(()=>[o(u,{key:"password",modelValue:s(d).password,"onUpdate:modelValue":l[5]||(l[5]=r=>s(d).password=r),"show-password":"",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1})),o(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"直属主管",prop:"managerUserId"},{default:t(()=>[o(s(C),{modelValue:s(d).managerUserId,"onUpdate:modelValue":l[6]||(l[6]=r=>s(d).managerUserId=r),name:s(d).managerUserName,clearable:""},null,8,["modelValue","name"])]),_:1})]),_:1}),o(i,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"角色",prop:"roles"},{default:t(()=>[o(w,{modelValue:s(d).roleIds,"onUpdate:modelValue":l[7]||(l[7]=r=>s(d).roleIds=r),placeholder:"请选择角色",data:e.roleTreeData,"node-key":"id",props:{label:"name"},"default-expand-all":"","render-after-expand":"","fit-input-width":"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",class:"w100"},null,8,["modelValue","data"])]),_:1})]),_:1}),o(i,{xs:24,sm:p.value,md:p.value,lg:p.value,xl:p.value},{default:t(()=>[o(n,{label:"邮箱",prop:"email",rules:[{validator:s(Y),trigger:["blur","change"]}]},{default:t(()=>[o(u,{modelValue:s(d).email,"onUpdate:modelValue":l[8]||(l[8]=r=>s(d).email=r),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["sm","md","lg","xl"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{Ee as default};
