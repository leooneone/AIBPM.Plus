var J=Object.defineProperty;var K=(k,p,t)=>p in k?J(k,p,{enumerable:!0,configurable:!0,writable:!0,value:t}):k[p]=t;var m=(k,p,t)=>(K(k,typeof p!="symbol"?p+"":p,t),t);import{_ as N}from"./ai-form-3baf0d65.js";import{k as z,h as U,e as H,l as G,i as F,m as g,$,o as u,c as Q,p as s,y as i,Y as W,am as X,G as h,M as b,D as f,x as C,a as Z,u as ee,R as te}from"./@vue-8306d5ee.js";import{J as ae,K as S}from"./index-0ce5277f.js";import{d as oe}from"./dayjs-97457aaf.js";import"./element-plus-e21f9b5a.js";import"./lodash-es-f559e892.js";import"./@vueuse-245b213e.js";import"./@element-plus-8ef115d9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./@intlify-869ec77a.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";import"./pinia-e84f6aa2.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-c9c3da21.js";import"./vue-i18n-86a71ef1.js";import"./vue-27cbb85a.js";import"./js-cookie-edb2da2a.js";import"./nprogress-b96aa312.js";import"./axios-21b846bc.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-9f938aef.js";class w extends ae{constructor(){super(...arguments);m(this,"get",(t,n={})=>this.request({path:"/api/admin/task/get",method:"GET",query:t,secure:!0,format:"json",...n}));m(this,"getPage",(t,n={})=>this.request({path:"/api/admin/task/get-page",method:"POST",body:t,secure:!0,type:S.Json,format:"json",...n}));m(this,"add",(t,n={})=>this.request({path:"/api/admin/task/add",method:"POST",body:t,secure:!0,type:S.Json,format:"json",...n}));m(this,"update",(t,n={})=>this.request({path:"/api/admin/task/update",method:"PUT",body:t,secure:!0,type:S.Json,...n}));m(this,"pause",(t,n={})=>this.request({path:"/api/admin/task/pause",method:"POST",query:t,secure:!0,...n}));m(this,"resume",(t,n={})=>this.request({path:"/api/admin/task/resume",method:"POST",query:t,secure:!0,...n}));m(this,"run",(t,n={})=>this.request({path:"/api/admin/task/run",method:"POST",query:t,secure:!0,...n}));m(this,"delete",(t,n={})=>this.request({path:"/api/admin/task/delete",method:"DELETE",query:t,secure:!0,...n}))}}const se={class:"my-layout"},ne={class:"my-flex my-flex-end",style:{"margin-top":"20px"}},ie=z({name:"admin/task"}),Me=z({...ie,setup(k){const p=te(()=>N(()=>import("./task-logs-9f445f37.js"),["assets/js/task-logs-9f445f37.js","assets/js/index-0ce5277f.js","assets/js/@vue-8306d5ee.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-3baf0d65.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/css/task-logs-c2d19c46.css"])),{proxy:t}=U(),n=H(),o=G({loading:!1,taskFormTitle:"",filter:{topic:""},total:0,pageInput:{currentPage:1,pageSize:20},taskListData:[],taskLogsTitle:""});F(()=>{d()});const R=(e,l,_)=>{let c="";switch(_){case 1:case"SEC":c="按秒触发";break;case 11:case"RunOnDay":c="每天";break;case 12:case"RunOnWeek":c="每星期几";break;case 13:case"RunOnMonth":c="每月第几天";break;case 21:case"Custom":c="自定义";break}return c},x=(e,l,_)=>oe(_).format("YYYY-MM-DD HH:mm:ss"),d=async()=>{var l,_;o.loading=!0,o.pageInput.filter=o.filter;const e=await new w().getPage(o.pageInput).catch(()=>{o.loading=!1});o.taskListData=((l=e==null?void 0:e.data)==null?void 0:l.list)??[],o.total=((_=e==null?void 0:e.data)==null?void 0:_.total)??0,o.loading=!1},I=e=>{o.taskLogsTitle=`${e.topic}${e.id}运行日志`,n.value.open(e)},L=e=>{t.$modal.confirmDelete(`确定要运行【${e.topic}】任务?`).then(async()=>{await new w().run({id:e.id},{loading:!0,showSuccessMessage:!0}),d()}).catch(()=>{})},M=e=>{t.$modal.confirmDelete(`确定要暂停【${e.topic}】任务?`).then(async()=>{await new w().pause({id:e.id},{loading:!0,showSuccessMessage:!0}),d()}).catch(()=>{})},O=e=>{t.$modal.confirmDelete(`确定要启动【${e.topic}】任务?`).then(async()=>{await new w().resume({id:e.id},{loading:!0,showSuccessMessage:!0}),d()}).catch(()=>{})},V=e=>{t.$modal.confirmDelete(`确定要删除【${e.topic}】任务?`).then(async()=>{await new w().delete({id:e.id},{loading:!0,showSuccessMessage:!0}),d()}).catch(()=>{})},q=e=>{o.pageInput.pageSize=e,d()},E=e=>{o.pageInput.currentPage=e,d()};return(e,l)=>{const _=g("el-input"),c=g("el-form-item"),y=g("el-button"),j=g("el-form"),D=g("el-card"),r=g("el-table-column"),T=g("el-tag"),B=g("el-table"),Y=g("el-pagination"),v=$("auth"),A=$("loading");return u(),Q("div",se,[s(D,{class:"mt8",shadow:"never","body-style":{paddingBottom:"0"}},{default:i(()=>[s(j,{inline:!0,onSubmit:l[1]||(l[1]=W(()=>{},["stop","prevent"]))},{default:i(()=>[s(c,null,{default:i(()=>[s(_,{modelValue:o.filter.topic,"onUpdate:modelValue":l[0]||(l[0]=a=>o.filter.topic=a),placeholder:"任务名称",onKeyup:X(d,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),s(c,null,{default:i(()=>[s(y,{type:"primary",icon:"ele-Search",onClick:d},{default:i(()=>[h(" 查询 ")]),_:1})]),_:1})]),_:1})]),_:1}),s(D,{class:"my-fill mt8",shadow:"never"},{default:i(()=>[b((u(),f(B,{data:o.taskListData,"row-key":"id",style:{width:"100%"}},{default:i(()=>[s(r,{prop:"id",label:"任务编号",width:"126"}),s(r,{prop:"topic",label:"任务名称","min-width":"120","show-overflow-tooltip":""}),s(r,{prop:"status",label:"任务状态",width:"80"},{default:i(({row:a})=>[a.status===0||a.status==="Running"?(u(),f(T,{key:0,"disable-transitions":""},{default:i(()=>[h("运行中")]),_:1})):C("",!0),a.status===1||a.status==="Paused"?(u(),f(T,{key:1,type:"info","disable-transitions":""},{default:i(()=>[h("暂停")]),_:1})):C("",!0),a.status===2||a.status==="Completed"?(u(),f(T,{key:2,type:"success","disable-transitions":""},{default:i(()=>[h("完成")]),_:1})):C("",!0)]),_:1}),s(r,{prop:"round",label:"运行次数",width:"80"}),s(r,{prop:"currentRound",label:"当前次数",width:"80"}),s(r,{prop:"errorTimes",label:"失败次数",width:"80"}),s(r,{prop:"body",label:"任务数据","min-width":"180","show-overflow-tooltip":""}),s(r,{prop:"interval",label:"定时类型",width:"100",formatter:R}),s(r,{prop:"intervalArgument",label:"定时参数","min-width":"180"}),s(r,{prop:"createTime",label:"创建时间",formatter:x,width:"100"}),s(r,{prop:"lastRunTime",label:"最后运行时间",formatter:x,width:"120"}),s(r,{label:"操作",width:"180",fixed:"right","header-align":"center",align:"center"},{default:i(({row:a})=>[b((u(),f(y,{icon:"ele-Tickets",size:"small",text:"",type:"primary",onClick:P=>I(a)},{default:i(()=>[h("日志")]),_:2},1032,["onClick"])),[[v,"api:admin:task-log:get-page"]]),a.status===1||a.status==="Paused"?b((u(),f(y,{key:0,icon:"ele-VideoPause",size:"small",text:"",type:"primary",onClick:P=>M(a)},{default:i(()=>[h("暂停")]),_:2},1032,["onClick"])),[[v,"api:admin:task:pause"]]):C("",!0),a.status===0||a.status==="Running"?b((u(),f(y,{key:1,icon:"ele-CaretRight",size:"small",text:"",type:"primary",onClick:P=>O(a)},{default:i(()=>[h("启动")]),_:2},1032,["onClick"])),[[v,"api:admin:task:resume"]]):C("",!0),b((u(),f(y,{icon:"ele-Promotion",size:"small",text:"",type:"primary",onClick:P=>L(a)},{default:i(()=>[h("执行")]),_:2},1032,["onClick"])),[[v,"api:admin:task:run"]]),b((u(),f(y,{icon:"ele-Delete",size:"small",text:"",type:"danger",onClick:P=>V(a)},{default:i(()=>[h("删除")]),_:2},1032,["onClick"])),[[v,"api:admin:task:delete"]])]),_:1})]),_:1},8,["data"])),[[A,o.loading]]),Z("div",ne,[s(Y,{currentPage:o.pageInput.currentPage,"onUpdate:currentPage":l[2]||(l[2]=a=>o.pageInput.currentPage=a),"page-size":o.pageInput.pageSize,"onUpdate:pageSize":l[3]||(l[3]=a=>o.pageInput.pageSize=a),total:o.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:q,onCurrentChange:E,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])])]),_:1}),s(ee(p),{ref_key:"taskLogsRef",ref:n,title:o.taskLogsTitle},null,8,["title"])])}}});export{Me as default};
