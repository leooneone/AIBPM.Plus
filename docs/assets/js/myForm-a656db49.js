var le=Object.defineProperty;var se=(w,c,l)=>c in w?le(w,c,{enumerable:!0,configurable:!0,writable:!0,value:l}):w[c]=l;var g=(w,c,l)=>(se(w,typeof c!="symbol"?c+"":c,l),l);import{_ as O}from"./ai-form-3baf0d65.js";import{k as ie,e as P,h as pe,l as me,C as ce,i as de,m as p,$ as fe,o as s,c as k,D as _,y as n,a as b,v as d,I as ue,p as r,G as y,x as m,M as Y,F as H,H as _e,u as v,N as ye,R as V}from"./@vue-8306d5ee.js";import{c as A,e as B}from"./data-contracts-a56545c2.js";import{H as we,C as ve}from"./http-client-2f8e2141.js";import{W as he}from"./WorkflowTemplate-ef95fa2a.js";import{d as T}from"./dayjs-97457aaf.js";import{_ as ge}from"./index-1c0db287.js";import"./element-plus-e21f9b5a.js";import"./lodash-es-f559e892.js";import"./@vueuse-245b213e.js";import"./@element-plus-8ef115d9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./@intlify-869ec77a.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";import"./axios-21b846bc.js";import"./pinia-e84f6aa2.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-c9c3da21.js";import"./vue-i18n-86a71ef1.js";import"./vue-27cbb85a.js";import"./js-cookie-edb2da2a.js";import"./nprogress-b96aa312.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-9f938aef.js";class j extends we{constructor(){super(...arguments);g(this,"getState",(l,f={})=>this.request({path:"/api/bpm/workflow/get-state",method:"GET",query:l,secure:!0,format:"json",...f}));g(this,"open",(l,f={})=>this.request({path:"/api/bpm/workflow/open",method:"GET",query:l,secure:!0,format:"json",...f}));g(this,"statstics",(l={})=>this.request({path:"/api/bpm/workflow/statstics",method:"POST",secure:!0,format:"json",...l}));g(this,"submit",(l,f={})=>this.request({path:"/api/bpm/workflow/submit",method:"POST",body:l,secure:!0,type:ve.Json,...f}));g(this,"getDetail",(l,f={})=>this.request({path:"/api/bpm/workflow/get-detail",method:"GET",query:l,secure:!0,...f}))}}const be=["id"],ke={key:0},Se={key:1},Ce={key:0,style:{flex:"auto","background-color":"#eeeeee",padding:"5px 5px 5px 5px"}},Te=ie({__name:"myForm",setup(w,{expose:c}){const l=V(()=>O(()=>import("./approvePanel-95c85544.js"),["assets/js/approvePanel-95c85544.js","assets/js/@vue-8306d5ee.js"])),f=V(()=>O(()=>import("./optionalPanel-13ff1af9.js"),["assets/js/optionalPanel-13ff1af9.js","assets/js/@vue-8306d5ee.js"])),q=V(()=>O(()=>import("./flowChart-052ea0a0.js"),["assets/js/flowChart-052ea0a0.js","assets/js/lodash-a8362e0e.js","assets/js/@intlify-869ec77a.js","assets/js/element-plus-e21f9b5a.js","assets/js/@vue-8306d5ee.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js"])),N=P(),R=P(),E=P(),{proxy:F}=pe(),L={id:void 0,data:[],model:{},activity:{}},e=me({drawerSize:"390px",title:"表单标题",isShow:!1,loading:!1,submitLoading:!1,curTab:"form",isShowApprove:!1,optional:[],conf:JSON.parse(JSON.stringify(L)),chartData:null}),G=a=>B[a.state],z=a=>{if(A[a.state&127])return A[a.state&127].toLowerCase()},I=a=>T(a).format("YYYY-MM-DD HH:mm:ss"),$=(a,o,i)=>T(i).format("YYYY-MM-DD HH:mm:ss"),W=a=>{var o=a.state&127;switch(o){case 6:return"ele-CircleClose";case 3:return"ele-CircleCheck"}return"ele-Loading"},D=a=>{N.value.submitForm(async o=>{var i={workItemId:e.conf.workItemId,instanceId:e.conf.instanceId,templateId:e.conf.templateId,type:e.conf.type,form:o,comment:"",activityCode:e.conf.activity.id,approvalResult:void 0,isSaveOnly:!1};e.submitLoading=!0,a&&Object.assign(i,a);var u=await new j().submit(i,{showErrorMessage:!1});u.success?(F.$modal.msgSuccess("提交成功"),e.isShow=!1):u.code==="-1"?(K(i),e.optional=u.data.optional||{range:[]}):F.$modal.msgError(u.msg),e.submitLoading=!1})};ce("submitForm",D);const U=()=>{R.value.open()},K=a=>{E.value.open(a)},Q=async a=>{var S;e.loading=!0,e.conf=JSON.parse(JSON.stringify(L));const o=await new j().open(a);if(o.success){var i=JSON.parse(o.data.form);e.conf.id=a.id,e.conf.type=a.type,e.conf.templateId=a.templateId,e.conf.workItemId=a.workItemId,e.conf.instanceId=a.instanceId,e.conf.data=i.formItems??{},o.data.model&&(e.conf.model=JSON.parse(o.data.model)),e.conf.activity=o.data.activity??{},e.conf.items=o.data.items??[],e.conf.approveSetting=o.data.approveSetting??{},e.isShow=!0}e.chartData=null;var u=await new he().get({id:e.conf.templateId});u.success&&(e.chartData=JSON.parse((S=u.data)==null?void 0:S.flowSetting).chartData),e.loading=!1};return de(()=>{}),c({open:Q}),(a,o)=>{const i=p("el-button"),u=p("el-button-group"),S=p("AiFormParser"),C=p("el-tab-pane"),J=p("el-tag"),X=p("el-timeline-item"),Z=p("el-timeline"),M=p("tempate"),h=p("el-table-column"),ee=p("el-table"),te=p("el-tabs"),oe=p("el-drawer"),ae=fe("loading");return s(),k(H,null,[e.isShow?(s(),_(oe,{key:0,modelValue:e.isShow,"onUpdate:modelValue":o[7]||(o[7]=t=>e.isShow=t),direction:"rtl",size:e.drawerSize},{header:n(({close:t,titleId:x,titleClass:ne})=>[b("h4",{id:x,class:ue(ne)},d(e.title),11,be),r(u,null,{default:n(()=>[r(i,{onClick:o[0]||(o[0]=re=>e.drawerSize="390px"),icon:"ele-Cellphone",title:"手机"}),r(i,{onClick:o[1]||(o[1]=re=>e.drawerSize="100%"),icon:"ele-Monitor",title:"电脑"})]),_:1})]),footer:n(()=>[e.conf.activity.type?(s(),k("div",Ce,[e.conf.activity.type!=="Copy"?(s(),_(i,{key:0,type:"warning",plain:"",onClick:o[3]||(o[3]=t=>D({isSaveOnly:!0}))},{default:n(()=>[y("保存")]),_:1})):m("",!0),["Start","Deal"].includes(e.conf.activity.type)?(s(),_(i,{key:1,type:"success",loading:e.submitLoading,plain:"",onClick:o[4]||(o[4]=t=>D())},{default:n(()=>[y("提交")]),_:1},8,["loading"])):m("",!0),m("",!0),e.conf.activity.type==="Approve"?(s(),_(i,{key:3,type:"success",plain:"",onClick:o[6]||(o[6]=t=>U())},{default:n(()=>[y("审批")]),_:1})):m("",!0)])):m("",!0)]),default:n(()=>[Y((s(),_(te,{modelValue:e.curTab,"onUpdate:modelValue":o[2]||(o[2]=t=>e.curTab=t),type:"border-card",class:"my-tabs"},{default:n(()=>[r(C,{name:"form",label:"表单内容"},{default:n(()=>[r(S,{conf:e.conf,ref_key:"formRef",ref:N,loading:e.submitLoading},null,8,["conf","loading"])]),_:1}),e.conf.items.length>0?(s(),_(C,{key:0,name:"record",label:"审批记录"},{default:n(()=>[r(M,null,{default:n(()=>[r(Z,{style:{"font-size":"0.8em"}},{default:n(()=>[(s(!0),k(H,null,_e(e.conf.items,(t,x)=>(s(),_(X,{key:x,type:z(t),icon:W(t)},{default:n(()=>[b("h5",null,d(t.title),1),b("p",null,"开始时间: "+d(I(t.startTime)),1),b("p",null,"参与人员："+d(t.participant),1),v(T)(t.finishTime).year()>2020?(s(),k("p",ke," 完成时间："+d(I(t.finishTime)),1)):m("",!0),b("p",null,[y(" 处理结果： "),r(J,{type:z(t)},{default:n(()=>[y(d(G(t)),1)]),_:2},1032,["type"])]),t.comment?(s(),k("p",Se," 处理意见："+d(t.comment),1)):m("",!0)]),_:2},1032,["type","icon"]))),128))]),_:1})]),_:1})]),_:1})):m("",!0),e.conf.items.length>0?(s(),_(C,{key:1,name:"history",label:"审批历史"},{default:n(()=>[r(M,null,{default:n(()=>[r(ee,{data:e.conf.items,style:{"font-size":"0.9em"}},{default:n(()=>[r(h,{prop:"title",label:"名称","show-overflow-tooltip":"",width:"120"}),r(h,{prop:"name",label:"操作人","show-overflow-tooltip":"",width:"120"}),r(h,{prop:"startTime",label:"开始时间","show-overflow-tooltip":"",width:"120",formatter:$}),r(h,{prop:"finishTime",label:"完成时间","show-overflow-tooltip":"",width:"120",formatter:$},{default:n(({row:t})=>[Y(b("span",null,d(I(t.finishTime)),513),[[ye,v(T)(t.finishTime).year()>2020]])]),_:1}),r(h,{prop:"state",label:"状态","show-overflow-tooltip":"",width:"120"},{default:n(({row:t})=>[r(J,{"disable-transitions":"",type:v(A)[t.state&127].toLowerCase()},{default:n(()=>[y(d(v(B)[t.state]),1)]),_:2},1032,["type"])]),_:1}),y(),r(h,{prop:"comment",label:"意见","show-overflow-tooltip":"",width:"120"},{default:n(({row:t})=>[y(d(t.comment),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})):m("",!0),e.chartData?(s(),_(C,{key:2,name:"chart",label:"流程图"},{default:n(()=>[r(v(q),{ref:"flowChartPanelRef",data:e.chartData},null,8,["data"])]),_:1})):m("",!0)]),_:1},8,["modelValue"])),[[ae,e.loading]])]),_:1},8,["modelValue","size"])):m("",!0),r(v(l),{"approve-setting":e.conf.approveSetting,ref_key:"approvePanelRef",ref:R},null,8,["approve-setting"]),r(v(f),{ref_key:"optionalPanelRef",ref:E,optional:e.optional},null,8,["optional"])],64)}}});const ot=ge(Te,[["__scopeId","data-v-a16d313b"]]);export{ot as default};
