import{_ as P}from"./ai-form-3baf0d65.js";import{k as X,h as q,i as U,C as I,e as x,l as V,j,E as Y,m as s,$ as H,o as p,c as u,D as K,y as m,p as i,G as w,M as f,a as r,F as Q,H as Z,I as ee,v as A,P as te,N as b,u as oe,x as ie,R as ae,S as ne,T as se}from"./@vue-8306d5ee.js";import{W as E}from"./WorkflowTemplate-52609167.js";import{N as re,_ as le}from"./index-0ce5277f.js";import{u as de}from"./vue-router-c9c3da21.js";import ce from"./index-aed9bc6a.js";import{b as pe}from"./element-plus-e21f9b5a.js";import"./http-client-5da26c39.js";import"./axios-21b846bc.js";import"./pinia-e84f6aa2.js";import"./vue-demi-71ba0ef2.js";import"./vue-i18n-86a71ef1.js";import"./@intlify-869ec77a.js";import"./vue-27cbb85a.js";import"./js-cookie-edb2da2a.js";import"./@element-plus-8ef115d9.js";import"./nprogress-b96aa312.js";import"./lodash-es-f559e892.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-9f938aef.js";import"./@vueuse-245b213e.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-97457aaf.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";const me=y=>(ne("data-v-efe9d959"),y=y(),se(),y),ge={key:1,class:"design-page"},ue={class:"page__header"},fe={class:"page-actions"},ye=me(()=>r("div",null,"流程设计器",-1)),ve={class:"step-tab"},Se=["onClick"],_e={class:"step-index"},he={key:0,class:"page__content"},xe=X({__name:"designer",setup(y){const{proxy:D}=q(),N=de();U(()=>{re.done()});const G=ae(()=>P(()=>import("./index-b0a24e5e.js"),["assets/js/index-b0a24e5e.js","assets/js/index-0ce5277f.js","assets/js/@vue-8306d5ee.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-3baf0d65.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/css/index-cbf15b1a.css"])),T=(o,t)=>{e.fields=o||[],e.conditions=t||[]},z=()=>{window.parent.postMessage("close"),window.close()},J=o=>e.data[o];I("updateFormItemList",T),I("getInitSetting",J);const C=x(null),v=x(null),k=x(null),O=x(null),e=V({conf:{nodes:{11:{title:"开始",id:"11",type:"start",permission:[{fieldId:"field1678727077034",required:!0,label:"开关",formOperate:1}],operation:{particpants:{}}},12:{title:"审批_12",id:"12",type:"approve",approve:{participants:{user:[{id:0x92a1c0337045,userName:"admin",name:"admin",mobile:"13122223333",email:"xiaoxue@zhontai.com",type:100,roleNames:["主管理员"],isManager:!1,createdTime:"2023-09-08 17:30:47",tagName:"user",tagType:"success"}],role:[],org:[]},ouType:"0",level:0,isDirectorIn:!1,assigneeType:"user",formOperates:[],SignType:"string",optionalMultiUser:!1,optionalRange:"ALL"},permission:[{fieldId:"field1678727077034",required:!0,label:"开关",formOperate:1}],operation:{particpants:{}}},13:{title:"审批_13",id:"13",type:"approve",approve:{participants:{user:[],role:[{id:340428577087557,parentId:336557508276293,name:"IT",code:"it",type:2,sort:2,description:"",tagName:"role",tagType:"danger"}],org:[]},ouType:"0",level:0,isDirectorIn:!1,assigneeType:"role",formOperates:[],SignType:"string",optionalMultiUser:!1,optionalRange:"ALL"},permission:[{fieldId:"field1678727077034",required:!0,label:"开关",formOperate:1}],operation:{particpants:{}}},15:{title:"",id:"15",type:"condition",approve:{},condition:{},permission:[]},17:{title:"结束",id:"17",type:"end",approve:{},condition:{},permission:[]},18:{title:"",id:"18",type:"condition",approve:{},condition:{},permission:[]},19:{title:"",id:"19",type:"condition",approve:{},condition:{},permission:[]}},lines:[{id:"15",fromId:"12",toId:"13"},{id:"18",fromId:"11",toId:"12"},{id:"19",fromId:"13",toId:"17"}],startActivityId:"11",chartData:'<mxGraphModel grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="11" target="12"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="11" value="开始" style="shape=bpmShape;type=start;verticalLabelPosition=bottom;;strokeWidth=2" vertex="1" parent="1"><mxGeometry x="435" y="10" width="50" height="50" as="geometry"/></mxCell><mxCell id="15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="12" target="13"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="12" value="审批_12" style="rounded=1;whiteSpace=wrap;html=1;type=approve;strokeWidth=2" vertex="1" parent="1"><mxGeometry x="400" y="170" width="120" height="50" as="geometry"/></mxCell><mxCell id="19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="13" target="17"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="13" value="审批_13" style="rounded=1;whiteSpace=wrap;html=1;type=approve;strokeWidth=2" vertex="1" parent="1"><mxGeometry x="400" y="270" width="120" height="50" as="geometry"/></mxCell><mxCell id="17" value="结束" style="shape=bpmShape;type=end;verticalLabelPosition=bottom;;strokeWidth=2" vertex="1" parent="1"><mxGeometry x="435" y="390" width="50" height="50" as="geometry"/></mxCell></root></mxGraphModel>'},isShowResult:!1,fields:[],conditions:[],data:{name:"",formSetting:{},flowSetting:{},basicSetting:{},advancedSetting:{}},activeStep:"basicSetting",steps:[{label:"基础设置",key:"basicSetting"},{label:"表单设计",key:"formDesign"},{label:"流程设计",key:"flowDesign"},{label:"高级设置",key:"advancedSetting"}]}),L=()=>{var o=N.query.id;e.data.id=o,new E().save(e.data,{showErrorMessage:!0}).then(t=>{t.success?e.isShowResult=!0:D.$modal.msgError(t.msg)})};I("isInUsed",o=>{var d;var t=(d=v.value)==null?void 0:d.getNodes();let n="";if(t){for(var g in t){var l=t[g];l.condition&&(n+=JSON.stringify(l.condition))}return o.some(c=>n.indexOf(c)!==-1)}return!1});const B=async o=>{var c,S,_,h;console.log("basicSetting.value",k.value),console.log("formDesign.value",C.value),console.log("flowDesign.value",v.value);var t=!0,n=await((c=k.value)==null?void 0:c.getSetting().catch(a=>{e.activeStep="basicSetting",t=!1}));if(t){var g=await((S=C.value)==null?void 0:S.getSetting().catch(a=>{e.activeStep="formDesign",t=!1}));if(t){var l=await((_=v.value)==null?void 0:_.getSetting().catch(a=>{e.activeStep="flowDesign",t=!1}));if(t){var d=await((h=O.value)==null?void 0:h.getSetting().catch(a=>{e.activeStep="advancedSetting",t=!1}));t&&(e.data.basicSetting=n,e.data.basicContext=JSON.stringify(e.data.basicSetting),e.data.advancedContext=JSON.stringify(d),e.data.flowSetting=JSON.stringify(l),e.data.formSetting=JSON.stringify(g),e.data.isPublish=o,o?D.$modal.confirm("此操作将新建或者更新流程版本, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{L()}).catch(()=>{}):L())}}}},W=o=>{e.data.formSetting=o},R=j(()=>`translateX(${e.steps.findIndex(o=>o.key===e.activeStep)*100}%)`),$=o=>{e.activeStep=o.key},F=()=>{pe.confirm("离开此页面您的修改将会丢失, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{window.parent.postMessage("close"),window.close()}).catch(()=>{})};return Y(async()=>{var o=N.query.id;if(o){const t=await new E().get({id:o});t.success&&(e.data.basicSetting=JSON.parse(t.data.basicContext)??{},e.data.formSetting=JSON.parse(t.data.formSetting)??{},e.data.flowSetting=JSON.parse(t.data.flowSetting)??{},e.data.model=t.data.model??{},e.data.advancedSetting=JSON.parse(t.data.advancedContext)??{})}}),(o,t)=>{const n=s("el-button"),g=s("el-result"),l=s("ele-Close"),d=s("el-icon"),c=s("el-button-group"),S=s("ai-form-designer"),_=s("AiWorkflowDesigner"),h=H("auth");return p(),u("section",null,[e.isShowResult?(p(),K(g,{key:0,icon:"success",title:"提交成功","sub-title":"Please follow the instructions"},{extra:m(()=>[i(n,{type:"primary",onClick:z},{default:m(()=>[w("关闭")]),_:1})]),_:1})):f((p(),u("div",ge,[r("header",ue,[r("div",fe,[r("div",{style:{"border-right":"1px solid #c5c5c5",cursor:"pointer"},onClick:F},[i(d,null,{default:m(()=>[i(l)]),_:1})]),ye]),r("div",ve,[(p(!0),u(Q,null,Z(e.steps,(a,M)=>(p(),u("div",{key:M,class:ee(["step",[e.activeStep==a.key?"active":""]]),onClick:be=>$(a)},[r("span",_e,A(M+1),1),w(" "+A(a.label),1)],10,Se))),128)),r("div",{class:"ghost-step step",style:te({transform:R.value})},null,4)]),i(c,null,{default:m(()=>[i(n,{size:"small",class:"publish-btn",onClick:t[0]||(t[0]=a=>B(!1))},{default:m(()=>[w("草稿")]),_:1}),i(n,{size:"small",class:"publish-btn",onClick:t[1]||(t[1]=a=>B(!0))},{default:m(()=>[w("发布")]),_:1})]),_:1})]),e.data?(p(),u("section",he,[f(i(ce,{ref_key:"basicSetting",ref:k,conf:e.data.basicSetting},null,8,["conf"]),[[b,e.activeStep==="basicSetting"]]),f(i(oe(G),{ref_key:"advancedSetting",ref:O,conf:e.data.advancedSetting},null,8,["conf"]),[[b,e.activeStep==="advancedSetting"]]),f(i(S,{"show-header":!1,ref_key:"formDesign",ref:C,conf:e.data.formSetting,onOk:W,onChange:T},null,8,["conf"]),[[b,e.activeStep==="formDesign"]]),f(i(_,{conf:e.data.flowSetting,fields:e.fields,conditions:e.conditions,ref_key:"flowDesign",ref:v},null,8,["conf","fields","conditions"]),[[b,e.activeStep==="flowDesign"]])])):ie("",!0)])),[[h,"api:bpm:template:publish"]])])}}});const Ze=le(xe,[["__scopeId","data-v-efe9d959"]]);export{Ze as default};
