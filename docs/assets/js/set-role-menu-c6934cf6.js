import{P as n}from"./Permission-5cf8226b.js";import{P as I,_ as L}from"./index-0ce5277f.js";import{g as v}from"./element-plus-e21f9b5a.js";import{j as N}from"./lodash-es-f559e892.js";import{k as f,j as P,l as R,h as V,e as K,m as p,o as B,D as M,y as i,a as m,p as r,G as u,u as S}from"./@vue-8306d5ee.js";import"./pinia-e84f6aa2.js";import"./vue-demi-71ba0ef2.js";import"./ai-form-3baf0d65.js";import"./vue-router-c9c3da21.js";import"./vue-i18n-86a71ef1.js";import"./@intlify-869ec77a.js";import"./vue-27cbb85a.js";import"./js-cookie-edb2da2a.js";import"./@element-plus-8ef115d9.js";import"./nprogress-b96aa312.js";import"./axios-21b846bc.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-9f938aef.js";import"./@vueuse-245b213e.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-97457aaf.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";const $={class:"dialog-footer"},j=f({name:"admin/role/components/set-role-menu"}),z=f({...j,props:{title:{type:String,default:""}},setup(g,{expose:_}){const l=g,h=P(()=>l.title?l.title:e.roleName?`设置【${e.roleName}】菜单权限`:"设置菜单权限"),e=R({showDialog:!1,loading:!1,sureLoading:!1,permissionTreeData:[],roleId:0,roleName:"",checkedKeys:[]}),{proxy:c}=V(),d=K(),y=async()=>{const o=await new n().getRolePermissionList({roleId:e.roleId});e.checkedKeys=o!=null&&o.success?o.data:[]},k=async o=>{e.roleId=o.id,e.roleName=o.name,c.$modal.loading(),await D(),await y(),c.$modal.closeLoading(),e.showDialog=!0},w=()=>{e.showDialog=!1},D=async()=>{e.loading=!0;const o=await new n().getPermissionList().catch(()=>{e.loading=!1});o&&o.data&&o.data.length>0?e.permissionTreeData=I(N(o.data)):e.permissionTreeData=[],e.loading=!1},x=o=>o.row?"is-penultimate":"",T=()=>{e.showDialog=!1},b=async()=>{var a;e.sureLoading=!0;const o=(a=d.value)==null?void 0:a.getCheckedKeys(!0),t={roleId:e.roleId,permissionIds:o},s=await new n().assign(t,{showSuccessMessage:!0}).catch(()=>{e.sureLoading=!1});e.sureLoading=!1,s!=null&&s.success&&(e.showDialog=!1)};return _({open:k,close:w}),(o,t)=>{const s=p("el-button"),a=p("el-dialog");return B(),M(a,{modelValue:e.showDialog,"onUpdate:modelValue":t[0]||(t[0]=C=>e.showDialog=C),"destroy-on-close":"",title:h.value,"append-to-body":"",draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"780px"},{footer:i(()=>[m("span",$,[r(s,{onClick:T,size:"default"},{default:i(()=>[u("取 消")]),_:1}),r(s,{type:"primary",onClick:b,size:"default",loading:e.sureLoading},{default:i(()=>[u("确 定")]),_:1},8,["loading"])])]),default:i(()=>[m("div",null,[r(S(v),{ref_key:"permissionTreeRef",ref:d,data:e.permissionTreeData,"node-key":"id","show-checkbox":"","highlight-current":"","default-expand-all":"","check-on-click-node":"","expand-on-click-node":!1,props:{class:x},"default-checked-keys":e.checkedKeys},null,8,["data","props","default-checked-keys"])])]),_:1},8,["modelValue","title"])}}});const ue=L(z,[["__scopeId","data-v-1bfc2be2"]]);export{ue as default};
