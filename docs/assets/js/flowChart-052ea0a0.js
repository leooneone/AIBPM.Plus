import{_ as d}from"./lodash-a8362e0e.js";import{a as h}from"./element-plus-e21f9b5a.js";import{k as x,e as C,l as E,i as u,o as g,c as S,a as y}from"./@vue-8306d5ee.js";import"./@intlify-869ec77a.js";import"./lodash-es-f559e892.js";import"./@vueuse-245b213e.js";import"./@element-plus-8ef115d9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-97457aaf.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";Object.assign(mxEvent,{EDGE_START_MOVE:"edgeStartMove",VERTEX_START_MOVE:"vertexStartMove"});const f="https://embed.diagrams.net/?embed=1";class m extends mxGraph{static getStyleDict(t){return d.compact(t.getStyle().split(";")).reduce((e,n)=>{const[o,s]=n.split("=");return e[o]=s,e},{})}static convertStyleToString(t){return`${Object.entries(t).map(([n,o])=>`${n}=${o}`).join(";").replace(/=undefined/g,"")};`}static getCellPosition(t){return d.pick(t.getGeometry(),["x","y"])}constructor(t){super(t),this._init()}_init(){this.xcells=[],this.diagramXml="",this._setDefaultConfig(),this._configConstituent(),this._putVertexStyle(),this._setDefaultEdgeStyle(),this._setAnchors(),this._configCustomEvent()}_configConstituent(){this.selectCellForEvent=(...e)=>{const[n]=e;if(this.isPart(n)){e[0]=this.model.getParent(n),mxGraph.prototype.selectCellForEvent.call(this,e);return}mxGraph.prototype.selectCellForEvent.apply(this,e)};const t=mxGraphHandler.prototype.getInitialCellForEvent;mxGraphHandler.prototype.getInitialCellForEvent=function(...n){let o=t.apply(this,n);return this.graph.isPart(o)&&(o=this.graph.getModel().getParent(o)),o}}configMenu(){mxEvent.disableContextMenu(this.container),this.popupMenuHandler.factoryMethod=t=>{t.addItem("流动的线(测试)",null,()=>{let e=this.getSelectionCell();if(e&&e.edge){let n=this.view.getState(e);n.shape.node.getElementsByTagName("path")[0].removeAttribute("visibility"),n.shape.node.getElementsByTagName("path")[0].setAttribute("stroke-width","6"),n.shape.node.getElementsByTagName("path")[0].setAttribute("stroke","lightGray"),n.shape.node.getElementsByTagName("path")[1].setAttribute("class","flow")}else h.error("请选择连线")}),t.addSeparator()}}_setDefaultConfig(){this.setConnectable(!0),mxEvent.disableContextMenu(this.container),this.configMenu(),this.setCellsResizable(!1),this.setEnterStopsCellEditing(!0),mxCellEditor.prototype.escapeCancelsEditing=!1,mxCellEditor.prototype.blurEnabled=!0,this.foldingEnabled=!1,this.setHtmlLabels(!0),mxGraphHandler.prototype.guidesEnabled=!0,this.setDisconnectOnMove(!1),this.setAllowDanglingEdges(!1),mxGraph.prototype.isCellMovable=t=>!t.edge,this.setCellsBendable(!1),mxGraph.prototype.edgeLabelsMovable=!1}_putVertexStyle(){const t={[mxConstants.STYLE_SHAPE]:mxConstants.SHAPE_IMAGE,[mxConstants.STYLE_PERIMETER]:mxPerimeter.RectanglePerimeter};this.getStylesheet().putCellStyle("normalType",t);const e={[mxConstants.STYLE_SHAPE]:mxConstants.SHAPE_LABEL,[mxConstants.STYLE_PERIMETER]:mxPerimeter.RectanglePerimeter,[mxConstants.STYLE_ROUNDED]:!0,[mxConstants.STYLE_ARCSIZE]:6,[mxConstants.STYLE_STROKECOLOR]:"#333333",[mxConstants.STYLE_FONTCOLOR]:"#333333",[mxConstants.STYLE_FILLCOLOR]:"#ffffff",[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR]:"none",[mxConstants.STYLE_ALIGN]:mxConstants.ALIGN_CENTER,[mxConstants.STYLE_VERTICAL_ALIGN]:mxConstants.ALIGN_TOP,[mxConstants.STYLE_IMAGE_ALIGN]:mxConstants.ALIGN_CENTER,[mxConstants.STYLE_IMAGE_VERTICAL_ALIGN]:mxConstants.ALIGN_TOP,[mxConstants.STYLE_IMAGE_WIDTH]:"72",[mxConstants.STYLE_IMAGE_HEIGHT]:"72",[mxConstants.STYLE_SPACING_TOP]:"100",[mxConstants.STYLE_SPACING]:"8"};this.getStylesheet().putCellStyle("node",e);const n=mxVertexHandler.prototype.createSelectionShape;mxVertexHandler.prototype.createSelectionShape=function(...s){const r=n.apply(this,s);return r.isRounded=!0,r.style={arcSize:6},r}}_setDefaultEdgeStyle(){const t=this.getStylesheet().getDefaultEdgeStyle();Object.assign(t,{[mxConstants.STYLE_ROUNDED]:!0,[mxConstants.STYLE_STROKEWIDTH]:"2",[mxConstants.STYLE_STROKECOLOR]:"#333333",[mxConstants.STYLE_EDGE]:mxConstants.EDGESTYLE_ORTHOGONAL,[mxConstants.STYLE_FONTCOLOR]:"#33333",[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR]:"#ffa94d"}),this.connectionHandler.createEdgeState=()=>{const e=this.createEdge();return new mxCellState(this.view,e,this.getCellStyle(e))}}_setAnchors(){this.connectionHandler.isConnectableCell=()=>!1,mxEdgeHandler.prototype.isConnectableCell=()=>!1,mxGraph.prototype.getAllConnectionConstraints=t=>{if(t!=null&&t.shape!=null){if(t.shape.stencil!=null){if(t.shape.stencil!=null)return t.shape.stencil.constraints}else if(t.shape.constraints!=null)return t.shape.constraints}return null},mxShape.prototype.constraints=[new mxConnectionConstraint(new mxPoint(0,0),!0),new mxConnectionConstraint(new mxPoint(0,1),!0),new mxConnectionConstraint(new mxPoint(1,0),!0),new mxConnectionConstraint(new mxPoint(1,1),!0),new mxConnectionConstraint(new mxPoint(.25,0),!0),new mxConnectionConstraint(new mxPoint(.5,0),!0),new mxConnectionConstraint(new mxPoint(.75,0),!0),new mxConnectionConstraint(new mxPoint(0,.25),!0),new mxConnectionConstraint(new mxPoint(0,.5),!0),new mxConnectionConstraint(new mxPoint(0,.75),!0),new mxConnectionConstraint(new mxPoint(1,.25),!0),new mxConnectionConstraint(new mxPoint(1,.5),!0),new mxConnectionConstraint(new mxPoint(1,.75),!0),new mxConnectionConstraint(new mxPoint(.25,1),!0),new mxConnectionConstraint(new mxPoint(.5,1),!0),new mxConnectionConstraint(new mxPoint(.75,1),!0)]}_configCustomEvent(){const t=this,e=mxEdgeHandler.prototype.start;mxEdgeHandler.prototype.start=function(...s){e.apply(this,s),t.fireEvent(new mxEventObject(mxEvent.EDGE_START_MOVE,"edge",this.state.cell,"source",this.isSource))};const n=mxGraphHandler.prototype.createPreviewShape;mxGraphHandler.prototype.createPreviewShape=function(...s){return t.fireEvent(new mxEventObject(mxEvent.VERTEX_START_MOVE)),n.apply(this,s)}}_configCoder(){const t=new mxObjectCodec(new PokeElement);t.encode=function(e,n){const o=e.document.createElement("PokeElement");return mxUtils.setTextContent(o,JSON.stringify(n)),o},t.decode=function(e,n,o){const s=JSON.parse(mxUtils.getTextContent(n));return s.constructor=PokeElement,s},mxCodecRegistry.register(t)}getDom(t){return this.view.getState(t).shape.node}setStyle(t,e,n){const o=m.getStyleDict(t);o[e]=n;const s=m.convertStyleToString(o);this.getModel().setStyle(t,s)}isPart(t){const e=this.view.getState(t);return(e!=null?e.style:this.getCellStyle(t)).constituent===1}deleteSubtree(t){const e=[];this.traverse(t,!0,n=>(e.push(n),!0)),this.removeCells(e)}_restoreModel(){Object.values(this.getModel().cells).forEach(t=>{t.vertex&&t.data&&(t.data=JSON.parse(t.data))})}_getExportModel(){const t=d.cloneDeep(this.getModel());return Object.values(t.cells).forEach(e=>{e.vertex&&e.data&&(e.data=JSON.stringify(e.data))}),t}addOverlay(t,e){const n=(o,s)=>{const r=new mxCellOverlay(o,s);return r.addListener(mxEvent.CLICK,(a,l)=>{mxUtils.alert(`${s}
Last update: ${new Date}`)}),r};return this.setCellStyles(mxConstants.STYLE_FILLCOLOR,"#f8cecc",[t]),this.addCellOverlay(t,n(this.warningImage,`State: ${e}`)),this}importModelXML(t){i.diagramXml=t,this.getModel().beginUpdate();try{const n=mxUtils.parseXml(t).documentElement,o=new mxCodec(n.ownerDocument);this.model.clear(),this.view.scale=1,o.decode(n,this.getModel()),this.loadExtFont()}finally{this.getModel().endUpdate()}this._restoreModel()}loadExtFont(){var t=this.getModel(),e=t.extFonts;if(e)try{e=e.split("|").map(function(o){var s=o.split("^");return{name:s[0],url:s[1]}});for(var n=0;n<e.length;n++)this.addExtFont(e[n].name,e[n].url)}catch{}return[2]}editDiagram(){var t=this.diagramXml;const e=this;var n=0,o=document.createElement("iframe");o.style.zIndex="9999",o.style.position="absolute",o.style.top=n+"px",o.style.left=n+"px",o.setAttribute("frameborder","0");var s=function(){o.setAttribute("width",document.body.clientWidth-2*n),o.setAttribute("height",document.body.clientHeight-2*n)};window.addEventListener("resize",s),s();var r=function(a){if(a.data==="ready")o.contentWindow.postMessage(t,"*"),s();else{if(a.data.length>0){var l=a.data;e.importModelXML(l),e.saveAs(l)}window.removeEventListener("resize",s),window.removeEventListener("message",r),document.body.removeChild(o)}};window.addEventListener("message",r),o.setAttribute("src",f),document.body.appendChild(o)}allowDrawio(t){return t?(mxUrlConverter.prototype.baseUrl="https://draw.io/",mxUrlConverter.prototype.baseDomain=""):(mxUrlConverter.prototype.baseUrl=null,mxUrlConverter.prototype.baseDomain=null),console.log(mxUrlConverter.prototype.baseUrl),this}exportModelXML(){const e=new mxCodec(mxUtils.createXmlDocument()).encode(this._getExportModel());return mxUtils.getPrettyXml(e)}exportPicXML(){const t=mxUtils.createXmlDocument(),e=t.createElement("output");t.appendChild(e);const{scale:n}=this.view,o=0,s=this.getGraphBounds(),r=new mxXmlCanvas2D(e);r.translate(Math.floor((o/n-s.x)/n),Math.floor((o/n-s.y)/n)),r.scale(1),new mxImageExport().drawState(this.getView().getState(this.model.root),r);const l=Math.ceil(s.width*n/n+2*o),p=Math.ceil(s.height*n/n+2*o);return{xml:mxUtils.getPrettyXml(e),w:l,h:p}}}let i={};const w=c=>{i=new m(c),i.allowDrawio(!0);var t=i.getStylesheet().getDefaultVertexStyle();return t[mxConstants.STYLE_FONTSIZE]=11,t[mxConstants.STYLE_FONTCOLOR]="black",t[mxConstants.STYLE_FILLCOLOR]="white",t[mxConstants.STYLE_ROUNDED]=!0,t[mxConstants.STYLE_FONTSTYLE]=1,t=i.getStylesheet().getDefaultEdgeStyle(),t[mxConstants.STYLE_EDGE]=mxEdgeStyle.ElbowConnector,t[mxConstants.STYLE_ROUNDED]=!0,t[mxConstants.STYLE_SHADOW]=!1,i},U=x({__name:"flowChart",props:{data:{type:Object,default:()=>{}},id:{type:Number}},setup(c,{expose:t}){const e=c,n=C();let o=null;const s=E({shapes:{},prop:"tickerTime",idForm:{oldId:null,newId:"",show:!1},myGraph:null,form:{}});return u(r=>{mxClient.isBrowserSupported()||mxUtils.error("Browser is not supported!",200,!1),s.form=e.data,o=w(n.value),s.myGraph=o,o.importModelXML(e.data),window.addEventListener("resize",function(){s.myGraph.center(!0,!1),s.myGraph.fit()})}),t({}),(r,a)=>(g(),S("section",null,[y("div",{ref_key:"graphContainer",ref:n,style:{height:"100%"}},null,512)]))}});export{U as default};
