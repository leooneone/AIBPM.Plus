import{P as _}from"./Permission-0cafc449.js";import{A as P}from"./Api-be052949.js";import{M as N,e as z,P as B,_ as F}from"./index-aa73a18b.js";import{j as K,r as M,v as $}from"./lodash-es-f559e892.js";import{k as V,h as q,e as O,l as j,ah as E,m,o as G,c as H,p as l,y as o,a as u,G as w,u as n,v as y}from"./@vue-8306d5ee.js";import"./pinia-e84f6aa2.js";import"./vue-demi-71ba0ef2.js";import"./ai-form-7f0c78d7.js";import"./element-plus-e21f9b5a.js";import"./@vueuse-245b213e.js";import"./@element-plus-8ef115d9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-97457aaf.js";import"./@intlify-869ec77a.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";import"./vue-router-c9c3da21.js";import"./vue-i18n-86a71ef1.js";import"./vue-27cbb85a.js";import"./js-cookie-edb2da2a.js";import"./nprogress-b96aa312.js";import"./axios-21b846bc.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-9f938aef.js";const J={class:"my-flex my-flex-between"},Q=["title"],W={class:"dialog-footer"},X=V({name:"admin/permission/permission-dot-form"}),Y=V({...X,props:{title:{type:String,default:""},permissionTreeData:{type:Array,default:()=>[]}},setup(g,{expose:h}){const{proxy:f}=q(),b=O(),t=j({showDialog:!1,sureLoading:!1,form:{enabled:!0},apiTreeData:[],expandRowKeys:[]}),{form:r}=E(t),D=async()=>{const a=await new P().getList();a!=null&&a.success&&a.data&&a.data.length>0?t.apiTreeData=B(a.data):t.apiTreeData=[]},I=async(a={})=>{if(f.$modal.loading(),await D(),t.expandRowKeys=N(K(t.apiTreeData)).filter(e=>e.parentId===0).map(e=>e.id),a.id>0){const e=await new _().getDot({id:a.id}).catch(()=>{f.$modal.closeLoading()});if(e!=null&&e.success){let d=e.data;d.parentId=d.parentId&&d.parentId>0?d.parentId:void 0,t.form=d}}else t.form={enabled:!0};f.$modal.closeLoading(),t.showDialog=!0},k=(a,e)=>{var d,i;return a?((d=e.label)==null?void 0:d.indexOf(a))!==-1||((i=e.path)==null?void 0:i.indexOf(a))!==-1:!0},v=a=>{a&&(t.form.label||(t.form.label=a.label),t.form.code||(t.form.code=M($(a.path||"",/\//g,":"),":")))},C=()=>{t.showDialog=!1},T=()=>{b.value.validate(async a=>{if(!a)return;t.sureLoading=!0;let e={};t.form.parentId=t.form.parentId&&t.form.parentId>0?t.form.parentId:void 0,t.form.id!=null&&t.form.id>0?e=await new _().updateDot(t.form,{showSuccessMessage:!0}).catch(()=>{t.sureLoading=!1}):e=await new _().addDot(t.form,{showSuccessMessage:!0}).catch(()=>{t.sureLoading=!1}),t.sureLoading=!1,e!=null&&e.success&&(z.emit("refreshPermission"),t.showDialog=!1)})};return h({open:I}),(a,e)=>{const d=m("el-tree-select"),i=m("el-form-item"),p=m("el-col"),c=m("el-input"),L=m("el-input-number"),A=m("el-switch"),U=m("el-row"),R=m("el-form"),x=m("el-button"),S=m("el-dialog");return G(),H("div",null,[l(S,{modelValue:t.showDialog,"onUpdate:modelValue":e[7]||(e[7]=s=>t.showDialog=s),"destroy-on-close":"",title:g.title,draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"600px"},{footer:o(()=>[u("span",W,[l(x,{onClick:C,size:"default"},{default:o(()=>[w("取 消")]),_:1}),l(x,{type:"primary",onClick:T,size:"default",loading:t.sureLoading},{default:o(()=>[w("确 定")]),_:1},8,["loading"])])]),default:o(()=>[l(R,{model:n(r),ref_key:"formRef",ref:b,size:"default","label-width":"80px"},{default:o(()=>[l(U,{gutter:35},{default:o(()=>[l(p,{xs:24,sm:24,md:24,lg:24,xl:24},{default:o(()=>[l(i,{label:"上级菜单"},{default:o(()=>[l(d,{modelValue:n(r).parentId,"onUpdate:modelValue":e[0]||(e[0]=s=>n(r).parentId=s),data:g.permissionTreeData,"node-key":"id","check-strictly":"","default-expand-all":"","render-after-expand":"","fit-input-width":"",clearable:"",filterable:"",class:"w100"},null,8,["modelValue","data"])]),_:1})]),_:1}),l(p,{xs:24,sm:24,md:24,lg:24,xl:24},{default:o(()=>[l(i,{label:"API接口"},{default:o(()=>[l(d,{modelValue:n(r).apiIds,"onUpdate:modelValue":e[1]||(e[1]=s=>n(r).apiIds=s),data:t.apiTreeData,"node-key":"id",props:{label:"path"},"render-after-expand":"","fit-input-width":"",clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","filter-node-method":k,class:"w100","default-expanded-keys":t.expandRowKeys,onCurrentChange:v},{default:o(({data:s})=>[u("span",J,[u("span",null,y(s.label),1),u("span",{class:"my-line-1 my-mlr-12",title:s.path},y(s.path),9,Q)])]),_:1},8,["modelValue","data","default-expanded-keys"])]),_:1})]),_:1}),l(p,{xs:24,sm:24,md:24,lg:24,xl:24},{default:o(()=>[l(i,{label:"名称",prop:"label",rules:[{required:!0,message:"请输入名称",trigger:["blur","change"]}]},{default:o(()=>[l(c,{modelValue:n(r).label,"onUpdate:modelValue":e[2]||(e[2]=s=>n(r).label=s),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{xs:24,sm:24,md:24,lg:24,xl:24},{default:o(()=>[l(i,{label:"编码",prop:"code",rules:[{required:!0,message:"请输入编码",trigger:["blur","change"]}]},{default:o(()=>[l(c,{modelValue:n(r).code,"onUpdate:modelValue":e[3]||(e[3]=s=>n(r).code=s),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{xs:24,sm:12,md:12,lg:12,xl:12},{default:o(()=>[l(i,{label:"排序"},{default:o(()=>[l(L,{modelValue:n(r).sort,"onUpdate:modelValue":e[4]||(e[4]=s=>n(r).sort=s)},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{xs:24,sm:12,md:12,lg:12,xl:12},{default:o(()=>[l(i,{label:"启用"},{default:o(()=>[l(A,{modelValue:n(r).enabled,"onUpdate:modelValue":e[5]||(e[5]=s=>n(r).enabled=s)},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{xs:24,sm:24,md:24,lg:24,xl:24},{default:o(()=>[l(i,{label:"说明"},{default:o(()=>[l(c,{modelValue:n(r).description,"onUpdate:modelValue":e[6]||(e[6]=s=>n(r).description=s),clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const Ce=F(Y,[["__scopeId","data-v-eaf6eba6"]]);export{Ce as default};
