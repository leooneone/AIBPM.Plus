import{_ as h}from"./ai-form-97a12f88.js";import{k as W,h as ue,e as v,l as ge,i as me,E as ce,n as fe,m as s,$ as x,o as p,D as d,y as o,p as n,a as T,Y as B,am as U,G as g,M as k,u as r,x as D,R as P}from"./@vue-8306d5ee.js";import{P as w}from"./Pkg-9847cc8c.js";import{e as R}from"./index-c27e5712.js";import{a as V}from"./authFunction-871fd75a.js";import{g as K}from"./splitpanes-27ad7fdc.js";import{h as O}from"./element-plus-e21f9b5a.js";import"./pinia-e84f6aa2.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-c9c3da21.js";import"./vue-i18n-86a71ef1.js";import"./@intlify-869ec77a.js";import"./vue-27cbb85a.js";import"./js-cookie-edb2da2a.js";import"./@element-plus-8ef115d9.js";import"./nprogress-b96aa312.js";import"./axios-21b846bc.js";import"./lodash-es-f559e892.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-9f938aef.js";import"./@vueuse-245b213e.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-97457aaf.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";const _e={class:"my-flex-column w100 h100"},ke={class:"my-flex my-flex-end",style:{"margin-top":"20px"}},ye={class:"my-flex-column w100 h100"},he={class:"my-flex my-flex-end",style:{"margin-top":"20px"}},ve=W({name:"admin/pkg"}),Je=W({...ve,setup(Pe){const j=P(()=>h(()=>import("./pkg-form-55cd19d1.js"),["assets/js/pkg-form-55cd19d1.js","assets/js/Pkg-9847cc8c.js","assets/js/index-c27e5712.js","assets/js/@vue-8306d5ee.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-97a12f88.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css"])),G=P(()=>h(()=>import("./set-pkg-menu-6746cd91.js"),["assets/js/set-pkg-menu-6746cd91.js","assets/js/Pkg-9847cc8c.js","assets/js/index-c27e5712.js","assets/js/@vue-8306d5ee.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-97a12f88.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/js/Permission-2a9e4ecc.js","assets/css/set-pkg-menu-4786e862.css"])),Q=P(()=>h(()=>import("./tenant-select-51e0a73e.js"),["assets/js/tenant-select-51e0a73e.js","assets/js/@vue-8306d5ee.js","assets/js/Tenant-10f89243.js","assets/js/index-c27e5712.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-97a12f88.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/css/tenant-select-85188050.css"])),Y=P(()=>h(()=>import("./index-a7d8eda2.js"),["assets/js/index-a7d8eda2.js","assets/js/@vue-8306d5ee.js","assets/js/index-c27e5712.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-97a12f88.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css"])),q=P(()=>h(()=>import("./index-6030c56f.js"),["assets/js/index-6030c56f.js","assets/js/index-c27e5712.js","assets/js/@vue-8306d5ee.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-97a12f88.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/js/splitpanes-27ad7fdc.js","assets/css/splitpanes-067487d0.css","assets/css/index-89046c41.css"])),{proxy:f}=ue(),E=v(),S=v(),b=v(),I=v(),N=v(),e=ge({loading:!1,tenantListLoading:!1,sureLoading:!1,pkgFormTitle:"",filter:{name:"",pkgName:""},total:0,pageInput:{currentPage:1,pageSize:20,filter:{name:""}},pkgData:[],tenantPageInput:{currentPage:1,pageSize:20,filter:{pkgId:null,tenantName:""}},tenantData:[],tenantTotal:0,pkgId:void 0,pkgName:""});me(()=>{m(),R.off("refreshPkg"),R.on("refreshPkg",async()=>{m()})}),ce(()=>{R.off("refreshPkg")});const m=async()=>{var a,i;e.loading=!0,e.pageInput.filter&&(e.pageInput.filter.name=e.filter.pkgName);const t=await new w().getPage(e.pageInput).catch(()=>{e.loading=!1});e.pkgData=((a=t==null?void 0:t.data)==null?void 0:a.list)??[],e.total=((i=t==null?void 0:t.data)==null?void 0:i.total)??0,fe(()=>{E.value.setCurrentRow(e.pkgData[0])}),e.loading=!1},H=t=>{e.pageInput.pageSize=t,m()},J=t=>{e.pageInput.currentPage=t,m()},X=t=>{t&&(e.pkgId=t.id,e.pkgName=t.name,c())},Z=()=>{e.pkgFormTitle="新增套餐",S.value.open({enabled:!0})},ee=t=>{e.pkgFormTitle="编辑套餐",S.value.open(t)},te=t=>{f.$modal.confirmDelete(`确定要删除套餐【${t.name}】?`).then(async()=>{await new w().delete({id:t.id},{loading:!0}),m()}).catch(()=>{})},c=async()=>{var a,i;e.tenantListLoading=!0,e.tenantPageInput.filter={pkgId:e.pkgId,tenantName:e.filter.name};const t=await new w().getPkgTenantPage(e.tenantPageInput).catch(()=>{e.tenantListLoading=!1});e.tenantListLoading=!1,t!=null&&t.success&&(e.tenantData=((a=t==null?void 0:t.data)==null?void 0:a.list)??[],e.tenantTotal=((i=t==null?void 0:t.data)==null?void 0:i.total)??0)},ne=t=>{e.tenantPageInput.pageSize=t,c()},ae=t=>{e.tenantPageInput.currentPage=t,c()},oe=t=>{b.value.toggleRowSelection(t,void 0)},le=()=>{if(!(e.pkgId>0)){f.$modal.msgWarning("请选择套餐");return}I.value.open({pkgId:e.pkgId})},ie=()=>{if(!(e.pkgId>0)){f.$modal.msgWarning("请选择套餐");return}const t=b.value.getSelectionRows();if(!(t.length>0)){f.$modal.msgWarning("请选择租户");return}f.$modal.confirm("确定要移除吗?").then(async()=>{const a=t==null?void 0:t.map(u=>u.id),i={pkgId:e.pkgId,tenantIds:a};await new w().removePkgTenant(i,{loading:!0}),c()}).catch(()=>{})},re=async t=>{if(!((t==null?void 0:t.length)>0)){I.value.close();return}e.sureLoading=!0;const a=t==null?void 0:t.map(u=>u.id),i={pkgId:e.pkgId,tenantIds:a};await new w().addPkgTenant(i,{showSuccessMessage:!0}).catch(()=>{e.sureLoading=!1}),e.sureLoading=!1,I.value.close(),c()},pe=t=>{if(!((t==null?void 0:t.id)>0)){f.$modal.msgWarning("请选择套餐");return}N.value.open(t)};return(t,a)=>{const i=s("el-input"),u=s("el-form-item"),y=s("el-button"),M=s("el-form"),C=s("el-card"),_=s("el-table-column"),z=s("el-dropdown-item"),de=s("el-dropdown-menu"),$=s("el-pagination"),L=x("auth"),se=x("auths"),A=x("loading");return p(),d(r(q),null,{default:o(()=>[n(r(K),{size:"50","min-size":"30","max-size":"70"},{default:o(()=>[T("div",_e,[n(C,{class:"mt8",shadow:"never","body-style":{paddingBottom:"0"}},{default:o(()=>[n(M,{inline:!0,onSubmit:a[1]||(a[1]=B(()=>{},["stop","prevent"]))},{default:o(()=>[n(u,{label:"套餐名"},{default:o(()=>[n(i,{modelValue:e.filter.pkgName,"onUpdate:modelValue":a[0]||(a[0]=l=>e.filter.pkgName=l),placeholder:"套餐名",onKeyup:U(m,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),n(u,null,{default:o(()=>[n(y,{type:"primary",icon:"ele-Search",onClick:m},{default:o(()=>[g(" 查询 ")]),_:1}),k((p(),d(y,{type:"primary",icon:"ele-Plus",onClick:Z},{default:o(()=>[g(" 新增 ")]),_:1})),[[L,"api:admin:pkg:add"]])]),_:1})]),_:1})]),_:1}),n(C,{class:"my-fill mt8",shadow:"never"},{default:o(()=>[k((p(),d(r(O),{ref_key:"pkgTableRef",ref:E,data:e.pkgData,"default-expand-all":"","highlight-current-row":"",style:{width:"100%"},onCurrentChange:X},{default:o(()=>[n(_,{prop:"name",label:"套餐名","min-width":"120","show-overflow-tooltip":""}),n(_,{prop:"sort",label:"排序",width:"80",align:"center","show-overflow-tooltip":""}),n(_,{label:"操作",width:"100",fixed:"right","header-align":"center",align:"center"},{default:o(({row:l})=>[k((p(),d(r(Y),{style:{"margin-left":"0px"}},{dropdown:o(()=>[n(de,null,{default:o(()=>[r(V)("api:admin:pkg:set-pkg-permissions")?(p(),d(z,{key:0,onClick:F=>pe(l)},{default:o(()=>[g("菜单权限")]),_:2},1032,["onClick"])):D("",!0),r(V)("api:admin:pkg:update")?(p(),d(z,{key:1,onClick:F=>ee(l)},{default:o(()=>[g("编辑套餐")]),_:2},1032,["onClick"])):D("",!0),r(V)("api:admin:pkg:delete")?(p(),d(z,{key:2,onClick:F=>te(l)},{default:o(()=>[g("删除套餐")]),_:2},1032,["onClick"])):D("",!0)]),_:2},1024)]),_:2},1024)),[[se,["api:admin:pkg:set-pkg-permissions","api:admin:pkg:update","api:admin:pkg:delete"]]])]),_:1})]),_:1},8,["data"])),[[A,e.loading]]),T("div",ke,[n($,{currentPage:e.pageInput.currentPage,"onUpdate:currentPage":a[2]||(a[2]=l=>e.pageInput.currentPage=l),"page-size":e.pageInput.pageSize,"onUpdate:pageSize":a[3]||(a[3]=l=>e.pageInput.pageSize=l),total:e.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:H,onCurrentChange:J,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])])]),_:1})])]),_:1}),n(r(K),null,{default:o(()=>[T("div",ye,[n(C,{class:"mt8",shadow:"never","body-style":{paddingBottom:"0"}},{default:o(()=>[n(M,{inline:!0,onSubmit:a[5]||(a[5]=B(()=>{},["stop","prevent"]))},{default:o(()=>[n(u,{label:"企业名"},{default:o(()=>[n(i,{modelValue:e.filter.name,"onUpdate:modelValue":a[4]||(a[4]=l=>e.filter.name=l),placeholder:"企业名",onKeyup:U(c,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),n(u,null,{default:o(()=>[n(y,{type:"primary",icon:"ele-Search",onClick:c},{default:o(()=>[g(" 查询 ")]),_:1}),k((p(),d(y,{type:"primary",icon:"ele-Plus",onClick:le},{default:o(()=>[g(" 添加企业 ")]),_:1})),[[L,"api:admin:pkg:add-pkg-tenant"]]),k((p(),d(y,{type:"danger",icon:"ele-Delete",onClick:ie},{default:o(()=>[g(" 移除企业 ")]),_:1})),[[L,"api:admin:pkg:remove-pkg-tenant"]])]),_:1})]),_:1})]),_:1}),n(C,{class:"my-fill mt8",shadow:"never"},{default:o(()=>[k((p(),d(r(O),{ref_key:"tenantTableRef",ref:b,data:e.tenantData,"row-key":"id",style:{width:"100%"},onRowClick:oe},{default:o(()=>[n(_,{type:"selection",width:"55"}),n(_,{prop:"name",label:"企业名","min-width":"120","show-overflow-tooltip":""}),n(_,{prop:"code",label:"企业编码","min-width":"120","show-overflow-tooltip":""})]),_:1},8,["data"])),[[A,e.tenantListLoading]]),T("div",he,[n($,{currentPage:e.tenantPageInput.currentPage,"onUpdate:currentPage":a[6]||(a[6]=l=>e.tenantPageInput.currentPage=l),"page-size":e.tenantPageInput.pageSize,"onUpdate:pageSize":a[7]||(a[7]=l=>e.tenantPageInput.pageSize=l),total:e.tenantTotal,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:ne,onCurrentChange:ae,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])])]),_:1})])]),_:1}),n(r(j),{ref_key:"pkgFormRef",ref:S,title:e.pkgFormTitle},null,8,["title"]),n(r(Q),{ref_key:"tenantSelectRef",ref:I,title:`添加【${e.pkgName}】企业`,multiple:"","sure-loading":e.sureLoading,onSure:re},null,8,["title","sure-loading"]),n(r(G),{ref_key:"setPkgMenuRef",ref:N},null,512)]),_:1})}}});export{Je as default};
