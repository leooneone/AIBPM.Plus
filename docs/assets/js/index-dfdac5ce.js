import{_ as h}from"./ai-form-7f0c78d7.js";import{k as q,h as _e,e as v,l as ye,i as ge,E as he,n as ve,m as d,$ as A,o as r,D as s,y as a,p as l,a as K,Y as w,am as z,G as m,M as u,u as n,x as L,v as G,R as k}from"./@vue-8306d5ee.js";import{e as M,W as I,O as ke,P as R}from"./index-aa73a18b.js";import{a as N}from"./authFunction-7c96519e.js";import{g as j}from"./splitpanes-27ad7fdc.js";import{j as Q}from"./lodash-es-f559e892.js";import{h as Y}from"./element-plus-e21f9b5a.js";import"./pinia-e84f6aa2.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-c9c3da21.js";import"./vue-i18n-86a71ef1.js";import"./@intlify-869ec77a.js";import"./vue-27cbb85a.js";import"./js-cookie-edb2da2a.js";import"./@element-plus-8ef115d9.js";import"./nprogress-b96aa312.js";import"./axios-21b846bc.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-9f938aef.js";import"./@vueuse-245b213e.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-97457aaf.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";const De={class:"my-flex-column w100 h100"},Te={class:"my-flex-column w100 h100"},Le=q({name:"admin/role"}),Ze=q({...Le,setup(Ie){const H=k(()=>h(()=>import("./role-form-704810a9.js"),["assets/js/role-form-704810a9.js","assets/js/index-aa73a18b.js","assets/js/@vue-8306d5ee.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-7f0c78d7.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css"])),J=k(()=>h(()=>import("./set-role-menu-cba56ae9.js"),["assets/js/set-role-menu-cba56ae9.js","assets/js/Permission-0cafc449.js","assets/js/index-aa73a18b.js","assets/js/@vue-8306d5ee.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-7f0c78d7.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/css/set-role-menu-9a4f0f1a.css"])),X=k(()=>h(()=>import("./set-role-data-scope-b98a739f.js"),["assets/js/set-role-data-scope-b98a739f.js","assets/js/ai-form-7f0c78d7.js","assets/js/@vue-8306d5ee.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/index-aa73a18b.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/css/set-role-data-scope-f550499a.css"])),Z=k(()=>h(()=>import("./user-select-c8f123d0.js"),["assets/js/user-select-c8f123d0.js","assets/js/ai-form-7f0c78d7.js","assets/js/@vue-8306d5ee.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/index-aa73a18b.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/css/user-select-8a375a06.css"])),ee=k(()=>h(()=>import("./index-f4e433a5.js"),["assets/js/index-f4e433a5.js","assets/js/@vue-8306d5ee.js","assets/js/index-aa73a18b.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-7f0c78d7.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css"])),te=k(()=>h(()=>import("./index-095638ff.js"),["assets/js/index-095638ff.js","assets/js/index-aa73a18b.js","assets/js/@vue-8306d5ee.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-7f0c78d7.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/js/splitpanes-27ad7fdc.js","assets/css/splitpanes-067487d0.css","assets/css/index-89046c41.css"])),{proxy:c}=_e(),b=v(),S=v(),x=v(),$=v(),U=v(),P=v(),t=ye({loading:!1,userListLoading:!1,sureLoading:!1,roleFormTitle:"",filter:{name:"",roleName:""},roleTreeData:[],roleFormTreeData:[],userListData:[],roleId:void 0,roleName:""});ge(()=>{D(),M.off("refreshRole"),M.on("refreshRole",async()=>{D()})}),he(()=>{M.off("refreshRole")});const D=async()=>{var o;t.loading=!0;const e=await new I().getList().catch(()=>{t.loading=!1});e&&e.data&&e.data.length>0?(t.roleTreeData=ke(R(Q(e.data)),t.filter.roleName),t.roleFormTreeData=R(Q(e.data).filter(p=>p.parentId===0)),t.roleTreeData.length>0&&((o=t.roleTreeData[0].children)==null?void 0:o.length)>0&&ve(()=>{b.value.setCurrentRow(t.roleTreeData[0].children[0])})):(t.roleTreeData=[],t.roleFormTreeData=[]),t.loading=!1},F=(e,o=void 0)=>{switch(e){case 1:t.roleFormTitle="新增分组",S.value.open({type:1});break;case 2:t.roleFormTitle="新增角色",S.value.open({type:2,parentId:o==null?void 0:o.id,dataScope:1});break}},oe=e=>{switch(e.type){case 1:t.roleFormTitle="编辑分组";break;case 2:t.roleFormTitle="编辑角色";break}S.value.open(e)},ae=e=>{c.$modal.confirmDelete(`确定要删除角色【${e.name}】?`).then(async()=>{await new I().delete({id:e.id},{loading:!0}),D()}).catch(()=>{})},T=async()=>{t.userListLoading=!0;const e=await new I().getRoleUserList({RoleId:t.roleId,Name:t.filter.name}).catch(()=>{t.userListLoading=!1});t.userListLoading=!1,e!=null&&e.success&&(e.data&&e.data.length>0?t.userListData=e.data:t.userListData=[])},le=(e,o)=>{e&&((e==null?void 0:e.id)!==(o==null?void 0:o.id)&&(o==null?void 0:o.id)>0?(e==null?void 0:e.parentId)===0&&b.value.setCurrentRow(o):(e==null?void 0:e.parentId)===0&&b.value.setCurrentRow(),(e==null?void 0:e.parentId)!==0&&(o==null?void 0:o.parentId)!==0&&(e==null?void 0:e.id)>0&&(t.roleId=e.id,t.roleName=e.name,T()))},ie=e=>{x.value.toggleRowSelection(e,void 0)},ne=()=>{if(!(t.roleId>0)){c.$modal.msgWarning("请选择角色");return}$.value.open({roleId:t.roleId})},re=()=>{if(!(t.roleId>0)){c.$modal.msgWarning("请选择角色");return}const e=x.value.getSelectionRows();if(!(e.length>0)){c.$modal.msgWarning("请选择员工");return}c.$modal.confirm("确定要移除吗?").then(async()=>{const o=e==null?void 0:e.map(f=>f.id),p={roleId:t.roleId,userIds:o};await new I().removeRoleUser(p,{loading:!0}),T()}).catch(()=>{})},se=async e=>{if(!((e==null?void 0:e.length)>0)){$.value.close();return}t.sureLoading=!0;const o=e==null?void 0:e.map(f=>f.id),p={roleId:t.roleId,userIds:o};await new I().addRoleUser(p,{showSuccessMessage:!0}).catch(()=>{t.sureLoading=!1}),t.sureLoading=!1,$.value.close(),T()},de=e=>{if(!((e==null?void 0:e.id)>0)){c.$modal.msgWarning("请选择角色");return}U.value.open(e)},me=e=>{if(!((e==null?void 0:e.id)>0)){c.$modal.msgWarning("请选择角色");return}P.value.open(e)};return(e,o)=>{const p=d("el-input"),f=d("el-form-item"),_=d("el-button"),pe=d("ele-ArrowDown"),fe=d("el-icon"),y=d("el-dropdown-item"),O=d("el-dropdown-menu"),ce=d("el-dropdown"),B=d("el-form"),C=d("el-card"),g=d("el-table-column"),V=A("auth"),ue=A("auths"),W=A("loading");return r(),s(n(te),null,{default:a(()=>[l(n(j),{size:"50","min-size":"30","max-size":"70"},{default:a(()=>[K("div",De,[l(C,{class:"mt8",shadow:"never","body-style":{paddingBottom:"0"}},{default:a(()=>[l(B,{inline:!0,onSubmit:o[3]||(o[3]=w(()=>{},["stop","prevent"]))},{default:a(()=>[l(f,{label:"角色名称"},{default:a(()=>[l(p,{modelValue:t.filter.roleName,"onUpdate:modelValue":o[0]||(o[0]=i=>t.filter.roleName=i),placeholder:"角色名称",onKeyup:z(D,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(f,null,{default:a(()=>[l(_,{type:"primary",icon:"ele-Search",onClick:D},{default:a(()=>[m(" 查询 ")]),_:1}),u((r(),s(ce,{style:{"margin-left":"12px"}},{dropdown:a(()=>[l(O,null,{default:a(()=>[l(y,{onClick:o[1]||(o[1]=i=>F(1))},{default:a(()=>[m("新增分组")]),_:1}),l(y,{onClick:o[2]||(o[2]=i=>F(2))},{default:a(()=>[m("新增角色")]),_:1})]),_:1})]),default:a(()=>[l(_,{type:"primary"},{default:a(()=>[m("新增"),l(fe,{class:"el-icon--right"},{default:a(()=>[l(pe)]),_:1})]),_:1})]),_:1})),[[V,"api:admin:role:add"]])]),_:1})]),_:1})]),_:1}),l(C,{class:"my-fill mt8",shadow:"never"},{default:a(()=>[u((r(),s(n(Y),{ref_key:"roleTableRef",ref:b,data:t.roleTreeData,"row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"},"highlight-current-row":"",style:{width:"100%"},onCurrentChange:le},{default:a(()=>[l(g,{prop:"name",label:"角色名称","min-width":"120","show-overflow-tooltip":""}),l(g,{prop:"sort",label:"排序",width:"80",align:"center","show-overflow-tooltip":""}),l(g,{label:"操作",width:"100",fixed:"right","header-align":"center",align:"right"},{default:a(({row:i})=>[i.type===1?u((r(),s(_,{key:0,icon:"ele-Plus",size:"small",text:"",type:"primary",onClick:E=>F(2,i)},null,8,["onClick"])),[[V,"api:admin:role:add"]]):L("",!0),u((r(),s(n(ee),{"icon-only":""},{dropdown:a(()=>[l(O,null,{default:a(()=>[i.type===2&&n(N)("api:admin:permission:assign")?(r(),s(y,{key:0,onClick:E=>de(i)},{default:a(()=>[m("菜单权限")]),_:2},1032,["onClick"])):L("",!0),i.type===2?(r(),s(y,{key:1,onClick:E=>me(i)},{default:a(()=>[m("数据权限")]),_:2},1032,["onClick"])):L("",!0),n(N)("api:admin:role:update")?(r(),s(y,{key:2,onClick:E=>oe(i)},{default:a(()=>[m("编辑"+G(i.type===1?"分组":"角色"),1)]),_:2},1032,["onClick"])):L("",!0),n(N)("api:admin:role:delete")?(r(),s(y,{key:3,onClick:E=>ae(i)},{default:a(()=>[m("删除"+G(i.type===1?"分组":"角色"),1)]),_:2},1032,["onClick"])):L("",!0)]),_:2},1024)]),_:2},1024)),[[ue,["api:admin:permission:assign","api:admin:role:update","api:admin:role:delete"]]])]),_:1})]),_:1},8,["data"])),[[W,t.loading]])]),_:1})])]),_:1}),l(n(j),null,{default:a(()=>[K("div",Te,[l(C,{class:"mt8",shadow:"never","body-style":{paddingBottom:"0"}},{default:a(()=>[l(B,{inline:!0,onSubmit:o[5]||(o[5]=w(()=>{},["stop","prevent"]))},{default:a(()=>[l(f,{label:"姓名"},{default:a(()=>[l(p,{modelValue:t.filter.name,"onUpdate:modelValue":o[4]||(o[4]=i=>t.filter.name=i),placeholder:"姓名",onKeyup:z(T,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(f,null,{default:a(()=>[l(_,{type:"primary",icon:"ele-Search",onClick:T},{default:a(()=>[m(" 查询 ")]),_:1}),u((r(),s(_,{type:"primary",icon:"ele-Plus",onClick:ne},{default:a(()=>[m(" 添加员工 ")]),_:1})),[[V,"api:admin:role:add-role-user"]]),u((r(),s(_,{type:"danger",icon:"ele-Delete",onClick:re},{default:a(()=>[m(" 移除员工 ")]),_:1})),[[V,"api:admin:role:remove-role-user"]])]),_:1})]),_:1})]),_:1}),l(C,{class:"my-fill mt8",shadow:"never"},{default:a(()=>[u((r(),s(n(Y),{ref_key:"userTableRef",ref:x,data:t.userListData,"row-key":"id",style:{width:"100%"},onRowClick:ie},{default:a(()=>[l(g,{type:"selection",width:"55"}),l(g,{prop:"name",label:"姓名","min-width":"120","show-overflow-tooltip":""}),l(g,{prop:"mobile",label:"手机号","min-width":"120","show-overflow-tooltip":""})]),_:1},8,["data"])),[[W,t.userListLoading]])]),_:1})])]),_:1}),l(n(H),{ref_key:"roleFormRef",ref:S,title:t.roleFormTitle,"role-tree-data":t.roleFormTreeData},null,8,["title","role-tree-data"]),l(n(Z),{ref_key:"userSelectRef",ref:$,title:`添加【${t.roleName}】员工`,multiple:"","sure-loading":t.sureLoading,onSure:se},null,8,["title","sure-loading"]),l(n(J),{ref_key:"setRoleMenuRef",ref:U},null,512),l(n(X),{ref_key:"setRoleDataScopeRef",ref:P},null,512)]),_:1})}}});export{Ze as default};
