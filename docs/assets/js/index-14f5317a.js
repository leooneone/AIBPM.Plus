import{_ as w}from"./ai-form-3baf0d65.js";import{k as z,h as ie,e as le,l as se,i as re,E as de,m as r,$ as S,o as s,D as d,y as a,p as i,a as E,u as p,Y as pe,G as c,M as b,v as P,x as v,c as ce,F as ue,R as I}from"./@vue-8306d5ee.js";import{a as me,e as M,V as y,S as _e}from"./index-1c0db287.js";import{a as k}from"./authFunction-56d45b41.js";import{g as D}from"./splitpanes-27ad7fdc.js";import"./element-plus-e21f9b5a.js";import"./lodash-es-f559e892.js";import"./@vueuse-245b213e.js";import"./@element-plus-8ef115d9.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-97457aaf.js";import"./@intlify-869ec77a.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";import"./pinia-e84f6aa2.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-c9c3da21.js";import"./vue-i18n-86a71ef1.js";import"./vue-27cbb85a.js";import"./js-cookie-edb2da2a.js";import"./nprogress-b96aa312.js";import"./axios-21b846bc.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-9f938aef.js";const ge={class:"my-flex-column w100 h100"},fe={class:"my-flex-column w100 h100"},he={class:"my-flex my-flex-end",style:{"margin-top":"20px"}},ye=z({name:"admin/user"}),je=z({...ye,setup(we){const U=I(()=>w(()=>import("./user-form-1694be20.js"),["assets/js/user-form-1694be20.js","assets/js/ai-form-3baf0d65.js","assets/js/@vue-8306d5ee.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/index-1c0db287.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/js/test-5f17be6d.js"])),F=I(()=>w(()=>import("./org-menu-63dde9b7.js"),["assets/js/org-menu-63dde9b7.js","assets/js/index-1c0db287.js","assets/js/@vue-8306d5ee.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-3baf0d65.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css"])),L=I(()=>w(()=>import("./index-f0e4e982.js"),["assets/js/index-f0e4e982.js","assets/js/@vue-8306d5ee.js","assets/js/index-1c0db287.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-3baf0d65.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css"])),T=I(()=>w(()=>import("./index-c19e3569.js"),["assets/js/index-c19e3569.js","assets/js/@vue-8306d5ee.js","assets/js/lodash-es-f559e892.js","assets/js/index-1c0db287.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-3baf0d65.js","assets/js/element-plus-e21f9b5a.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/css/index-ef0678bf.css"])),R=I(()=>w(()=>import("./index-3f6b743a.js"),["assets/js/index-3f6b743a.js","assets/js/index-1c0db287.js","assets/js/@vue-8306d5ee.js","assets/js/pinia-e84f6aa2.js","assets/js/vue-demi-71ba0ef2.js","assets/js/ai-form-3baf0d65.js","assets/js/element-plus-e21f9b5a.js","assets/js/lodash-es-f559e892.js","assets/js/@vueuse-245b213e.js","assets/js/@element-plus-8ef115d9.js","assets/js/@popperjs-c75af06c.js","assets/js/@ctrl-f8748455.js","assets/js/dayjs-97457aaf.js","assets/js/@intlify-869ec77a.js","assets/js/async-validator-dee29e8b.js","assets/js/memoize-one-297ddbcb.js","assets/js/escape-html-e77024c3.js","assets/js/normalize-wheel-es-ed76fb12.js","assets/js/@floating-ui-c2863df3.js","assets/css/ai-form-078e22e0.css","assets/js/vue-router-c9c3da21.js","assets/js/vue-i18n-86a71ef1.js","assets/js/vue-27cbb85a.js","assets/js/js-cookie-edb2da2a.js","assets/js/nprogress-b96aa312.js","assets/css/nprogress-8b89e2e0.css","assets/js/axios-21b846bc.js","assets/js/mitt-f7ef348c.js","assets/js/vue-grid-layout-9f938aef.js","assets/css/index-6baff94b.css","assets/js/splitpanes-27ad7fdc.js","assets/css/splitpanes-067487d0.css","assets/css/index-89046c41.css"])),{proxy:m}=ie(),x=le(),A=me(),t=se({loading:!1,userFormTitle:"",total:0,pageInput:{currentPage:1,pageSize:20,filter:{orgId:null},dynamicFilter:{}},userListData:[],filters:[{field:"name",operator:"Contains",description:"姓名",componentName:"el-input",defaultSelect:!0},{field:"mobile",operator:"Contains",description:"手机号",componentName:"el-input"},{field:"email",operator:"Contains",description:"邮箱",componentName:"el-input"},{field:"userName",operator:"Contains",description:"用户名",componentName:"el-input"}]});re(()=>{M.off("refreshUser"),M.on("refreshUser",async()=>{u()})}),de(()=>{M.off("refreshUser")});const u=async()=>{var o,l;t.loading=!0;const e=await new y().getPage(t.pageInput).catch(()=>{t.loading=!1});t.userListData=((o=e==null?void 0:e.data)==null?void 0:o.list)??[],t.total=((l=e==null?void 0:e.data)==null?void 0:l.total)??0,t.loading=!1},O=()=>{var e,o,l;t.userFormTitle="新增用户",x.value.open({orgIds:(e=t.pageInput.filter)!=null&&e.orgId&&t.pageInput.filter.orgId>0?[(o=t.pageInput.filter)==null?void 0:o.orgId]:[],orgId:(l=t.pageInput.filter)==null?void 0:l.orgId})},B=e=>{t.userFormTitle="编辑用户",x.value.open(e)},q=e=>{m.$modal.confirmDelete(`确定要删除【${e.name}】?`).then(async()=>{await new y().delete({id:e.id},{loading:!0,showSuccessMessage:!0}),u()}).catch(()=>{})},G=e=>{m.$modal.prompt(`确定要给【${e.name}】重置密码?`,{inputPlaceholder:"选填，不填则使用系统默认密码",autofocus:!1}).then(async({value:o})=>{const l=await new y().resetPassword({id:e.id,password:o},{loading:!0});l!=null&&l.success&&m.$modal.msgSuccess(`重置密码成功，密码为：${l.data}`),u()}).catch(()=>{})},Q=e=>{var l;if(!(((l=t.pageInput.filter)==null?void 0:l.orgId)>0)){m.$modal.msgWarning("请选择部门");return}const o=e.isManager?`确定要取消【${e.name}】的主管?`:`确定要设置【${e.name}】为主管?`;m.$modal.confirm(o).then(async()=>{var f;const _={userId:e.id,orgId:(f=t.pageInput.filter)==null?void 0:f.orgId,isManager:!e.isManager};await new y().setManager(_,{loading:!0,showSuccessMessage:!0}),u()}).catch(()=>{})},W=e=>new Promise((o,l)=>{m.$modal.confirm(`确定要${e.enabled?"禁用":"启用"}【${e.name}】?`).then(async()=>{e.loading=!0;const _=await new y().setEnable({userId:e.id,enabled:!e.enabled},{showSuccessMessage:!0}).catch(()=>{l(new Error("Error"))}).finally(()=>{e.loading=!1});_&&_.success?o(!0):l(new Error("Cancel"))}).catch(()=>{l(new Error("Cancel"))})}),Y=e=>{m.$modal.confirmDelete(`确定要一键登录【${e.name}】?`).then(async()=>{const o=await new y().oneClickLogin({userName:e.userName||""},{loading:!0});o!=null&&o.success&&(m.$modal.msgSuccess("一键登录成功"),window.requests=[],_e.remove("tagsViewList"),A.setToken(o.data.token),window.location.href="/")}).catch(()=>{})},j=e=>{t.pageInput.pageSize=e,u()},H=e=>{t.pageInput.currentPage=e,u()},J=e=>{t.pageInput.filter&&(t.pageInput.filter.orgId=e==null?void 0:e.id),u()};return(e,o)=>{const l=r("el-form-item"),_=r("el-col"),f=r("el-button"),K=r("el-row"),X=r("el-form"),V=r("el-card"),g=r("el-table-column"),$=r("el-tag"),Z=r("el-switch"),C=r("el-dropdown-item"),ee=r("el-dropdown-menu"),te=r("el-table"),ae=r("el-pagination"),N=S("auth"),oe=S("auths"),ne=S("loading");return s(),d(p(R),null,{default:a(()=>[i(p(D),{size:"20","min-size":"20","max-size":"35"},{default:a(()=>[E("div",ge,[i(p(F),{onNodeClick:J,"select-first-node":""})])]),_:1}),i(p(D),{size:"80"},{default:a(()=>[E("div",fe,[i(V,{class:"mt8",shadow:"never","body-style":{paddingBottom:"0"}},{default:a(()=>[i(X,{onSubmit:o[1]||(o[1]=pe(()=>{},["stop","prevent"])),style:{"max-width":"640px"}},{default:a(()=>[i(K,{gutter:35},{default:a(()=>[i(_,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[i(l,null,{default:a(()=>[i(p(T),{modelValue:t.pageInput.dynamicFilter,"onUpdate:modelValue":o[0]||(o[0]=n=>t.pageInput.dynamicFilter=n),filters:t.filters,onSearch:u},null,8,["modelValue","filters"])]),_:1})]),_:1}),i(_,{xs:24,sm:12,md:12,lg:12,xl:12},{default:a(()=>[i(l,null,{default:a(()=>[i(f,{type:"primary",icon:"ele-Search",onClick:u},{default:a(()=>[c(" 查询 ")]),_:1}),b((s(),d(f,{type:"primary",icon:"ele-Plus",onClick:O},{default:a(()=>[c(" 新增 ")]),_:1})),[[N,"api:admin:user:add"]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),i(V,{class:"my-fill mt8",shadow:"never"},{default:a(()=>[b((s(),d(te,{data:t.userListData,"row-key":"id",style:{width:"100%"}},{default:a(()=>[i(g,{prop:"userName",label:"账号",width:"120","show-overflow-tooltip":""}),i(g,{prop:"name",label:"姓名",width:"120","show-overflow-tooltip":""},{default:a(({row:n})=>[c(P(n.name)+" ",1),n.isManager?(s(),d($,{key:0,type:"success"},{default:a(()=>[c("主管")]),_:1})):v("",!0)]),_:1}),i(g,{prop:"mobile",label:"手机号",width:"120","show-overflow-tooltip":""}),i(g,{prop:"email",label:"邮箱","min-width":"180","show-overflow-tooltip":""}),i(g,{prop:"roleNames",label:"角色","min-width":"140","show-overflow-tooltip":""},{default:a(({row:n})=>[c(P(n.roleNames?n.roleNames.join(","):""),1)]),_:1}),i(g,{label:"状态",width:"80",align:"center",fixed:"right"},{default:a(({row:n})=>[p(k)("api:admin:user:set-enable")?(s(),d(Z,{key:0,modelValue:n.enabled,"onUpdate:modelValue":h=>n.enabled=h,loading:n.loading,"active-value":!0,"inactive-value":!1,"inline-prompt":"","active-text":"启用","inactive-text":"禁用","before-change":()=>W(n)},null,8,["modelValue","onUpdate:modelValue","loading","before-change"])):(s(),ce(ue,{key:1},[n.enabled?(s(),d($,{key:0,type:"success"},{default:a(()=>[c("启用")]),_:1})):(s(),d($,{key:1,type:"danger"},{default:a(()=>[c("禁用")]),_:1}))],64))]),_:1}),i(g,{label:"操作",width:"140","header-align":"center",align:"center",fixed:"right"},{default:a(({row:n})=>[b((s(),d(f,{icon:"ele-EditPen",size:"small",text:"",type:"primary",onClick:h=>B(n)},{default:a(()=>[c("编辑")]),_:2},1032,["onClick"])),[[N,"api:admin:user:update"]]),b((s(),d(p(L),null,{dropdown:a(()=>[i(ee,null,{default:a(()=>[p(k)("api:admin:user:set-manager")?(s(),d(C,{key:0,onClick:h=>Q(n)},{default:a(()=>[c(P(n.isManager?"取消":"设置")+"主管",1)]),_:2},1032,["onClick"])):v("",!0),p(k)("api:admin:user:reset-password")?(s(),d(C,{key:1,onClick:h=>G(n)},{default:a(()=>[c("重置密码")]),_:2},1032,["onClick"])):v("",!0),p(k)("api:admin:user:delete")?(s(),d(C,{key:2,onClick:h=>q(n)},{default:a(()=>[c("删除用户")]),_:2},1032,["onClick"])):v("",!0),p(k)("api:admin:user:one-click-login")?(s(),d(C,{key:3,onClick:h=>Y(n)},{default:a(()=>[c("一键登录")]),_:2},1032,["onClick"])):v("",!0)]),_:2},1024)]),_:2},1024)),[[oe,["api:admin:user:set-manager","api:admin:user:reset-password","api:admin:user:delete","api:admin:user:one-click-login"]]])]),_:1})]),_:1},8,["data"])),[[ne,t.loading]]),E("div",he,[i(ae,{currentPage:t.pageInput.currentPage,"onUpdate:currentPage":o[2]||(o[2]=n=>t.pageInput.currentPage=n),"page-size":t.pageInput.pageSize,"onUpdate:pageSize":o[3]||(o[3]=n=>t.pageInput.pageSize=n),total:t.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:j,onCurrentChange:H,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])])]),_:1}),i(p(U),{ref_key:"userFormRef",ref:x,title:t.userFormTitle},null,8,["title"])])]),_:1})]),_:1})}}});export{je as default};
