import{P as p}from"./Pkg-f9086e37.js";import{P as I}from"./Permission-0cafc449.js";import{P as L,_ as v}from"./index-aa73a18b.js";import{g as N}from"./element-plus-e21f9b5a.js";import{j as V}from"./lodash-es-f559e892.js";import{k as u,j as b,l as K,h as B,e as M,m as d,o as S,D as $,y as i,a as m,p as n,G as g,u as j}from"./@vue-8306d5ee.js";import"./pinia-e84f6aa2.js";import"./vue-demi-71ba0ef2.js";import"./ai-form-7f0c78d7.js";import"./vue-router-c9c3da21.js";import"./vue-i18n-86a71ef1.js";import"./@intlify-869ec77a.js";import"./vue-27cbb85a.js";import"./js-cookie-edb2da2a.js";import"./@element-plus-8ef115d9.js";import"./nprogress-b96aa312.js";import"./axios-21b846bc.js";import"./mitt-f7ef348c.js";import"./vue-grid-layout-9f938aef.js";import"./@vueuse-245b213e.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-97457aaf.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e77024c3.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-c2863df3.js";const z={class:"dialog-footer"},A=u({name:"admin/pkg/components/set-pkg-menu"}),R=u({...A,props:{title:{type:String,default:""}},setup(f,{expose:k}){const r=f,_=b(()=>r.title?r.title:e.pkgName?`设置【${e.pkgName}】菜单权限`:"设置菜单权限"),e=K({showDialog:!1,loading:!1,sureLoading:!1,permissionTreeData:[],pkgId:0,pkgName:"",checkedKeys:[]}),{proxy:l}=B(),c=M(),h=async()=>{const o=await new p().getPkgPermissionList({pkgId:e.pkgId});e.checkedKeys=o!=null&&o.success?o.data:[]},y=async o=>{e.pkgId=o.id,e.pkgName=o.name,l.$modal.loading(),await P(),await h(),l.$modal.closeLoading(),e.showDialog=!0},w=()=>{e.showDialog=!1},P=async()=>{e.loading=!0;const o=await new I().getPermissionList().catch(()=>{e.loading=!1});o&&o.data&&o.data.length>0?e.permissionTreeData=L(V(o.data)):e.permissionTreeData=[],e.loading=!1},D=o=>o.row?"is-penultimate":"",x=()=>{e.showDialog=!1},T=async()=>{var a;e.sureLoading=!0;const o=(a=c.value)==null?void 0:a.getCheckedKeys(!0),t={pkgId:e.pkgId,permissionIds:o},s=await new p().setPkgPermissions(t,{showSuccessMessage:!0}).catch(()=>{e.sureLoading=!1});e.sureLoading=!1,s!=null&&s.success&&(e.showDialog=!1)};return k({open:y,close:w}),(o,t)=>{const s=d("el-button"),a=d("el-dialog");return S(),$(a,{modelValue:e.showDialog,"onUpdate:modelValue":t[0]||(t[0]=C=>e.showDialog=C),"destroy-on-close":"",title:_.value,"append-to-body":"",draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"780px"},{footer:i(()=>[m("span",z,[n(s,{onClick:x,size:"default"},{default:i(()=>[g("取 消")]),_:1}),n(s,{type:"primary",onClick:T,size:"default",loading:e.sureLoading},{default:i(()=>[g("确 定")]),_:1},8,["loading"])])]),default:i(()=>[m("div",null,[n(j(N),{ref_key:"permissionTreeRef",ref:c,data:e.permissionTreeData,"node-key":"id","show-checkbox":"","highlight-current":"","default-expand-all":"","check-on-click-node":"","expand-on-click-node":!1,props:{class:D},"default-checked-keys":e.checkedKeys},null,8,["data","props","default-checked-keys"])])]),_:1},8,["modelValue","title"])}}});const fe=v(R,[["__scopeId","data-v-a5036191"]]);export{fe as default};
