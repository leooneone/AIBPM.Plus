import{_ as E}from"./preload-helper.101896b7.js";import{d as be,a6 as P,J as W,r as we,O as ye,o as Ie,w as q,S as c,e as p,f as _,g as l,z as a,m as r,u,x as m,y as S,n as Le,j as De,p as ke,v as Se,F as H,B as Ae,H as K,ab as xe,ac as Ee,L as Pe,I as A,l as Ve}from"./vue.df334614.js";import{c as h}from"./index.5cd0bf72.js";import{d as $e}from"./index.44ec5d1e.js";import{g as Ne,c as Re,d as Fe}from"./db.bf0a0f00.js";import{d as Oe}from"./index.97b0ee19.js";import{_ as ze}from"./_plugin-vue_export-helper.c27b6911.js";const v=C=>(xe("data-v-9ee941f7"),C=C(),Ee(),C),Me={class:"container"},Ge={class:"left-board"},je={class:"components-list"},Je=v(()=>l("div",{class:"components-title"},"工作流组件",-1)),Be=["onClick"],Te={class:"components-body"},Ue=v(()=>l("div",{class:"components-title"},"组合型组件",-1)),We=["onClick"],qe={class:"components-body"},He={class:"components-list"},Ke=v(()=>l("div",{class:"components-title"},"输入型组件",-1)),Qe=["onClick"],Xe={class:"components-body"},Ye=v(()=>l("div",{class:"components-title"},"选择型组件",-1)),Ze=["onClick"],eo={class:"components-body"},oo=v(()=>l("div",{class:"components-title"},"布局型组件",-1)),to=["onClick"],no={class:"components-body"},so={class:"center-board"},io={class:"action-bar"},ao=m("手机 "),lo=m("电脑"),ro=m("预览"),co=m("清空"),mo={id:"device",ref:"device"},fo={class:"devicebody"},po={class:"devicescreen"},uo={class:"empty-info"},go=v(()=>l("div",{class:"devicecamera"},null,-1)),_o=v(()=>l("input",{id:"copyNode",type:"hidden"},null,-1)),vo={class:"dialog-footer"},ho=m("知道了"),Co=be({name:"index",props:{conf:Object},setup(C,{expose:Q}){const b=C,X=P(()=>E(()=>import("./RenderPanel.f5b5447f.js"),["assets/RenderPanel.f5b5447f.js","assets/RenderPanel.vue_vue_type_script_setup_true_name_render-panel_lang.6a147aeb.js","assets/preload-helper.101896b7.js","assets/vue.df334614.js"])),Y=P(()=>E(()=>import("./preview.faf040da.js"),["assets/preview.faf040da.js","assets/preload-helper.101896b7.js","assets/vue.df334614.js","assets/preview.ffee983c.css"])),Z=P(()=>E(()=>import("./RightPanel.db421e66.js"),["assets/RightPanel.db421e66.js","assets/TreeNodeDialog.a28a042f.js","assets/index.44ec5d1e.js","assets/db.bf0a0f00.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/vue.df334614.js","assets/IconsDialog.3ffee3e9.js","assets/IconsDialog.b33d00de.css","assets/index.5cd0bf72.js","assets/vuedraggable.umd.13ffdc0e.js","assets/_commonjsHelpers.042e6b4d.js","assets/vue.runtime.esm-bundler.7d88586f.js","assets/index.97b0ee19.js","assets/RightPanel.600aeae7.css"])),w=P(()=>E(()=>import("./vuedraggable.umd.13ffdc0e.js").then(e=>e.v),["assets/vuedraggable.umd.13ffdc0e.js","assets/_commonjsHelpers.042e6b4d.js","assets/vue.runtime.esm-bundler.7d88586f.js","assets/vue.df334614.js"])),N=Ne(),{proxy:V}=Pe(),ee=W("updateFlow"),oe=W("updateFormItemList"),R=we();Re();const o=ye({isErrorShow:!1,validResults:[],formConf:h.formConf,customComponents:h.customComponents,inputComponents:h.inputComponents,selectComponents:h.selectComponents,layoutComponents:h.layoutComponents,customGroupComponents:h.customGroupComponents,labelWidth:100,drawingList:[],drawingData:{},activeId:"",drawerVisible:!1,generateConf:null,activeData:{},activeTabName:"custom",deviceMode:"portrait",drawerSize:"490px",flowConditions:[],bpm:{flowCondicitons:[]},tempActiveData:{}}),te=()=>{typeof b.conf=="object"&&b.conf!==null?(o.drawingList=b.conf.formItems||[],Object.assign(o.formConf,b.conf)):N&&(o.formConf=N),o.formConf.model={},o.formConf.mode="designer",K(e=>ne())};Ie(()=>{}),q(()=>b.conf,e=>{typeof e=="object"&&e!==null&&(o.drawingList=e.formItems||[],Object.assign(o.formConf,e))});const ne=()=>{},se=()=>new Promise((e,t)=>{o.validResults=[],o.drawingList.length===0&&o.validResults.push("表单不允许为空"),de()&&o.validResults.push("您的行容器中没有组件"),o.validResults.length>0&&(o.isErrorShow=!0,t()),o.drawingList&&o.drawingList.length>0&&e({...o.formConf,formItems:JSON.parse(JSON.stringify(o.drawingList))}),e(!1)}),F=(e,t=!1)=>{let n=o.flowConditions.findIndex(s=>s.formId===e);return t?n:n>-1},O=e=>{e.formId===null||e.formId===void 0||(F(e.formId)||o.flowConditions.unshift(e),ee({list:o.drawingList,conditions:o.flowConditions}))},$=e=>{if(e==null)return;let t=F(e,!0),n=o.flowConditions;t>-1&&n.splice(t,1)},z=()=>{o.flowConditions=[]},ie=e=>{console.log("handlerListChange222"),z();const t=(s,d)=>!(["fc-date-duration","fc-time-duration"].includes(s.tag)&&!s.showDuration||d&&d.rowType==="table"||!s.proCondition||!s.required||s.tag==="el-select"&&s.multiple),n=(s,d)=>{s&&(Array.isArray(s.children)&&s.children.forEach(D=>n(D,s)),Array.isArray(s)?s.forEach(n):t(s,d)?O(s):$(s.formId))};n(o.drawingList),Fe(o.drawingList),oe(o.drawingList)},y=e=>{e&&(o.activeData=e,o.formConf.activeId=e.formId)},I=(e,t)=>{e.from!==e.to&&(o.activeId=o.tempActiveData.formId,o.activeData=o.tempActiveData)},ae=(e,t)=>{y(o.drawingList[e.newIndex])},le=e=>o.drawingList.reduce((t,n)=>n.children?t+n.children.reduce((s,d)=>d.tag===e?s+1:s,0):n.tag===e?t+1:t,0),re=e=>{const t=le(e.tag);return t?e.label+t:e.label},L=e=>{const t=g(e);o.drawingList.push(t),y(t)},M=()=>new Date().getTime(),g=e=>{const t=JSON.parse(JSON.stringify(e));return t.formId=`${M()}`,t.layout||(t.layout="colFormItem"),t.layout==="colFormItem"?(t.label=re(t),t.vModel=`field${t.formId}`,t.placeholder!==void 0&&(t.placeholder+=t.label),o.tempActiveData=t):t.layout==="rowFormItem"&&(t.rowType==="table"&&(t.vModel=`field${t.formId}`),t.componentName=`row${t.formId}`,t.gutter=o.formConf.gutter,G(t),o.tempActiveData=t),o.tempActiveData},G=e=>{e.children&&e.children.length&&e.children.forEach((n,s)=>{n.formId=e.formId+s+1,n.__ID=n.formId+new Date().getTime(),n.layout||(n.layout="colFormItem"),n.layout==="colFormItem"?(n.vModel=`field${n.formId}`,n.placeholder!==void 0&&(n.placeholder+=n.label)):n.layout==="rowFormItem"&&(delete n.label,n.componentName=`row${n.formId}`,n.gutter=o.formConf.gutter,G(n))})},de=()=>{const e=o.drawingList.find(t=>t.layout==="rowFormItem");if(e)return e.children.length===0},ce=()=>{var t;var e=JSON.parse(JSON.stringify(o.drawingList));(t=R.value)==null||t.open(e)},me=()=>{if(J()){V.$modal.msgWarning("尚有组件已作为流程判断条件，无法删除");return}V.$modal.confirm("确定要清空所有组件吗？","提示",{type:"warning"}).then(()=>{o.drawingList=[],z()})},j=e=>(e.formId=M(),e.layout==="colFormItem"?e.vModel=`field${e.formId}`:e.layout==="rowFormItem"&&(e.componentName=`row${e.formId}`),Array.isArray(e.children)&&(e.children=e.children.map(t=>j(t))),e),J=e=>{},B=e=>e?!!o.bpm.flowCondicitons.find(n=>n.formId==e.formId)&&J([e.formId]):!1,T=e=>{if(Array.isArray(e.children)&&e.children.length){if(e.rowType==="table")return!1;let t=!1;const n=s=>{t||Array.isArray(s)&&s.some(d=>(d.children&&n(d.children),B(d)))&&(t=!0)};return n(e.children),t}else return B(e)},fe=(e,t)=>{let n=$e(e);n=j(n),t.push(n),y(n)},pe=(e,t)=>{if(T(t[e])){V.$modal.msgWarning("该组件已作为流程判断条件，无法删除");return}$(t[e].formId),t.splice(e,1),K(()=>{const n=o.drawingList.length;n&&y(o.drawingList[n-1])})},ue=e=>{e=g(e),e.vModel=o.activeData.vModel,e.formId=o.activeId,e.span=o.activeData.span,delete o.activeData.tag,delete o.activeData.tagIcon,Object.keys(e).forEach(t=>{o.activeData[t]!==void 0&&typeof o.activeData[t]==typeof e[t]&&(e[t]=o.activeData[t])}),o.activeData=e,U(e,o.drawingList)},U=(e,t)=>{const n=t.findIndex(s=>s.formId===o.activeId);n>-1?t.splice(n,1,e):t.forEach(s=>{Array.isArray(s.children)&&U(e,s.children)})};return A("activeFormItem",y),A("deleteItem",pe),A("copyItem",fe),A("addPCondition",O),A("delPCondition",$),q(()=>o.drawingList,e=>{console.log("watch drawingList"),e&&Oe(ie(),400)},{deep:!0,immediate:!0}),te(),Q({getSetting:se}),(e,t)=>{const n=c("SvgIcon"),s=c("el-tab-pane"),d=c("el-tabs"),D=c("el-scrollbar"),k=c("el-button"),ge=c("el-button-group"),_e=c("el-form"),ve=c("el-tooltip"),he=c("el-alert"),Ce=c("el-dialog");return p(),_(H,null,[l("div",Me,[l("div",Ge,[a(D,{class:"left-scrollbar"},{default:r(()=>[a(d,{modelValue:o.activeTabName,"onUpdate:modelValue":t[2]||(t[2]=i=>o.activeTabName=i),stretch:!0},{default:r(()=>[a(s,{label:"定制组件",name:"custom"},{default:r(()=>[l("div",je,[Je,a(u(w),{class:"components-draggable",modelValue:o.customComponents,"onUpdate:modelValue":t[0]||(t[0]=i=>o.customComponents=i),group:{name:"componentsGroup",pull:"clone",put:!1},clone:g,draggable:".components-item",sort:!1,onEnd:I,"item-key":"index"},{item:r(({element:i,index:f})=>[(p(),_("div",{key:f,class:"components-item",onClick:x=>L(i)},[l("div",Te,[a(n,{name:"/assets/bpm/svg/"+i.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-primary)"},null,8,["name"]),m(" "+S(i.label),1)])],8,Be))]),_:1},8,["modelValue"]),Ue,a(u(w),{class:"components-draggable",list:o.customGroupComponents,group:{name:"componentsGroup",pull:"clone",put:!1},clone:g,draggable:".components-item",sort:!1,onEnd:I,"item-key":"id"},{item:r(({element:i,index:f})=>[(p(),_("div",{key:f,class:"components-item custom-component",onClick:x=>L(i)},[l("div",qe,[a(n,{name:"/assets/bpm/svg/"+i.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-warning)"},null,8,["name"]),m(" "+S(i.label),1)])],8,We))]),_:1},8,["list"])])]),_:1}),a(s,{label:"基础组件",name:"common"},{default:r(()=>[l("div",He,[Ke,a(u(w),{class:"components-draggable",modelValue:o.inputComponents,"onUpdate:modelValue":t[1]||(t[1]=i=>o.inputComponents=i),group:{name:"componentsGroup",pull:"clone",put:!1},clone:g,draggable:".components-item",sort:!1,onEnd:I,"item-key":"index"},{item:r(({element:i,index:f})=>[(p(),_("div",{key:f,class:"components-item",onClick:x=>L(i)},[l("div",Xe,[m(S(i.label)+" ",1),a(n,{name:"/assets/bpm/svg/"+i.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-primary)"},null,8,["name"])])],8,Qe))]),_:1},8,["modelValue"]),Ye,a(u(w),{class:"components-draggable",list:o.selectComponents,group:{name:"componentsGroup",pull:"clone",put:!1},clone:g,draggable:".components-item",sort:!1,onEnd:I},{item:r(({element:i,index:f})=>[(p(),_("div",{key:f,class:"components-item",onClick:x=>L(i)},[l("div",eo,[m(S(i.label)+" ",1),a(n,{name:"/assets/bpm/svg/"+i.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-primary)"},null,8,["name"])])],8,Ze))]),_:1},8,["list"]),oo,a(u(w),{class:"components-draggable",list:o.layoutComponents,group:{name:"componentsGroup",pull:"clone",put:!1},clone:g,draggable:".components-item",sort:!1,onEnd:I},{item:r(({element:i,index:f})=>[(p(),_("div",{key:f,class:"components-item",onClick:x=>L(i)},[l("div",no,[m(S(i.label)+" ",1),a(n,{name:"/assets/bpm/svg/"+i.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-danger)"},null,8,["name"])])],8,to))]),_:1},8,["list"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l("div",so,[l("div",io,[a(ge,{style:{"padding-top":"10px"}},{default:r(()=>[a(k,{onClick:t[3]||(t[3]=i=>o.drawerSize="390px"),icon:"ele-Cellphone",title:"手机"},{default:r(()=>[ao]),_:1}),a(k,{onClick:t[4]||(t[4]=i=>o.drawerSize="100%"),icon:"ele-Monitor",title:"电脑"},{default:r(()=>[lo]),_:1}),a(k,{icon:"ele-View",plain:"",onClick:ce,title:"预览"},{default:r(()=>[ro]),_:1}),a(k,{icon:"ele-Delete",plain:"",onClick:me,title:"清空"},{default:r(()=>[co]),_:1})]),_:1})]),l("div",mo,[l("div",{class:Le(["outerdevice",[o.deviceMode]]),style:De({width:o.drawerSize})},[l("div",fo,[l("div",po,[a(D,{class:"center-scrollbar",style:{}},{default:r(()=>[a(_e,{model:o.formConf.model,class:"drawing-board",size:o.formConf.size,"label-position":o.formConf.labelPosition,disabled:o.formConf.disabled,"label-width":o.formConf.labelWidth+"px"},{default:r(()=>[a(u(X),{list:o.drawingList,animation:200,group:"componentsGroup",onEnd:ae,tag:"el-row",conf:o.formConf,style:{marginLeft:0,alignContent:"start",height:"100%"},gutter:o.formConf.gutter},null,8,["list","conf","gutter"])]),_:1},8,["model","size","label-position","disabled","label-width"]),ke(l("div",uo,"从左侧拖入或点选组件进行表单设计",512),[[Se,!o.drawingList.length]])]),_:1})]),go,a(ve,{effect:"dark",content:"切换横/竖模式",placement:"top"},{default:r(()=>[l("div",{class:"devicehomebutton",onClick:t[5]||(t[5]=i=>e.deviceMode=e.deviceMode==="landscape"?"portrait":"landscape")})]),_:1})])],6)],512)]),a(u(Z),{"active-data":o.activeData,"form-conf":o.formConf,"show-field":o.drawingList&&o.drawingList.length,"could-change-require":!T(o.activeData),list:o.drawingList,onTagChange:ue},null,8,["active-data","form-conf","show-field","could-change-require","list"]),_o]),a(Ce,{modelValue:o.isErrorShow,"onUpdate:modelValue":t[7]||(t[7]=i=>o.isErrorShow=i),title:"验证提示"},{footer:r(()=>[l("span",vo,[a(k,{onClick:t[6]||(t[6]=i=>o.isErrorShow=!1)},{default:r(()=>[ho]),_:1})])]),default:r(()=>[(p(!0),_(H,null,Ae(o.validResults,i=>(p(),Ve(he,{type:"error",title:i,style:{"margin-bottom":"10px"}},null,8,["title"]))),256))]),_:1},8,["modelValue"]),a(u(Y),{ref_key:"previewPanelRef",ref:R},null,512)],64)}}});const So=ze(Co,[["__scopeId","data-v-9ee941f7"]]);export{So as default};
