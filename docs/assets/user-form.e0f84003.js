import{_ as z}from"./preload-helper.101896b7.js";import{U as f}from"./User.3d01ec91.js";import{O as M}from"./Org.1b60eeb8.js";import{R as $}from"./Role.9719caad.js";import{t as F,l as V}from"./tree.d5b28a07.js";import{t as P,a as K}from"./test.dc379863.js";import{e as j}from"./mitt.7f99bbc0.js";import{c as G}from"./cloneDeep.d5c086cd.js";import{d as y,a6 as H,r as x,O as J,K as Q,w as b,S as m,e as g,f as h,z as o,m as t,g as W,u as r,F as X,B as Y,l as I,t as Z,x as U,L as ee}from"./vue.72f2672d.js";import"./http-client.3dda918f.js";import"./index.57385bce.js";import"./index.0c380c40.js";import"./index.41e0794f.js";import"./storage.6b2e7cd0.js";import"./toolsValidate.7cb139e2.js";import"./_Uint8Array.e4cf923d.js";import"./_initCloneObject.7b8933bc.js";const le={class:"dialog-footer"},oe=U("取 消"),ae=U("确 定"),te=y({name:"admin/user/form"}),Ie=y({...te,props:{title:{type:String,default:""}},setup(D,{expose:T}){const L=H(()=>z(()=>import("./my-select-user.00d964ac.js"),["assets/my-select-user.00d964ac.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js"])),{proxy:p}=ee(),k=x(),c=x(),l=J({showDialog:!1,sureLoading:!1,form:{orgIds:[],roleIds:[]},orgs:[],orgTreeData:[],roleTreeData:[]}),{form:d}=Q(l);b(()=>l.form.orgIds,a=>{if(a&&a.length>0){let e=[];F(G(l.orgTreeData)).forEach(i=>{a.some(n=>i.id===n)&&e.push(i)}),l.orgs=e}else l.orgs=[]},{immediate:!0}),b(()=>l.orgs,()=>{var a;(a=l.orgs)!=null&&a.some(e=>e.id===l.form.orgId)||(l.form.orgId=l.orgs&&l.orgs.length>0?l.orgs[0].id:void 0)},{immediate:!0,deep:!0});const v=async()=>{const a=await new M().getList();a!=null&&a.success&&a.data&&a.data.length>0?l.orgTreeData=V(a.data):l.orgTreeData=[]},C=async()=>{const a=await new $().getList();a!=null&&a.success&&a.data&&a.data.length>0?l.roleTreeData=V(a.data):l.roleTreeData=[]},R=async(a={})=>{if(p.$modal.loading(),await v(),await C(),a.id>0){const e=await new f().get({id:a.id}).catch(()=>{p.$modal.closeLoading()});e!=null&&e.success&&(l.form=e.data)}else l.form={orgIds:[],roleIds:[],staff:{}};p.$modal.closeLoading(),l.showDialog=!0},N=()=>{l.showDialog=!1},S=()=>{c.value.validate(async a=>{if(!a)return;l.sureLoading=!0;let e={};l.form.id!=null&&l.form.id>0?e=await new f().update(l.form,{showSuccessMessage:!0}).catch(()=>{l.sureLoading=!1}):e=await new f().add(l.form,{showSuccessMessage:!0}).catch(()=>{l.sureLoading=!1}),l.sureLoading=!1,e!=null&&e.success&&(j.emit("refreshUser"),l.showDialog=!1)})};return T({open:R}),(a,e)=>{const i=m("el-input"),n=m("el-form-item"),u=m("el-col"),_=m("el-tree-select"),q=m("el-option"),A=m("el-select"),B=m("el-row"),E=m("el-form"),w=m("el-button"),O=m("el-dialog");return g(),h("div",null,[o(O,{modelValue:l.showDialog,"onUpdate:modelValue":e[9]||(e[9]=s=>l.showDialog=s),"destroy-on-close":"",title:D.title,draggable:"",width:"769px"},{footer:t(()=>[W("span",le,[o(w,{onClick:N,size:"default"},{default:t(()=>[oe]),_:1}),o(w,{type:"primary",onClick:S,size:"default",loading:l.sureLoading},{default:t(()=>[ae]),_:1},8,["loading"])])]),default:t(()=>[o(E,{ref_key:"formRef",ref:c,model:r(d),size:"default","label-width":"80px"},{default:t(()=>[o(B,{gutter:35},{default:t(()=>[o(u,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"姓名",prop:"name",rules:[{required:!0,message:"请输入姓名",trigger:["blur","change"]}]},{default:t(()=>[o(i,{modelValue:r(d).name,"onUpdate:modelValue":e[0]||(e[0]=s=>r(d).name=s),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),o(u,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"手机号",prop:"mobile",rules:[{required:!0,message:"请输入手机号",trigger:["blur","change"]},{validator:r(P),trigger:["blur","change"]}]},{default:t(()=>[o(i,{modelValue:r(d).mobile,"onUpdate:modelValue":e[1]||(e[1]=s=>r(d).mobile=s),autocomplete:"off",maxlength:"11"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),o(u,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"部门",prop:"orgIds",rules:[{required:!0,message:"请选择部门",trigger:["change"]}]},{default:t(()=>[o(_,{ref_key:"orgTreeSelectRef",ref:k,modelValue:r(d).orgIds,"onUpdate:modelValue":e[2]||(e[2]=s=>r(d).orgIds=s),placeholder:"请选择部门",data:l.orgTreeData,"node-key":"id",props:{label:"name"},"check-strictly":"","default-expand-all":"","render-after-expand":"","fit-input-width":"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",class:"w100"},null,8,["modelValue","data"])]),_:1})]),_:1}),o(u,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"主属部门",prop:"orgId",rules:[{required:!0,message:"请选择主属部门",trigger:["change"]}]},{default:t(()=>[o(A,{modelValue:r(d).orgId,"onUpdate:modelValue":e[3]||(e[3]=s=>r(d).orgId=s),placeholder:"请选择主属部门",class:"w100"},{default:t(()=>[(g(!0),h(X,null,Y(l.orgs,s=>(g(),I(q,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(u,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"用户名",prop:"userName",rules:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}]},{default:t(()=>[o(i,{modelValue:r(d).userName,"onUpdate:modelValue":e[4]||(e[4]=s=>r(d).userName=s),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),r(d).id>0?Z("",!0):(g(),I(u,{key:0,xs:24,sm:24,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"密码",prop:"password",rules:[{required:!0,message:"请输入密码",trigger:["blur","change"]}]},{default:t(()=>[o(i,{key:"password",modelValue:r(d).password,"onUpdate:modelValue":e[5]||(e[5]=s=>r(d).password=s),"show-password":"",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1})),o(u,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"直属主管",prop:"managerUserId"},{default:t(()=>[o(r(L),{modelValue:r(d).managerUserId,"onUpdate:modelValue":e[6]||(e[6]=s=>r(d).managerUserId=s),name:r(d).managerUserName,clearable:""},null,8,["modelValue","name"])]),_:1})]),_:1}),o(u,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"角色",prop:"roles"},{default:t(()=>[o(_,{modelValue:r(d).roleIds,"onUpdate:modelValue":e[7]||(e[7]=s=>r(d).roleIds=s),placeholder:"请选择角色",data:l.roleTreeData,"node-key":"id",props:{label:"name"},"default-expand-all":"","render-after-expand":"","fit-input-width":"",clearable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",class:"w100"},null,8,["modelValue","data"])]),_:1})]),_:1}),o(u,{xs:24,sm:12,md:12,lg:12,xl:12},{default:t(()=>[o(n,{label:"邮箱",prop:"email",rules:[{validator:r(K),trigger:["blur","change"]}]},{default:t(()=>[o(i,{modelValue:r(d).email,"onUpdate:modelValue":e[8]||(e[8]=s=>r(d).email=s),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{Ie as default};
