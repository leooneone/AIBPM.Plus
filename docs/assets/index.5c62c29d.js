var G=Object.defineProperty;var q=(_,p,s)=>p in _?G(_,p,{enumerable:!0,configurable:!0,writable:!0,value:s}):_[p]=s;var E=(_,p,s)=>(q(_,typeof p!="symbol"?p+"":p,s),s);import{_ as H}from"./preload-helper.101896b7.js";import{d as P,a6 as J,r as N,O as U,o as Q,P as W,S as r,a4 as L,e as f,f as X,z as n,m as a,G as Y,E as Z,p as k,l as y,u as ee,x as w,L as te}from"./vue.72f2672d.js";import{A as S}from"./Api.790b3ba4.js";import{H as oe}from"./http-client.3dda918f.js";import{t as ae,l as M}from"./tree.d5b28a07.js";import{e as R}from"./mitt.7f99bbc0.js";import{c as $}from"./cloneDeep.d5c086cd.js";import{i as ne}from"./index.0c380c40.js";import"./index.57385bce.js";import"./storage.6b2e7cd0.js";import"./_Uint8Array.e4cf923d.js";import"./_initCloneObject.7b8933bc.js";import"./index.41e0794f.js";class F extends oe{constructor(){super(...arguments);E(this,"getSwaggerResources",(s,u={})=>this.request({path:s,method:"GET",secure:!0,format:"json",...u}));E(this,"getSwaggerJson",(s,u={})=>this.request({path:s,method:"GET",secure:!0,format:"json",...u}))}}const se={style:{padding:"0px 0px 8px 8px"}},ie=w(" 查询 "),le=w(" 新增 "),re=w(" 同步 "),pe=w("启用"),ce=w("禁用"),de=w("编辑"),me=w("删除"),fe=P({name:"admin/api"}),Ee=P({...fe,setup(_){const p=J(()=>H(()=>import("./api-form.6886e136.js"),["assets/api-form.6886e136.js","assets/Api.790b3ba4.js","assets/http-client.3dda918f.js","assets/index.57385bce.js","assets/index.0c380c40.js","assets/vue.72f2672d.js","assets/index.41e0794f.js","assets/storage.6b2e7cd0.js","assets/mitt.7f99bbc0.js"])),{proxy:s}=te(),u=N(),e=U({loading:!1,syncLoading:!1,apiFormTitle:"",filterModel:{name:""},apiTreeData:[],formApiTreeData:[],expandRowKeys:[]});Q(async()=>{await v(),e.expandRowKeys=ae($(e.apiTreeData)).filter(t=>t.parentId===0).map(t=>t.id+""),R.on("refreshApi",async()=>{v()})}),W(()=>{R.off("refreshApi")});const v=async()=>{e.loading=!0;const t=await new S().getList();t.data&&t.data.length>0?(e.apiTreeData=M($(t.data)),e.formApiTreeData=M(t.data.filter(i=>i.parentId===0))):(e.apiTreeData=[],e.formApiTreeData=[]),e.loading=!1},j=()=>{e.apiFormTitle="新增接口",u.value.open()},K=t=>{e.apiFormTitle="编辑接口",u.value.open(t)},V=t=>{s.$modal.confirmDelete(`确定要删除接口【${t.label}】?`,{type:"info"}).then(async()=>{await new S().delete({id:t.id},{loading:!0}),v()}).catch(()=>{})},I=async t=>{const i=await new F().getSwaggerJson(t.url,{showErrorMessage:!1});if(!i)return;const h=i.tags,g=i.paths,o=[],c=t.url.split("/"),d=c.length>=2?c[c.length-2]:"";if(d!==""){if(o[o.length]={label:t.name,path:d},h&&h.length>0&&h.forEach(m=>{o[o.length]={label:m.description,path:m.name,parentPath:d}}),g)for(const[m,l]of Object.entries(g)){const A=Object.keys(l),T=Object.values(l),x=T&&T.length>0?T[0]:{},C=x.tags&&x.tags.length>0?x.tags[0]:"";o[o.length]={label:x.summary,path:m,parentPath:C,httpMethods:A.join(",")}}return await new S().sync({apis:o})}},O=()=>{e.syncLoading=!0;const t=["/swagger-resources"],i=t.length-1;t.forEach(async(h,g)=>{const o=await new F().getSwaggerResources(h,{showErrorMessage:!1}).catch(()=>{e.syncLoading=!1});if(ne(o)&&(o==null?void 0:o.length)>0)for(let c=0,d=o.length,m=d-1;c<d;c++){const l=o[c];await I(l).catch(()=>{s.$modal.msgSuccess(`同步${l.name}失败`)})}g===i&&(e.syncLoading=!1,s.$modal.msgSuccess("同步完成"),v())})};return(t,i)=>{const h=r("el-input"),g=r("el-form-item"),o=r("el-button"),c=r("el-popconfirm"),d=r("el-form"),m=r("el-card"),l=r("el-table-column"),A=r("el-tag"),T=r("el-table"),x=r("el-col"),C=r("el-row"),D=L("auth"),B=L("loading");return f(),X("div",se,[n(C,{gutter:8,style:{width:"100%"}},{default:a(()=>[n(x,{span:24,xs:24},{default:a(()=>[n(m,{shadow:"never","body-style":{paddingBottom:"0"},style:{"margin-top":"8px"}},{default:a(()=>[n(d,{model:e.filterModel,inline:!0,onSubmit:i[1]||(i[1]=Y(()=>{},["stop","prevent"]))},{default:a(()=>[n(g,{label:"接口名称",prop:"name"},{default:a(()=>[n(h,{modelValue:e.filterModel.name,"onUpdate:modelValue":i[0]||(i[0]=b=>e.filterModel.name=b),placeholder:"接口名称",onKeyup:Z(v,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),n(g,null,{default:a(()=>[n(o,{type:"primary",icon:"ele-Search",onClick:v},{default:a(()=>[ie]),_:1}),k((f(),y(o,{type:"primary",icon:"ele-Plus",onClick:j},{default:a(()=>[le]),_:1})),[[D,"api:admin:api:add"]]),n(c,{title:"确定要同步接口","hide-icon":"",width:"180","hide-after":"0",onConfirm:O},{reference:a(()=>[k((f(),y(o,{loading:e.syncLoading,type:"primary",icon:"ele-Refresh"},{default:a(()=>[re]),_:1},8,["loading"])),[[D,"api:admin:api:sync"]])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(m,{shadow:"never",style:{"margin-top":"8px"}},{default:a(()=>[k((f(),y(T,{data:e.apiTreeData,style:{width:"100%"},"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},"expand-row-keys":e.expandRowKeys},{default:a(()=>[n(l,{prop:"label",label:"接口名称","min-width":"120","show-overflow-tooltip":""}),n(l,{prop:"path",label:"接口地址","min-width":"120","show-overflow-tooltip":""}),n(l,{prop:"description",label:"接口描述","min-width":"120","show-overflow-tooltip":""}),n(l,{label:"状态",width:"80",align:"center","show-overflow-tooltip":""},{default:a(({row:b})=>[b.enabled?(f(),y(A,{key:0,type:"success"},{default:a(()=>[pe]),_:1})):(f(),y(A,{key:1,type:"danger"},{default:a(()=>[ce]),_:1}))]),_:1}),n(l,{label:"操作",width:"160",fixed:"right","header-align":"center",align:"center"},{default:a(({row:b})=>[k((f(),y(o,{icon:"ele-EditPen",size:"small",text:"",type:"primary",onClick:z=>K(b)},{default:a(()=>[de]),_:2},1032,["onClick"])),[[D,"api:admin:api:update"]]),k((f(),y(o,{icon:"ele-Delete",size:"small",text:"",type:"danger",onClick:z=>V(b)},{default:a(()=>[me]),_:2},1032,["onClick"])),[[D,"api:admin:api:delete"]])]),_:1})]),_:1},8,["data","expand-row-keys"])),[[B,e.loading]])]),_:1})]),_:1})]),_:1}),n(ee(p),{ref_key:"apiFormRef",ref:u,title:e.apiFormTitle,"api-tree-data":e.formApiTreeData},null,8,["title","api-tree-data"])])}}});export{Ee as default};
