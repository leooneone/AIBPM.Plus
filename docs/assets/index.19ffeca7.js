var N=Object.defineProperty;var U=(k,p,t)=>p in k?N(k,p,{enumerable:!0,configurable:!0,writable:!0,value:t}):k[p]=t;var m=(k,p,t)=>(U(k,typeof p!="symbol"?p+"":p,t),t);import{_ as Y}from"./preload-helper.101896b7.js";import{d as $,a6 as J,r as K,O as G,o as F,S as _,a4 as D,e as d,f as Q,z as s,m as i,G as W,E as X,p as b,l as g,t as v,g as Z,u as ee,x as h,L as te}from"./vue.df334614.js";import{H as ae,C as T}from"./http-client.ff22776c.js";import{d as se}from"./dayjs.min.0acfa903.js";import"./index.de963593.js";import"./index.390778f0.js";import"./index.4621962e.js";import"./storage.08e609be.js";import"./js.cookie.cf83ad76.js";import"./_commonjsHelpers.042e6b4d.js";class w extends ae{constructor(){super(...arguments);m(this,"get",(t,n={})=>this.request({path:"/api/admin/task/get",method:"GET",query:t,secure:!0,format:"json",...n}));m(this,"getPage",(t,n={})=>this.request({path:"/api/admin/task/get-page",method:"POST",body:t,secure:!0,type:T.Json,format:"json",...n}));m(this,"add",(t,n={})=>this.request({path:"/api/admin/task/add",method:"POST",body:t,secure:!0,type:T.Json,format:"json",...n}));m(this,"update",(t,n={})=>this.request({path:"/api/admin/task/update",method:"PUT",body:t,secure:!0,type:T.Json,...n}));m(this,"pause",(t,n={})=>this.request({path:"/api/admin/task/pause",method:"POST",query:t,secure:!0,...n}));m(this,"resume",(t,n={})=>this.request({path:"/api/admin/task/resume",method:"POST",query:t,secure:!0,...n}));m(this,"run",(t,n={})=>this.request({path:"/api/admin/task/run",method:"POST",query:t,secure:!0,...n}));m(this,"delete",(t,n={})=>this.request({path:"/api/admin/task/delete",method:"DELETE",query:t,secure:!0,...n}))}}const oe={style:{padding:"0px 0px 8px 8px"}},ne=h(" 查询 "),ie=h("运行中"),le=h("暂停"),re=h("完成"),pe=h("日志"),de=h("暂停"),ue=h("启动"),ce=h("执行"),me=h("删除"),_e={class:"my-flex my-flex-end",style:{"margin-top":"20px"}},ge=$({name:"admin/task"}),Se=$({...ge,setup(k){const p=J(()=>Y(()=>import("./task-logs.bc27bb44.js"),["assets/task-logs.bc27bb44.js","assets/http-client.ff22776c.js","assets/index.de963593.js","assets/index.390778f0.js","assets/vue.df334614.js","assets/index.4621962e.js","assets/storage.08e609be.js","assets/js.cookie.cf83ad76.js","assets/dayjs.min.0acfa903.js","assets/_commonjsHelpers.042e6b4d.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/task-logs.275dba9e.css"])),{proxy:t}=te(),n=K(),o=G({loading:!1,taskFormTitle:"",filterModel:{topic:""},total:0,pageInput:{currentPage:1,pageSize:20},taskListData:[],taskLogsTitle:""});F(()=>{u()});const L=(e,l,f)=>{let c="";switch(f){case 1:case"SEC":c="按秒触发";break;case 11:case"RunOnDay":c="每天";break;case 12:case"RunOnWeek":c="每星期几";break;case 13:case"RunOnMonth":c="每月第几天";break;case 21:case"Custom":c="自定义";break}return c},S=(e,l,f)=>se(f).format("YYYY-MM-DD HH:mm:ss"),u=async()=>{var l,f;o.loading=!0;const e=await new w().getPage(o.pageInput);o.taskListData=((l=e==null?void 0:e.data)==null?void 0:l.list)??[],o.total=((f=e.data)==null?void 0:f.total)??0,o.loading=!1},M=e=>{o.taskLogsTitle=`${e.topic}${e.id}运行日志`,n.value.open(e)},R=e=>{t.$modal.confirmDelete(`确定要运行【${e.topic}】任务?`).then(async()=>{await new w().run({id:e.id},{loading:!0,showSuccessMessage:!0}),u()}).catch(()=>{})},I=e=>{t.$modal.confirmDelete(`确定要暂停【${e.topic}】任务?`).then(async()=>{await new w().pause({id:e.id},{loading:!0,showSuccessMessage:!0}),u()}).catch(()=>{})},O=e=>{t.$modal.confirmDelete(`确定要启动【${e.topic}】任务?`).then(async()=>{await new w().resume({id:e.id},{loading:!0,showSuccessMessage:!0}),u()}).catch(()=>{})},E=e=>{t.$modal.confirmDelete(`确定要删除【${e.topic}】任务?`).then(async()=>{await new w().delete({id:e.id},{loading:!0,showSuccessMessage:!0}),u()}).catch(()=>{})},V=e=>{o.pageInput.pageSize=e,u()},q=e=>{o.pageInput.currentPage=e,u()};return(e,l)=>{const f=_("el-input"),c=_("el-form-item"),y=_("el-button"),j=_("el-form"),z=_("el-card"),r=_("el-table-column"),P=_("el-tag"),B=_("el-table"),A=_("el-pagination"),C=D("auth"),H=D("loading");return d(),Q("div",oe,[s(z,{shadow:"never","body-style":{paddingBottom:"0"},style:{"margin-top":"8px"}},{default:i(()=>[s(j,{model:o.filterModel,inline:!0,onSubmit:l[1]||(l[1]=W(()=>{},["stop","prevent"]))},{default:i(()=>[s(c,{prop:"name"},{default:i(()=>[s(f,{modelValue:o.filterModel.topic,"onUpdate:modelValue":l[0]||(l[0]=a=>o.filterModel.topic=a),placeholder:"任务名称",onKeyup:X(u,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),s(c,null,{default:i(()=>[s(y,{type:"primary",icon:"ele-Search",onClick:u},{default:i(()=>[ne]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(z,{shadow:"never",style:{"margin-top":"8px"}},{default:i(()=>[b((d(),g(B,{data:o.taskListData,"row-key":"id",style:{width:"100%"}},{default:i(()=>[s(r,{prop:"id",label:"任务编号",width:"126"}),s(r,{prop:"topic",label:"任务名称","min-width":"120","show-overflow-tooltip":""}),s(r,{prop:"status",label:"任务状态",width:"80"},{default:i(({row:a})=>[a.status===0||a.status==="Running"?(d(),g(P,{key:0,"disable-transitions":""},{default:i(()=>[ie]),_:1})):v("",!0),a.status===1||a.status==="Paused"?(d(),g(P,{key:1,type:"info","disable-transitions":""},{default:i(()=>[le]),_:1})):v("",!0),a.status===2||a.status==="Completed"?(d(),g(P,{key:2,type:"success","disable-transitions":""},{default:i(()=>[re]),_:1})):v("",!0)]),_:1}),s(r,{prop:"round",label:"运行次数",width:"80"}),s(r,{prop:"currentRound",label:"当前次数",width:"80"}),s(r,{prop:"errorTimes",label:"失败次数",width:"80"}),s(r,{prop:"body",label:"任务数据","min-width":"180","show-overflow-tooltip":""}),s(r,{prop:"interval",label:"定时类型",width:"100",formatter:L}),s(r,{prop:"intervalArgument",label:"定时参数","min-width":"180"}),s(r,{prop:"createTime",label:"创建时间",formatter:S,width:"100"}),s(r,{prop:"lastRunTime",label:"最后运行时间",formatter:S,width:"120"}),s(r,{label:"操作",width:"180",fixed:"right","header-align":"center",align:"center"},{default:i(({row:a})=>[b((d(),g(y,{icon:"ele-Tickets",size:"small",text:"",type:"primary",onClick:x=>M(a)},{default:i(()=>[pe]),_:2},1032,["onClick"])),[[C,"api:admin:task-log:get-page"]]),a.status===1||a.status==="Paused"?b((d(),g(y,{key:0,icon:"ele-VideoPause",size:"small",text:"",type:"primary",onClick:x=>I(a)},{default:i(()=>[de]),_:2},1032,["onClick"])),[[C,"api:admin:task:pause"]]):v("",!0),a.status===0||a.status==="Running"?b((d(),g(y,{key:1,icon:"ele-CaretRight",size:"small",text:"",type:"primary",onClick:x=>O(a)},{default:i(()=>[ue]),_:2},1032,["onClick"])),[[C,"api:admin:task:resume"]]):v("",!0),b((d(),g(y,{icon:"ele-Promotion",size:"small",text:"",type:"primary",onClick:x=>R(a)},{default:i(()=>[ce]),_:2},1032,["onClick"])),[[C,"api:admin:task:run"]]),b((d(),g(y,{icon:"ele-Delete",size:"small",text:"",type:"danger",onClick:x=>E(a)},{default:i(()=>[me]),_:2},1032,["onClick"])),[[C,"api:admin:task:delete"]])]),_:1})]),_:1},8,["data"])),[[H,o.loading]]),Z("div",_e,[s(A,{currentPage:o.pageInput.currentPage,"onUpdate:currentPage":l[2]||(l[2]=a=>o.pageInput.currentPage=a),"page-size":o.pageInput.pageSize,"onUpdate:page-size":l[3]||(l[3]=a=>o.pageInput.pageSize=a),total:o.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:V,onCurrentChange:q,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])])]),_:1}),s(ee(p),{ref_key:"taskLogsRef",ref:n,title:o.taskLogsTitle},null,8,["title"])])}}});export{Se as default};
