import{_ as V}from"./preload-helper.101896b7.js";import{d as ge,a6 as E,J as T,r as ve,O as he,o as Ce,w as W,S as p,e as f,f as g,g as a,z as l,m as r,u,x as m,y as I,j as be,p as ye,v as Ie,F as q,B as we,ab as De,ac as Le,L as xe,I as A,l as ke,H as Se}from"./vue.72f2672d.js";import{c as h}from"./index.940a52ab.js";import{d as Ae}from"./index.44ec5d1e.js";import{g as Ve}from"./db.cba4b16a.js";import{d as Ee}from"./index.97b0ee19.js";import{_ as Pe}from"./_plugin-vue_export-helper.c27b6911.js";import"./_commonjsHelpers.042e6b4d.js";const v=w=>(De("data-v-4c07419c"),w=w(),Le(),w),$e={class:"container"},Ne={class:"left-board"},Re={class:"components-list"},Oe=v(()=>a("div",{class:"components-title"},"工作流组件",-1)),ze=["onClick"],Fe={class:"components-body"},Ge=v(()=>a("div",{class:"components-title"},"组合型组件",-1)),Me=["onClick"],Be={class:"components-body"},Ue={class:"components-list"},je=v(()=>a("div",{class:"components-title"},"输入型组件",-1)),Je=["onClick"],Te={class:"components-body"},We=v(()=>a("div",{class:"components-title"},"辅助组件",-1)),qe=["onClick"],He={class:"components-body"},Ke=v(()=>a("div",{class:"components-title"},"选择型组件",-1)),Qe=["onClick"],Xe={class:"components-body"},Ye=v(()=>a("div",{class:"components-title"},"布局型组件",-1)),Ze=["onClick"],eo={class:"components-body"},oo={class:"center-board"},to={class:"action-bar"},no=m("手机 "),so=m("电脑"),io=m("预览"),lo=m("清空"),ao={id:"device",ref:"device"},ro={class:"devicebody"},co={class:"devicescreen"},mo={class:"empty-info"},po=v(()=>a("div",{class:"devicecamera"},null,-1)),fo=v(()=>a("input",{id:"copyNode",type:"hidden"},null,-1)),uo={class:"dialog-footer"},_o=m("知道了"),go=ge({__name:"index",props:{conf:Object},setup(w,{expose:H}){const D=w,K=E(()=>V(()=>import("./RenderPanel.031fd28e.js"),["assets/RenderPanel.031fd28e.js","assets/RenderPanel.vue_vue_type_script_setup_true_name_render-panel_lang.bbe8e092.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js"])),Q=E(()=>V(()=>import("./preview.b50abf36.js"),["assets/preview.b50abf36.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js","assets/preview.ffee983c.css"])),X=E(()=>V(()=>import("./RightPanel.128a34c1.js"),["assets/RightPanel.128a34c1.js","assets/TreeNodeDialog.bda0ea43.js","assets/index.44ec5d1e.js","assets/db.cba4b16a.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/vue.72f2672d.js","assets/IconsDialog.03d37c49.js","assets/IconsDialog.c8d435a8.css","assets/index.940a52ab.js","assets/_commonjsHelpers.042e6b4d.js","assets/vuedraggable.umd.ca06df7b.js","assets/vue.runtime.esm-bundler.2c939456.js","assets/index.97b0ee19.js","assets/RightPanel.600aeae7.css"])),C=E(()=>V(()=>import("./vuedraggable.umd.ca06df7b.js").then(e=>e.v),["assets/vuedraggable.umd.ca06df7b.js","assets/_commonjsHelpers.042e6b4d.js","assets/vue.runtime.esm-bundler.2c939456.js","assets/vue.72f2672d.js"])),N=Ve(),{proxy:P}=xe(),Y=T("isInUseByCondition"),Z=T("updateFormItemList"),R=ve(),o=he({isErrorShow:!1,validResults:[],formConf:h.formConf,extComponents:h.extComponents,customComponents:h.customComponents,inputComponents:h.inputComponents,selectComponents:h.selectComponents,layoutComponents:h.layoutComponents,customGroupComponents:h.customGroupComponents,labelWidth:100,drawingList:[],drawingData:{},activeId:"",drawerVisible:!1,generateConf:null,activeData:{},activeTabName:"custom",drawerSize:"490px",flowConditions:[],tempActiveData:{}}),ee=()=>{typeof D.conf=="object"&&D.conf!==null?(o.drawingList=D.conf.formItems||[],Object.assign(o.formConf,D.conf)):N&&(o.formConf=N),o.formConf.model={},o.formConf.mode="designer"};Ce(()=>{}),W(()=>D.conf,e=>{typeof e=="object"&&e!==null&&(o.drawingList=e.formItems||[],Object.assign(o.formConf,e))});const oe=()=>new Promise((e,t)=>{o.validResults=[],o.drawingList.length===0&&o.validResults.push("表单不允许为空"),le()&&o.validResults.push("您的行容器中没有组件"),o.validResults.length>0&&(o.isErrorShow=!0,t()),o.drawingList&&o.drawingList.length>0&&e({...o.formConf,formItems:JSON.parse(JSON.stringify(o.drawingList))}),e(!1)}),O=(e,t=!1)=>{let n=o.flowConditions.findIndex(i=>i.formId===e);return t?n:n>-1},z=e=>{e.formId===null||e.formId===void 0||O(e.formId)||o.flowConditions.unshift(e)},$=e=>{if(e==null)return;let t=O(e,!0),n=o.flowConditions;t>-1&&n.splice(t,1)},te=e=>{const t=(i,c)=>!(["fc-date-duration","fc-time-duration"].includes(i.tag)&&!i.showDuration||c&&c.rowType==="table"||!i.proCondition||!i.required||i.tag==="el-select"&&i.multiple),n=(i,c)=>{i&&(Array.isArray(i.children)&&i.children.forEach(x=>n(x,i)),Array.isArray(i)?i.forEach(n):t(i,c)?z(i):$(i.formId))};n(o.drawingList),Z(o.drawingList,o.flowConditions)},L=e=>{e&&(o.activeData=e,o.formConf.activeId=e.formId)},b=(e,t)=>{e.from!==e.to&&(o.activeId=o.tempActiveData.formId,o.activeData=o.tempActiveData)},ne=(e,t)=>{L(o.drawingList[e.newIndex])},se=e=>o.drawingList.reduce((t,n)=>n.children?t+n.children.reduce((i,c)=>c.tag===e?i+1:i,0):n.tag===e?t+1:t,0),ie=e=>{const t=se(e.tag);return t?e.label+t:e.label},y=e=>{const t=_(e);o.drawingList.push(t),L(t)},F=()=>new Date().getTime(),_=e=>{const t=JSON.parse(JSON.stringify(e));return t.formId=`${F()}`,t.layout||(t.layout="colFormItem"),t.layout==="colFormItem"?(t.label=ie(t),t.vModel=`field${t.formId}`,t.placeholder!==void 0&&(t.placeholder+=t.label),o.tempActiveData=t):t.layout==="rowFormItem"&&(t.rowType==="table"&&(t.vModel=`field${t.formId}`),t.componentName=`row${t.formId}`,t.gutter=o.formConf.gutter,G(t),o.tempActiveData=t),o.tempActiveData},G=e=>{e.children&&e.children.length&&e.children.forEach((n,i)=>{n.formId=e.formId+i+1,n.__ID=n.formId+new Date().getTime(),n.layout||(n.layout="colFormItem"),n.layout==="colFormItem"?(n.vModel=`field${n.formId}`,n.placeholder!==void 0&&(n.placeholder+=n.label)):n.layout==="rowFormItem"&&(n.componentName=`row${n.formId}`,n.gutter=o.formConf.gutter,G(n))})},le=()=>{const e=o.drawingList.find(t=>t.layout==="rowFormItem");if(e)return e.children.length===0},ae=()=>{var t;var e=JSON.parse(JSON.stringify(o.drawingList));(t=R.value)==null||t.open(e)},re=()=>{if(B(o.flowConditions.map(e=>e.formId))){P.$modal.msgWarning("尚有组件已作为流程判断条件，无法删除");return}P.$modal.confirm("确定要清空所有组件吗？","提示",{type:"warning"}).then(()=>{o.drawingList=[]})},M=e=>(e.formId=F(),e.layout==="colFormItem"?e.vModel=`field${e.formId}`:e.layout==="rowFormItem"&&(e.componentName=`row${e.formId}`),Array.isArray(e.children)&&(e.children=e.children.map(t=>M(t))),e),B=e=>Y(e),U=e=>e?!!o.flowConditions.find(n=>n.formId==e.formId)&&B([e.formId]):!1,j=e=>{if(Array.isArray(e.children)&&e.children.length){if(e.rowType==="table")return!1;let t=!1;const n=i=>{t||Array.isArray(i)&&i.some(c=>(c.children&&n(c.children),U(c)))&&(t=!0)};return n(e.children),t}else return U(e)},ce=(e,t)=>{let n=Ae(e);n=M(n),t.push(n),L(n)},de=(e,t)=>{if(j(t[e])){P.$modal.msgWarning("该组件已作为流程判断条件，无法删除");return}$(t[e].formId),t.splice(e,1),Se(()=>{const n=o.drawingList.length;n&&L(o.drawingList[n-1])})},me=e=>{e=_(e),e.vModel=o.activeData.vModel,e.formId=o.activeId,e.span=o.activeData.span,delete o.activeData.tag,delete o.activeData.tagIcon,Object.keys(e).forEach(t=>{o.activeData[t]!==void 0&&typeof o.activeData[t]==typeof e[t]&&(e[t]=o.activeData[t])}),o.activeData=e,J(e,o.drawingList)},J=(e,t)=>{const n=t.findIndex(i=>i.formId===o.activeId);n>-1?t.splice(n,1,e):t.forEach(i=>{Array.isArray(i.children)&&J(e,i.children)})};return A("activeFormItem",L),A("deleteItem",de),A("copyItem",ce),A("addPCondition",z),A("delPCondition",$),W(()=>o.drawingList,e=>{e&&Ee(te(),400)},{deep:!0,immediate:!0}),ee(),H({getSetting:oe}),(e,t)=>{const n=p("SvgIcon"),i=p("el-tab-pane"),c=p("el-tabs"),x=p("el-scrollbar"),k=p("el-button"),pe=p("el-button-group"),fe=p("el-form"),ue=p("el-alert"),_e=p("el-dialog");return f(),g(q,null,[a("div",$e,[a("div",Ne,[l(x,{class:"left-scrollbar"},{default:r(()=>[l(c,{modelValue:o.activeTabName,"onUpdate:modelValue":t[3]||(t[3]=s=>o.activeTabName=s),stretch:!0},{default:r(()=>[l(i,{label:"定制组件",name:"custom"},{default:r(()=>[a("div",Re,[Oe,l(u(C),{class:"components-draggable",modelValue:o.customComponents,"onUpdate:modelValue":t[0]||(t[0]=s=>o.customComponents=s),group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:b,"item-key":"index"},{item:r(({element:s,index:d})=>[(f(),g("div",{key:d,class:"components-item",onClick:S=>y(s)},[a("div",Fe,[l(n,{name:"/assets/bpm/svg/"+s.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-primary)"},null,8,["name"]),m(" "+I(s.label),1)])],8,ze))]),_:1},8,["modelValue"]),Ge,l(u(C),{class:"components-draggable",list:o.customGroupComponents,group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:b,"item-key":"id"},{item:r(({element:s,index:d})=>[(f(),g("div",{key:d,class:"components-item custom-component",onClick:S=>y(s)},[a("div",Be,[l(n,{name:"/assets/bpm/svg/"+s.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-warning)"},null,8,["name"]),m(" "+I(s.label),1)])],8,Me))]),_:1},8,["list"])])]),_:1}),l(i,{label:"基础组件",name:"common"},{default:r(()=>[a("div",Ue,[je,l(u(C),{class:"components-draggable",modelValue:o.inputComponents,"onUpdate:modelValue":t[1]||(t[1]=s=>o.inputComponents=s),group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:b,"item-key":"index"},{item:r(({element:s,index:d})=>[(f(),g("div",{key:d,class:"components-item",onClick:S=>y(s)},[a("div",Te,[m(I(s.label)+" ",1),l(n,{name:"/assets/bpm/svg/"+s.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-primary)"},null,8,["name"])])],8,Je))]),_:1},8,["modelValue"]),We,l(u(C),{class:"components-draggable",modelValue:o.extComponents,"onUpdate:modelValue":t[2]||(t[2]=s=>o.extComponents=s),group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:b,"item-key":"index"},{item:r(({element:s,index:d})=>[(f(),g("div",{key:d,class:"components-item",onClick:S=>y(s)},[a("div",He,[l(n,{name:"/assets/bpm/svg/"+s.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-primary)"},null,8,["name"]),m(" "+I(s.label),1)])],8,qe))]),_:1},8,["modelValue"]),Ke,l(u(C),{class:"components-draggable",list:o.selectComponents,group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:b},{item:r(({element:s,index:d})=>[(f(),g("div",{key:d,class:"components-item",onClick:S=>y(s)},[a("div",Xe,[m(I(s.label)+" ",1),l(n,{name:"/assets/bpm/svg/"+s.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-primary)"},null,8,["name"])])],8,Qe))]),_:1},8,["list"]),Ye,l(u(C),{class:"components-draggable",list:o.layoutComponents,group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:b},{item:r(({element:s,index:d})=>[(f(),g("div",{key:d,class:"components-item",onClick:S=>y(s)},[a("div",eo,[m(I(s.label)+" ",1),l(n,{name:"/assets/bpm/svg/"+s.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-danger)"},null,8,["name"])])],8,Ze))]),_:1},8,["list"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),a("div",oo,[a("div",to,[l(pe,{style:{"padding-top":"10px"}},{default:r(()=>[l(k,{onClick:t[4]||(t[4]=s=>o.drawerSize="390px"),icon:"ele-Cellphone",title:"手机"},{default:r(()=>[no]),_:1}),l(k,{onClick:t[5]||(t[5]=s=>o.drawerSize="100%"),icon:"ele-Monitor",title:"电脑"},{default:r(()=>[so]),_:1}),l(k,{icon:"ele-View",plain:"",onClick:ae,title:"预览"},{default:r(()=>[io]),_:1}),l(k,{icon:"ele-Delete",plain:"",onClick:re,title:"清空"},{default:r(()=>[lo]),_:1})]),_:1})]),a("div",ao,[a("div",{class:"outerdevice portrait",style:be({width:o.drawerSize})},[a("div",ro,[a("div",co,[l(x,{class:"center-scrollbar",style:{}},{default:r(()=>[l(fe,{model:o.formConf.model,class:"drawing-board",size:o.formConf.size,"label-position":o.formConf.labelPosition,disabled:o.formConf.disabled,"label-width":o.formConf.labelWidth+"px"},{default:r(()=>[l(u(K),{list:o.drawingList,animation:200,group:"componentsGroup",onEnd:ne,tag:"el-row",conf:o.formConf,style:{marginLeft:0,alignContent:"start",height:"100%"},gutter:o.formConf.gutter},null,8,["list","conf","gutter"])]),_:1},8,["model","size","label-position","disabled","label-width"]),ye(a("div",mo,"从左侧拖入或点选组件进行表单设计",512),[[Ie,!o.drawingList.length]])]),_:1})]),po])],4)],512)]),l(u(X),{"active-data":o.activeData,"form-conf":o.formConf,"show-field":o.drawingList&&o.drawingList.length,"could-change-require":!j(o.activeData),list:o.drawingList,onTagChange:me},null,8,["active-data","form-conf","show-field","could-change-require","list"]),fo]),l(_e,{modelValue:o.isErrorShow,"onUpdate:modelValue":t[7]||(t[7]=s=>o.isErrorShow=s),title:"验证提示"},{footer:r(()=>[a("span",uo,[l(k,{onClick:t[6]||(t[6]=s=>o.isErrorShow=!1)},{default:r(()=>[_o]),_:1})])]),default:r(()=>[(f(!0),g(q,null,we(o.validResults,s=>(f(),ke(ue,{type:"error",title:s,style:{"margin-bottom":"10px"}},null,8,["title"]))),256))]),_:1},8,["modelValue"]),l(u(Q),{ref_key:"previewPanelRef",ref:R},null,512)],64)}}});const Lo=Pe(go,[["__scopeId","data-v-4c07419c"]]);export{Lo as default};
