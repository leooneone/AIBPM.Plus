import{P as x}from"./Permission.b7f0ca93.js";import{A as E}from"./Api.114d5bc7.js";import{l as H}from"./tree.d5b28a07.js";import{e as J}from"./mitt.7f99bbc0.js";import{aM as C,aN as W}from"./index.390778f0.js";import{b as Z}from"./_baseIndexOf.e907b547.js";import{d as D,r as K,O as G,K as Q,S as c,e as X,f as Y,z as a,m as n,g as _,u,y,x as R,L as ee}from"./vue.df334614.js";import{_ as oe}from"./_plugin-vue_export-helper.c27b6911.js";import"./http-client.ff22776c.js";import"./index.de963593.js";import"./storage.08e609be.js";import"./js.cookie.cf83ad76.js";import"./index.4621962e.js";function te(o,l,r){var f=-1,e=o.length;l<0&&(l=-l>e?0:e+l),r=r>e?e:r,r<0&&(r+=e),e=l>r?0:r-l>>>0,l>>>=0;for(var i=Array(e);++f<e;)i[f]=o[f+l];return i}function ae(o,l,r){var f=o.length;return r=r===void 0?f:r,!l&&r>=f?o:te(o,l,r)}var le="\\ud800-\\udfff",re="\\u0300-\\u036f",ne="\\ufe20-\\ufe2f",se="\\u20d0-\\u20ff",de=re+ne+se,ie="\\ufe0e\\ufe0f",ue="\\u200d",fe=RegExp("["+ue+le+de+ie+"]");function me(o){return fe.test(o)}function pe(o){return o.split("")}var S="\\ud800-\\udfff",ce="\\u0300-\\u036f",ge="\\ufe20-\\ufe2f",_e="\\u20d0-\\u20ff",be=ce+ge+_e,xe="\\ufe0e\\ufe0f",we="["+S+"]",w="["+be+"]",V="\\ud83c[\\udffb-\\udfff]",Ve="(?:"+w+"|"+V+")",A="[^"+S+"]",I="(?:\\ud83c[\\udde6-\\uddff]){2}",T="[\\ud800-\\udbff][\\udc00-\\udfff]",he="\\u200d",k=Ve+"?",U="["+xe+"]?",ye="(?:"+he+"(?:"+[A,I,T].join("|")+")"+U+k+")*",ve=U+k+ye,Ce="(?:"+[A+w+"?",w,I,T,we].join("|")+")",De=RegExp(V+"(?="+V+")|"+Ce+ve,"g");function Re(o){return o.match(De)||[]}function v(o){return me(o)?Re(o):pe(o)}function Se(){var o=arguments,l=C(o[0]);return o.length<3?l:l.replace(o[1],o[2])}function Ae(o,l){for(var r=-1,f=o.length;++r<f&&Z(l,o[r],0)>-1;);return r}var Ie=/^\s+/;function Te(o,l,r){if(o=C(o),o&&(r||l===void 0))return o.replace(Ie,"");if(!o||!(l=W(l)))return o;var f=v(o),e=Ae(f,v(l));return ae(f,e).join("")}const ke={class:"my-flex my-flex-between"},Ue=["title"],Me={class:"dialog-footer"},$e=R("取 消"),Le=R("确 定"),Oe=D({name:"admin/permission/permission-dot-form"}),Ne=D({...Oe,props:{title:{type:String,default:""},permissionTreeData:{type:Array,default:()=>[]}},setup(o,{expose:l}){const{proxy:r}=ee(),f=K(),e=G({showDialog:!1,sureLoading:!1,form:{enabled:!0},apiTreeData:[]}),{form:i}=Q(e),M=async()=>{const s=await new E().getList();s!=null&&s.success&&s.data&&s.data.length>0?e.apiTreeData=H(s.data):e.apiTreeData=[]},$=async(s={})=>{if(r.$modal.loading(),await M(),s.id>0){const t=await new x().getDot({id:s.id});if(t!=null&&t.success){let m=t.data;m.parentId=m.parentId&&m.parentId>0?m.parentId:void 0,e.form=m}}else e.form={enabled:!0};r.$modal.closeLoading(),e.showDialog=!0},L=(s,t)=>{var m,p;return s?((m=t.label)==null?void 0:m.indexOf(s))!==-1||((p=t.path)==null?void 0:p.indexOf(s))!==-1:!0},O=s=>{s&&(e.form.label||(e.form.label=s.label),e.form.code||(e.form.code=Te(Se(s.path||"",/\//g,":"),":")))},N=()=>{e.showDialog=!1},z=()=>{f.value.validate(async s=>{if(!s)return;e.sureLoading=!0;let t={};e.form.parentId=e.form.parentId&&e.form.parentId>0?e.form.parentId:void 0,e.form.id!=null&&e.form.id>0?t=await new x().updateDot(e.form,{showSuccessMessage:!0}):t=await new x().addDot(e.form,{showSuccessMessage:!0}),e.sureLoading=!1,t!=null&&t.success&&(J.emit("refreshPermission"),e.showDialog=!1)})};return l({open:$}),(s,t)=>{const m=c("el-tree-select"),p=c("el-form-item"),g=c("el-col"),b=c("el-input"),P=c("el-input-number"),F=c("el-switch"),j=c("el-row"),q=c("el-form"),h=c("el-button"),B=c("el-dialog");return X(),Y("div",null,[a(B,{modelValue:e.showDialog,"onUpdate:modelValue":t[7]||(t[7]=d=>e.showDialog=d),"destroy-on-close":"",title:o.title,draggable:"",width:"600px"},{footer:n(()=>[_("span",Me,[a(h,{onClick:N,size:"default"},{default:n(()=>[$e]),_:1}),a(h,{type:"primary",onClick:z,size:"default",loading:e.sureLoading},{default:n(()=>[Le]),_:1},8,["loading"])])]),default:n(()=>[a(q,{model:u(i),ref_key:"formRef",ref:f,size:"default","label-width":"80px"},{default:n(()=>[a(j,{gutter:35},{default:n(()=>[a(g,{xs:24,sm:24,md:24,lg:24,xl:24},{default:n(()=>[a(p,{label:"上级菜单"},{default:n(()=>[a(m,{modelValue:u(i).parentId,"onUpdate:modelValue":t[0]||(t[0]=d=>u(i).parentId=d),data:o.permissionTreeData,"node-key":"id","check-strictly":"","default-expand-all":"","render-after-expand":"","fit-input-width":"",clearable:"",filterable:"",class:"w100"},null,8,["modelValue","data"])]),_:1})]),_:1}),a(g,{xs:24,sm:24,md:24,lg:24,xl:24},{default:n(()=>[a(p,{label:"API接口"},{default:n(()=>[a(m,{modelValue:u(i).apiIds,"onUpdate:modelValue":t[1]||(t[1]=d=>u(i).apiIds=d),data:e.apiTreeData,"node-key":"id",props:{label:"path"},"default-expand-all":"","render-after-expand":"","fit-input-width":"",clearable:"",filterable:"",multiple:"","collapse-tags":"","collapse-tags-tooltip":"","filter-node-method":L,class:"w100",onCurrentChange:O},{default:n(({data:d})=>[_("span",ke,[_("span",null,y(d.label),1),_("span",{class:"my-line-1 my-mlr-12",title:d.path},y(d.path),9,Ue)])]),_:1},8,["modelValue","data"])]),_:1})]),_:1}),a(g,{xs:24,sm:24,md:24,lg:24,xl:24},{default:n(()=>[a(p,{label:"名称",prop:"label",rules:[{required:!0,message:"请输入名称",trigger:["blur","change"]}]},{default:n(()=>[a(b,{modelValue:u(i).label,"onUpdate:modelValue":t[2]||(t[2]=d=>u(i).label=d),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{xs:24,sm:24,md:24,lg:24,xl:24},{default:n(()=>[a(p,{label:"编码",prop:"code",rules:[{required:!0,message:"请输入编码",trigger:["blur","change"]}]},{default:n(()=>[a(b,{modelValue:u(i).code,"onUpdate:modelValue":t[3]||(t[3]=d=>u(i).code=d),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{xs:24,sm:12,md:12,lg:12,xl:12},{default:n(()=>[a(p,{label:"排序"},{default:n(()=>[a(P,{modelValue:u(i).sort,"onUpdate:modelValue":t[4]||(t[4]=d=>u(i).sort=d)},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{xs:24,sm:12,md:12,lg:12,xl:12},{default:n(()=>[a(p,{label:"启用"},{default:n(()=>[a(F,{modelValue:u(i).enabled,"onUpdate:modelValue":t[5]||(t[5]=d=>u(i).enabled=d)},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{xs:24,sm:24,md:24,lg:24,xl:24},{default:n(()=>[a(p,{label:"说明"},{default:n(()=>[a(b,{modelValue:u(i).description,"onUpdate:modelValue":t[6]||(t[6]=d=>u(i).description=d),clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const Qe=oe(Ne,[["__scopeId","data-v-38c5a7ef"]]);export{Qe as default};
