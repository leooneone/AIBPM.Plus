import{_ as E}from"./preload-helper.101896b7.js";import{d as Ce,a6 as P,J as T,r as be,O as ye,o as Ie,w as W,S as c,e as p,f as g,g as a,z as l,m as r,u,x as m,y as S,n as we,j as De,p as Le,v as ke,F as q,B as Se,H,ab as Ae,ac as xe,L as Ee,I as A,l as Pe}from"./vue.72f2672d.js";import{c as h}from"./index.3b187802.js";import{d as Ve}from"./index.44ec5d1e.js";import{g as $e}from"./db.cba4b16a.js";import{d as Ne}from"./index.97b0ee19.js";import{_ as Re}from"./_plugin-vue_export-helper.c27b6911.js";const v=C=>(Ae("data-v-77bc110f"),C=C(),xe(),C),Oe={class:"container"},ze={class:"left-board"},Fe={class:"components-list"},Me=v(()=>a("div",{class:"components-title"},"工作流组件",-1)),Ge=["onClick"],Be={class:"components-body"},je=v(()=>a("div",{class:"components-title"},"组合型组件",-1)),Je=["onClick"],Ue={class:"components-body"},Te={class:"components-list"},We=v(()=>a("div",{class:"components-title"},"输入型组件",-1)),qe=["onClick"],He={class:"components-body"},Ke=v(()=>a("div",{class:"components-title"},"选择型组件",-1)),Qe=["onClick"],Xe={class:"components-body"},Ye=v(()=>a("div",{class:"components-title"},"布局型组件",-1)),Ze=["onClick"],eo={class:"components-body"},oo={class:"center-board"},to={class:"action-bar"},no=m("手机 "),so=m("电脑"),io=m("预览"),lo=m("清空"),ao={id:"device",ref:"device"},ro={class:"devicebody"},co={class:"devicescreen"},mo={class:"empty-info"},fo=v(()=>a("div",{class:"devicecamera"},null,-1)),po=v(()=>a("input",{id:"copyNode",type:"hidden"},null,-1)),uo={class:"dialog-footer"},_o=m("知道了"),go=Ce({__name:"index",props:{conf:Object},setup(C,{expose:K}){const b=C,Q=P(()=>E(()=>import("./RenderPanel.e9a557b9.js"),["assets/RenderPanel.e9a557b9.js","assets/RenderPanel.vue_vue_type_script_setup_true_name_render-panel_lang.2d0cb278.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js"])),X=P(()=>E(()=>import("./preview.04d1c5d5.js"),["assets/preview.04d1c5d5.js","assets/preload-helper.101896b7.js","assets/vue.72f2672d.js","assets/preview.ffee983c.css"])),Y=P(()=>E(()=>import("./RightPanel.ddaaf671.js"),["assets/RightPanel.ddaaf671.js","assets/TreeNodeDialog.bda0ea43.js","assets/index.44ec5d1e.js","assets/db.cba4b16a.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/vue.72f2672d.js","assets/IconsDialog.10887015.js","assets/IconsDialog.b33d00de.css","assets/index.3b187802.js","assets/vuedraggable.umd.ca06df7b.js","assets/_commonjsHelpers.042e6b4d.js","assets/vue.runtime.esm-bundler.2c939456.js","assets/index.97b0ee19.js","assets/RightPanel.600aeae7.css"])),y=P(()=>E(()=>import("./vuedraggable.umd.ca06df7b.js").then(e=>e.v),["assets/vuedraggable.umd.ca06df7b.js","assets/_commonjsHelpers.042e6b4d.js","assets/vue.runtime.esm-bundler.2c939456.js","assets/vue.72f2672d.js"])),N=$e(),{proxy:V}=Ee(),Z=T("isInUseByCondition"),ee=T("updateFormItemList"),R=be(),o=ye({isErrorShow:!1,validResults:[],formConf:h.formConf,customComponents:h.customComponents,inputComponents:h.inputComponents,selectComponents:h.selectComponents,layoutComponents:h.layoutComponents,customGroupComponents:h.customGroupComponents,labelWidth:100,drawingList:[],drawingData:{},activeId:"",drawerVisible:!1,generateConf:null,activeData:{},activeTabName:"custom",deviceMode:"portrait",drawerSize:"490px",flowConditions:[],tempActiveData:{}}),oe=()=>{typeof b.conf=="object"&&b.conf!==null?(o.drawingList=b.conf.formItems||[],Object.assign(o.formConf,b.conf)):N&&(o.formConf=N),o.formConf.model={},o.formConf.mode="designer",H(e=>te())};Ie(()=>{}),W(()=>b.conf,e=>{typeof e=="object"&&e!==null&&(o.drawingList=e.formItems||[],Object.assign(o.formConf,e))});const te=()=>{},ne=()=>new Promise((e,t)=>{o.validResults=[],o.drawingList.length===0&&o.validResults.push("表单不允许为空"),re()&&o.validResults.push("您的行容器中没有组件"),o.validResults.length>0&&(o.isErrorShow=!0,t()),o.drawingList&&o.drawingList.length>0&&e({...o.formConf,formItems:JSON.parse(JSON.stringify(o.drawingList))}),e(!1)}),O=(e,t=!1)=>{let n=o.flowConditions.findIndex(s=>s.formId===e);return t?n:n>-1},z=e=>{e.formId===null||e.formId===void 0||O(e.formId)||o.flowConditions.unshift(e)},$=e=>{if(e==null)return;let t=O(e,!0),n=o.flowConditions;t>-1&&n.splice(t,1)},se=e=>{const t=(s,d)=>!(["fc-date-duration","fc-time-duration"].includes(s.tag)&&!s.showDuration||d&&d.rowType==="table"||!s.proCondition||!s.required||s.tag==="el-select"&&s.multiple),n=(s,d)=>{s&&(Array.isArray(s.children)&&s.children.forEach(L=>n(L,s)),Array.isArray(s)?s.forEach(n):t(s,d)?z(s):$(s.formId))};n(o.drawingList),ee(o.drawingList,o.flowConditions)},I=e=>{e&&(o.activeData=e,o.formConf.activeId=e.formId)},w=(e,t)=>{e.from!==e.to&&(o.activeId=o.tempActiveData.formId,o.activeData=o.tempActiveData)},ie=(e,t)=>{I(o.drawingList[e.newIndex])},le=e=>o.drawingList.reduce((t,n)=>n.children?t+n.children.reduce((s,d)=>d.tag===e?s+1:s,0):n.tag===e?t+1:t,0),ae=e=>{const t=le(e.tag);return t?e.label+t:e.label},D=e=>{const t=_(e);o.drawingList.push(t),I(t)},F=()=>new Date().getTime(),_=e=>{const t=JSON.parse(JSON.stringify(e));return t.formId=`${F()}`,t.layout||(t.layout="colFormItem"),t.layout==="colFormItem"?(t.label=ae(t),t.vModel=`field${t.formId}`,t.placeholder!==void 0&&(t.placeholder+=t.label),o.tempActiveData=t):t.layout==="rowFormItem"&&(t.rowType==="table"&&(t.vModel=`field${t.formId}`),t.componentName=`row${t.formId}`,t.gutter=o.formConf.gutter,M(t),o.tempActiveData=t),o.tempActiveData},M=e=>{e.children&&e.children.length&&e.children.forEach((n,s)=>{n.formId=e.formId+s+1,n.__ID=n.formId+new Date().getTime(),n.layout||(n.layout="colFormItem"),n.layout==="colFormItem"?(n.vModel=`field${n.formId}`,n.placeholder!==void 0&&(n.placeholder+=n.label)):n.layout==="rowFormItem"&&(delete n.label,n.componentName=`row${n.formId}`,n.gutter=o.formConf.gutter,M(n))})},re=()=>{const e=o.drawingList.find(t=>t.layout==="rowFormItem");if(e)return e.children.length===0},de=()=>{var t;var e=JSON.parse(JSON.stringify(o.drawingList));(t=R.value)==null||t.open(e)},ce=()=>{if(B(o.flowConditions.map(e=>e.formId))){V.$modal.msgWarning("尚有组件已作为流程判断条件，无法删除");return}V.$modal.confirm("确定要清空所有组件吗？","提示",{type:"warning"}).then(()=>{o.drawingList=[]})},G=e=>(e.formId=F(),e.layout==="colFormItem"?e.vModel=`field${e.formId}`:e.layout==="rowFormItem"&&(e.componentName=`row${e.formId}`),Array.isArray(e.children)&&(e.children=e.children.map(t=>G(t))),e),B=e=>Z(e),j=e=>e?!!o.flowConditions.find(n=>n.formId==e.formId)&&B([e.formId]):!1,J=e=>{if(Array.isArray(e.children)&&e.children.length){if(e.rowType==="table")return!1;let t=!1;const n=s=>{t||Array.isArray(s)&&s.some(d=>(d.children&&n(d.children),j(d)))&&(t=!0)};return n(e.children),t}else return j(e)},me=(e,t)=>{let n=Ve(e);n=G(n),t.push(n),I(n)},fe=(e,t)=>{if(J(t[e])){V.$modal.msgWarning("该组件已作为流程判断条件，无法删除");return}$(t[e].formId),t.splice(e,1),H(()=>{const n=o.drawingList.length;n&&I(o.drawingList[n-1])})},pe=e=>{e=_(e),e.vModel=o.activeData.vModel,e.formId=o.activeId,e.span=o.activeData.span,delete o.activeData.tag,delete o.activeData.tagIcon,Object.keys(e).forEach(t=>{o.activeData[t]!==void 0&&typeof o.activeData[t]==typeof e[t]&&(e[t]=o.activeData[t])}),o.activeData=e,U(e,o.drawingList)},U=(e,t)=>{const n=t.findIndex(s=>s.formId===o.activeId);n>-1?t.splice(n,1,e):t.forEach(s=>{Array.isArray(s.children)&&U(e,s.children)})};return A("activeFormItem",I),A("deleteItem",fe),A("copyItem",me),A("addPCondition",z),A("delPCondition",$),W(()=>o.drawingList,e=>{e&&Ne(se(),400)},{deep:!0,immediate:!0}),oe(),K({getSetting:ne}),(e,t)=>{const n=c("SvgIcon"),s=c("el-tab-pane"),d=c("el-tabs"),L=c("el-scrollbar"),k=c("el-button"),ue=c("el-button-group"),_e=c("el-form"),ge=c("el-tooltip"),ve=c("el-alert"),he=c("el-dialog");return p(),g(q,null,[a("div",Oe,[a("div",ze,[l(L,{class:"left-scrollbar"},{default:r(()=>[l(d,{modelValue:o.activeTabName,"onUpdate:modelValue":t[2]||(t[2]=i=>o.activeTabName=i),stretch:!0},{default:r(()=>[l(s,{label:"定制组件",name:"custom"},{default:r(()=>[a("div",Fe,[Me,l(u(y),{class:"components-draggable",modelValue:o.customComponents,"onUpdate:modelValue":t[0]||(t[0]=i=>o.customComponents=i),group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:w,"item-key":"index"},{item:r(({element:i,index:f})=>[(p(),g("div",{key:f,class:"components-item",onClick:x=>D(i)},[a("div",Be,[l(n,{name:"/assets/bpm/svg/"+i.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-primary)"},null,8,["name"]),m(" "+S(i.label),1)])],8,Ge))]),_:1},8,["modelValue"]),je,l(u(y),{class:"components-draggable",list:o.customGroupComponents,group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:w,"item-key":"id"},{item:r(({element:i,index:f})=>[(p(),g("div",{key:f,class:"components-item custom-component",onClick:x=>D(i)},[a("div",Ue,[l(n,{name:"/assets/bpm/svg/"+i.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-warning)"},null,8,["name"]),m(" "+S(i.label),1)])],8,Je))]),_:1},8,["list"])])]),_:1}),l(s,{label:"基础组件",name:"common"},{default:r(()=>[a("div",Te,[We,l(u(y),{class:"components-draggable",modelValue:o.inputComponents,"onUpdate:modelValue":t[1]||(t[1]=i=>o.inputComponents=i),group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:w,"item-key":"index"},{item:r(({element:i,index:f})=>[(p(),g("div",{key:f,class:"components-item",onClick:x=>D(i)},[a("div",He,[m(S(i.label)+" ",1),l(n,{name:"/assets/bpm/svg/"+i.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-primary)"},null,8,["name"])])],8,qe))]),_:1},8,["modelValue"]),Ke,l(u(y),{class:"components-draggable",list:o.selectComponents,group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:w},{item:r(({element:i,index:f})=>[(p(),g("div",{key:f,class:"components-item",onClick:x=>D(i)},[a("div",Xe,[m(S(i.label)+" ",1),l(n,{name:"/assets/bpm/svg/"+i.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-primary)"},null,8,["name"])])],8,Qe))]),_:1},8,["list"]),Ye,l(u(y),{class:"components-draggable",list:o.layoutComponents,group:{name:"componentsGroup",pull:"clone",put:!1},clone:_,draggable:".components-item",sort:!1,onEnd:w},{item:r(({element:i,index:f})=>[(p(),g("div",{key:f,class:"components-item",onClick:x=>D(i)},[a("div",eo,[m(S(i.label)+" ",1),l(n,{name:"/assets/bpm/svg/"+i.tagIcon+".svg",class:"svg-icon",size:"18",color:"var(--el-color-danger)"},null,8,["name"])])],8,Ze))]),_:1},8,["list"])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),a("div",oo,[a("div",to,[l(ue,{style:{"padding-top":"10px"}},{default:r(()=>[l(k,{onClick:t[3]||(t[3]=i=>o.drawerSize="390px"),icon:"ele-Cellphone",title:"手机"},{default:r(()=>[no]),_:1}),l(k,{onClick:t[4]||(t[4]=i=>o.drawerSize="100%"),icon:"ele-Monitor",title:"电脑"},{default:r(()=>[so]),_:1}),l(k,{icon:"ele-View",plain:"",onClick:de,title:"预览"},{default:r(()=>[io]),_:1}),l(k,{icon:"ele-Delete",plain:"",onClick:ce,title:"清空"},{default:r(()=>[lo]),_:1})]),_:1})]),a("div",ao,[a("div",{class:we(["outerdevice",[o.deviceMode]]),style:De({width:o.drawerSize})},[a("div",ro,[a("div",co,[l(L,{class:"center-scrollbar",style:{}},{default:r(()=>[l(_e,{model:o.formConf.model,class:"drawing-board",size:o.formConf.size,"label-position":o.formConf.labelPosition,disabled:o.formConf.disabled,"label-width":o.formConf.labelWidth+"px"},{default:r(()=>[l(u(Q),{list:o.drawingList,animation:200,group:"componentsGroup",onEnd:ie,tag:"el-row",conf:o.formConf,style:{marginLeft:0,alignContent:"start",height:"100%"},gutter:o.formConf.gutter},null,8,["list","conf","gutter"])]),_:1},8,["model","size","label-position","disabled","label-width"]),Le(a("div",mo,"从左侧拖入或点选组件进行表单设计",512),[[ke,!o.drawingList.length]])]),_:1})]),fo,l(ge,{effect:"dark",content:"切换横/竖模式",placement:"top"},{default:r(()=>[a("div",{class:"devicehomebutton",onClick:t[5]||(t[5]=i=>e.deviceMode=e.deviceMode==="landscape"?"portrait":"landscape")})]),_:1})])],6)],512)]),l(u(Y),{"active-data":o.activeData,"form-conf":o.formConf,"show-field":o.drawingList&&o.drawingList.length,"could-change-require":!J(o.activeData),list:o.drawingList,onTagChange:pe},null,8,["active-data","form-conf","show-field","could-change-require","list"]),po]),l(he,{modelValue:o.isErrorShow,"onUpdate:modelValue":t[7]||(t[7]=i=>o.isErrorShow=i),title:"验证提示"},{footer:r(()=>[a("span",uo,[l(k,{onClick:t[6]||(t[6]=i=>o.isErrorShow=!1)},{default:r(()=>[_o]),_:1})])]),default:r(()=>[(p(!0),g(q,null,Se(o.validResults,i=>(p(),Pe(ve,{type:"error",title:i,style:{"margin-bottom":"10px"}},null,8,["title"]))),256))]),_:1},8,["modelValue"]),l(u(X),{ref_key:"previewPanelRef",ref:R},null,512)],64)}}});const Do=Re(go,[["__scopeId","data-v-77bc110f"]]);export{Do as default};
