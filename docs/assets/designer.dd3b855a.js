import{_ as N}from"./preload-helper.101896b7.js";import{d as Q,a7 as Y,a6 as I,r as b,O as Z,c as tt,a9 as et,o as at,S as d,a4 as st,e as r,f as g,l as J,m as l,z as o,p as u,g as c,F as L,B as R,j as ot,u as y,v as h,t as nt,x as f,ab as it,ac as lt,L as rt,I as A,n as ct,y as M}from"./vue.df334614.js";import{W as $}from"./WorkflowTemplate.4acedb24.js";import{N as dt}from"./loading.4205d903.js";import pt from"./index.c8d03d4e.js";import{x as gt}from"./index.c6652de1.js";import{_ as ut}from"./_plugin-vue_export-helper.c27b6911.js";import"./http-client.1087bc02.js";import"./index.de963593.js";import"./index.390778f0.js";import"./index.4621962e.js";import"./storage.08e609be.js";import"./js.cookie.cf83ad76.js";import"./index.f4a20413.js";import"./focus-trap.ccecd842.js";const ft=_=>(it("data-v-4e159e26"),_=_(),lt(),_),_t=f("关闭"),mt={key:1,class:"design-page"},St={class:"page__header"},vt={class:"page-actions"},wt=ft(()=>c("div",null,"流程设计器",-1)),bt={class:"step-tab"},yt=["onClick"],ht={class:"step-index"},kt=f("草稿"),Ct=f("发布"),xt={key:0,class:"page__content"},Dt={class:"dialog-footer"},Nt=f("知道了"),It=Q({name:"designer",props:{title:{type:String,default:()=>"模板名称12"}},setup(_){const{proxy:O}=rt(),B=Y(),z=I(()=>N(()=>import("./index.ff91cce4.js"),["assets/index.ff91cce4.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/vue.df334614.js","assets/index.bab8c7f2.css"])),P=I(()=>N(()=>import("./index.15593cae.js"),["assets/index.15593cae.js","assets/vuedraggable.umd.13ffdc0e.js","assets/_commonjsHelpers.042e6b4d.js","assets/vue.runtime.esm-bundler.7d88586f.js","assets/vue.df334614.js","assets/RightPanel.2964517f.js","assets/TreeNodeDialog.268cbe72.js","assets/index.58028536.js","assets/db.bf0a0f00.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/IconsDialog.3ffee3e9.js","assets/IconsDialog.b33d00de.css","assets/index.97b0ee19.js","assets/RightPanel.600aeae7.css","assets/RenderPanel.vue_vue_type_script_setup_true_name_render-panel_lang.f444906d.js","assets/preload-helper.101896b7.js","assets/preview.vue_vue_type_style_index_0_lang.8d08eeb1.js","assets/preview.ffee983c.css","assets/index.426a3955.css"])),q=I(()=>N(()=>import("./index.9dd59a30.js"),["assets/index.9dd59a30.js","assets/index.afc935e7.js","assets/_plugin-vue_export-helper.c27b6911.js","assets/vue.df334614.js","assets/index.f5a9c9a2.js","assets/index.c996eb1a.js","assets/Permission.90a9a010.js","assets/Permission.8385cb28.css","assets/Operation.06714c7c.js","assets/Participant.fd6627bd.js","assets/index.e0ad165c.js","assets/user-select.0622e36c.js","assets/User.4679a863.js","assets/http-client.ff22776c.js","assets/index.de963593.js","assets/index.390778f0.js","assets/index.4621962e.js","assets/storage.08e609be.js","assets/js.cookie.cf83ad76.js","assets/org-menu.vue_vue_type_script_setup_true_lang.2abc46e4.js","assets/Org.95a10495.js","assets/tree.d5b28a07.js","assets/index.6c5a2d2c.js","assets/index.7cba2d6b.js","assets/index.f4a20413.js","assets/_Uint8Array.2a02cf9e.js","assets/index.e64efb6f.js","assets/_initCloneObject.115dee92.js","assets/focus-trap.ccecd842.js","assets/user-select.9baf66be.css","assets/org-select.vue_vue_type_script_setup_true_lang.c26e97f7.js","assets/role-select.vue_vue_type_script_setup_true_lang.d0b8f7bd.js","assets/Role.14cde0b3.js","assets/index.c0eb9a2b.css","assets/Participant.50caa650.css","assets/Condition.acab08a3.js","assets/Condition.1d374ee6.css","assets/Circulate.f172b24a.js","assets/index.77d120a1.js","assets/index.73fd2e39.css","assets/index.3b0db3b2.css"])),W=a=>{},X=a=>{t.fields=a},j=()=>{window.parent.postMessage("close"),window.close()};A("updateFormItemList",X),A("updateFlow",W);const k=b(null),E=b(null),C=b(null),x=b(null),t=Z({isShowResult:!1,fields:[],data:{name:"",formSetting:{},flowSetting:{},basicSetting:{},advancedSetting:{}},activeStep:"basicSetting",steps:[{label:"基础设置",key:"basicSetting"},{label:"表单设计",key:"formDesign"},{label:"流程设计",key:"flowDesign"},{label:"高级设置",key:"advancedSetting"}]}),F=()=>{var a=B.query.id;t.data.id=a,new $().save(t.data,{showErrorMessage:!0}).then(e=>{e.success?t.isShowResult=!0:O.$modal.msgError(e.msg)})},T=async a=>{var m,S,v,w;var e=!0,i=await((m=C.value)==null?void 0:m.getSetting().catch(s=>{t.activeStep="basicSetting",e=!1}));if(e){var p=await((S=k.value)==null?void 0:S.getSetting().catch(s=>{t.activeStep="formDesign",e=!1}));if(e){var n=await((v=E.value)==null?void 0:v.getSetting().catch(s=>{t.activeStep="flowDesign",e=!1}));if(e){var D=await((w=x.value)==null?void 0:w.getSetting().catch(s=>{t.activeStep="advancedSetting",e=!1}));e&&(t.data.basicSetting=i,t.data.basicContext=JSON.stringify(t.data.basicSetting),t.data.advancedContext=JSON.stringify(D),t.data.flowSetting=JSON.stringify(n),t.data.formSetting=JSON.stringify(p),t.data.isPublish=a,a?O.$modal.confirm("此操作将新建或者更新流程版本, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{F()}).catch(()=>{}):F())}}}},U=a=>{t.data.formSetting=a,console.log("onOk"),console.log(a)},G=tt(()=>`translateX(${t.steps.findIndex(a=>a.key===t.activeStep)*100}%)`),H=a=>{t.activeStep=a.key},K=()=>{gt.confirm("离开此页面您的修改将会丢失, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{window.parent.postMessage("close"),window.close()}).catch(()=>{})};return et(async()=>{var e,i,p;var a=B.query.id;if(a){const n=await new $().get({id:a});n.success&&(t.data.basicSetting=JSON.parse(n.data.basicContext)??{},t.data.formSetting=JSON.parse(n.data.formSetting)??{},t.data.flowSetting=JSON.parse(n.data.flowSetting)??{},t.data.model=n.data.model??{},t.data.advancedSetting=JSON.parse(n.data.advancedContext)??{},console.log("setSetting",t.data.advancedSetting),(e=x.value)==null||e.setSetting(t.data.advancedSetting),console.log("basicSetting",t.data.basicSetting),(i=C.value)==null||i.setSetting(t.data.basicSetting),console.log("formSetting",t.data.formSetting),(p=k.value)==null||p.setSetting(t.data.formSetting))}}),at(()=>{dt.done(600)}),(a,e)=>{const i=d("el-button"),p=d("el-result"),n=d("ele-Close"),D=d("el-icon"),m=d("el-button-group"),S=d("el-alert"),v=d("el-dialog"),w=st("auth");return r(),g("section",null,[t.isShowResult?(r(),J(p,{key:0,icon:"success",title:"提交成功","sub-title":"Please follow the instructions"},{extra:l(()=>[o(i,{type:"primary",onClick:j},{default:l(()=>[_t]),_:1})]),_:1})):u((r(),g("div",mt,[c("header",St,[c("div",vt,[c("div",{style:{"border-right":"1px solid #c5c5c5",cursor:"pointer"},onClick:K},[o(D,null,{default:l(()=>[o(n)]),_:1})]),wt]),c("div",bt,[(r(!0),g(L,null,R(t.steps,(s,V)=>(r(),g("div",{key:V,class:ct(["step",[t.activeStep==s.key?"active":""]]),onClick:Ot=>H(s)},[c("span",ht,M(V+1),1),f(" "+M(s.label),1)],10,yt))),128)),c("div",{class:"ghost-step step",style:ot({transform:y(G)})},null,4)]),o(m,null,{default:l(()=>[o(i,{size:"small",class:"draft-btn",onClick:e[0]||(e[0]=s=>T(!1))},{default:l(()=>[kt]),_:1}),o(i,{size:"small",class:"publish-btn",onClick:e[1]||(e[1]=s=>T(!0))},{default:l(()=>[Ct]),_:1})]),_:1})]),t.data?(r(),g("section",xt,[u(o(pt,{ref_key:"basicSetting",ref:C,conf:t.data.basicSetting,tabName:"basicSetting"},null,8,["conf"]),[[h,t.activeStep==="basicSetting"]]),u(o(y(z),{ref_key:"advancedSetting",ref:x,conf:t.data.advancedSetting},null,8,["conf"]),[[h,t.activeStep==="advancedSetting"]]),u(o(y(q),{ref_key:"flowDesign",ref:E,conf:t.data.flowSetting,fields:t.fields},null,8,["conf","fields"]),[[h,t.activeStep==="flowDesign"]]),u(o(y(P),{conf:t.data.formSetting,ref_key:"formDesign",ref:k,onOk:U,tabName:"formDesign"},null,8,["conf"]),[[h,t.activeStep==="formDesign"]])])):nt("",!0)])),[[w,"api:bpm:template:publish"]]),o(v,{modelValue:a.isErrorShow,"onUpdate:modelValue":e[3]||(e[3]=s=>a.isErrorShow=s),title:"验证提示",center:""},{footer:l(()=>[c("span",Dt,[o(i,{onClick:e[2]||(e[2]=s=>a.isErrorShow=!1)},{default:l(()=>[Nt]),_:1})])]),default:l(()=>[(r(!0),g(L,null,R(a.validResults,s=>(r(),J(S,{type:"error",title:s,style:{"margin-bottom":"10px"}},null,8,["title"]))),256))]),_:1},8,["modelValue"])])}}});const Xt=ut(It,[["__scopeId","data-v-4e159e26"]]);export{Xt as default};
